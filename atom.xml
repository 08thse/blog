<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Azure Identity Support Blog</title>
  
  <subtitle>日本マイクロソフトの Azure Active Directory と AD FS に関するサポート情報のブログです。</subtitle>
  <link href="https://jpazureid.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpazureid.github.io/blog/"/>
  <updated>2023-08-18T17:00:11.701Z</updated>
  <id>https://jpazureid.github.io/blog/</id>
  
  <author>
    <name>Azure Identity Support Japan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ライフサイクル ワークフローが一般提供 (GA) されました</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/lifecycle-workflows-ga/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/lifecycle-workflows-ga/</id>
    <published>2023-08-19T00:00:00.000Z</published>
    <updated>2023-08-18T17:00:11.701Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 中村 です。 </p><p>本記事は、2023 年 7 月 14 日に米国の Microsoft Entra (Azure AD) Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/lifecycle-workflows-is-now-generally-available/ba-p/2466931">Lifecycle Workflows is now generally available!</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>2023 年 6 月 7 日に発表しましたとおり、<a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/microsoft-entra-id-governance-is-generally-available/ba-p/2466932">Microsoft Entra ID Governance</a> が、最新の機能の 1 つである <strong>ライフサイクルワークフロー (LCW)</strong> を含め、<strong>一般提供</strong> を開始されました。パブリック プレビュー以降の機能強化や改良を含め、LCW の豊富な機能についてご紹介できることを嬉しく思います。</p><p>ユーザーの ID ライフサイクルは、組織のセキュリティ態勢の重要な部分であり、正しく管理されれば、新入社員 (Joiner)、異動者 (Mover)、離職者 (Leaver) (まとめて JML) のユーザーの生産性にプラスの影響を与えることができます。デジタル トランスフォーメーションが進むにつれ、優れた ID ライフサイクル管理の必要性が高まっています。しかし、IT およびセキュリティ チームは、一度に何百人もの従業員のオンボーディングとオフボーディングが必要となっており、これは複雑で時間がかかり、ミスを犯しやすい手作業のプロセスもあるため大きな課題に直面しています。これは、セキュリティ、ガバナンス、コンプライアンスの各分野でデジタル トランスフォーメーションに直面する IT 管理者が長きにわたり抱える課題です。ID ライフサイクルの課題を詳しく見てみると、以下の点が挙げられます:</p><ol><li>組織のすべての従業員が何かしらへのアクセスを必要としており、管理対象のアプリケーションの数やデータの量が著しく増加しています。これに加えて、規制要件も絶えず増加しています。IT 管理者はこれらの変化に対応するため、スクリプトを使用して JML のプロセスを実施していますが、問題が発生したときのトラブルシューティングは複雑で時間を要します。</li><li>新しいユーザーのオンボーディングには多くの要素が絡み合っています。初日から従業員の生産性を確保するために手動の繰り返しの作業を減らすことは、コスト削減や競争の激しい求人市場において優れた人材を確保する上で重要です。</li><li>サイバー犯罪が激化する中、従業員が組織を離れたり異動した際にアカウントとアクセスを適切なタイミングで削除しないと、組織がより多くのセキュリティの脅威に晒されます。IT 部門がリソースへのアクセス権の追加や削除を手動で行うと時間がかかりすぎてしまうため、遅延やエラーが発生し、コンプライアンスの問題が生じる可能性もあります。</li></ol><p>2022 年の Ignite で、<a href="https://learn.microsoft.com/en-us/azure/active-directory/governance/what-are-lifecycle-workflows">ライフサイクル ワークフロー</a> (LCW) のパブリックプレビューを発表しました。この機能では、自動化されたエンタープライズ レベルのユーザー ライフサイクル管理機能が提供され、組織は ID ライフサイクル管理を刷新し、IT 管理者がこれらの課題に対処するよう支援します。これ以来、世界中の何百もの組織がこの機能を試してフィードバックを提供くださいました。弊社では LCW をさらに改善し、IT 管理者がより多くの時間を節約し、作業ミスを減らし、損失につながる遅延を回避できるようにしました。これにより入社、異動、離職の繰り返しのタスクを自動化し、新しい従業員や役職変更のあった従業員がすぐに生産的になるよう支援できます。また、従業員が組織を離れた際にはアクセスが速やかに削除されたことを確認できるようになっています。</p><p> <img src="/blog/azure-active-directory/lifecycle-workflows-ga/lifecycle-workflows-ga1.png"></p><p> LCW がどのように IT 管理者の重要なタスクを自動化し、時間を節約し、リスクを減らし、そして従業員がより迅速に生産性を発揮できるよう支援しているかを次に探ってみましょう。</p><h2 id="シナリオ-1-新入社員のオンボーディング-プロセスを自動化し初日から生産性を上げる"><a href="#シナリオ-1-新入社員のオンボーディング-プロセスを自動化し初日から生産性を上げる" class="headerlink" title="シナリオ 1: 新入社員のオンボーディング プロセスを自動化し初日から生産性を上げる"></a>シナリオ 1: 新入社員のオンボーディング プロセスを自動化し初日から生産性を上げる</h2><p>通常、新しい従業員のオンボーディングには、IT 部門に対して複数のチケットを手作業で作成し、IT 部門は一連のバラバラのステップを完了する必要があります。結果として、新しい従業員が一部アプリへの必要なアクセス権を得られなかったり、Microsoft Teams のグループ メンバーシップや、最初のサインインに必要な資格情報などが不足してしまうということがよくあります。サービス チケットの処理や、間違いやすく不足しがちなステップの追跡には、IT 管理者にとってかなりの時間と労力がかかるだけでなく、ユーザーの生産性にも悪影響を及ぼします。</p><p>IT 管理者として、あなたにはこのプロセスを適切に管理する責任があります。ライフサイクル ワークフローを使用すると、従業員の開始日に基づいて、ユーザー アカウントを有効にし、新しい従業員にウェルカム メールを送信するとともに、マーケティング グループに従業員を追加し、組み込みの Logic Apps の拡張機能を使用して ServiceNow のチケットを作成するまでのカスタムワークフローをわずか数ステップで作成できます。</p><p>これを実現する方法を見てみましょう！</p><h3 id="ステップ-1-シナリオに適した既定のワークフロー-テンプレートを使用してカスタム-ワークフローを設定する。"><a href="#ステップ-1-シナリオに適した既定のワークフロー-テンプレートを使用してカスタム-ワークフローを設定する。" class="headerlink" title="ステップ 1: シナリオに適した既定のワークフロー テンプレートを使用してカスタム ワークフローを設定する。"></a>ステップ 1: シナリオに適した既定のワークフロー テンプレートを使用してカスタム ワークフローを設定する。</h3><p>Woodgrove の管理者である Lisa は、<a href="https://entra.microsoft.com/#view/Microsoft_AAD_LifecycleManagement/CommonMenuBlade/~/overview">Entra Identity Governance -&gt; Lifecycle Workflows</a> に移動し、[ワークフローの作成] をクリックして、シナリオに合った組み込みのワークフロー テンプレートを選択します。今回の場合、Lisa は [新入社員をオンボードする] ワークフローテンプレート を選んで、新入社員のオンボード シナリオに使用します。</p><p><img src="/blog/azure-active-directory/lifecycle-workflows-ga/lifecycle-workflows-ga2.png" alt="Microsoft Entra ID Governance Lifecycle Workflows を使用して、適切なシナリオに合った組み込みワークフロー テンプレートを選択します。"></p><p>Lisa は、[基本情報] タブからワークフロー名をカスタマイズし、トリガー イベントの詳細がすでに <strong>employeeHireDate 属性</strong>に基づいて<strong>トリガー</strong>されるように設定されていることを確認します。新しいライフサイクル ワークフローの機能強化により、必要に応じて代わりに<strong>ユーザーの作成日</strong>に基づいて<strong>トリガー</strong>を設定することも可能です。トリガー イベントの詳細は最大 180 日までカスタマイズできますが、新入社員のオンボーディングのシナリオでは、テンプレート値が新入社員の employeeHireDate に実行されるように設定されているため、追加の変更は必要ありません。</p><p>Lisa は、[スコープの構成] タブを使用して、ワークフローを特定のユーザーに対象を絞るようにさらにカスタマイズすることもできます。このためには、オンプレミス拡張属性やディレクトリ拡張属性など、サポートされている Azure Active Directory (Azure AD) のユーザープロパティが利用できます。これにより、必要な場合にはアメリカとヨーロッパにいるユーザー向けに異なるワークフローを設定することが可能です。</p><h3 id="ステップ-2-新入社員の初日に実行されるタスクをカスタマイズする。"><a href="#ステップ-2-新入社員の初日に実行されるタスクをカスタマイズする。" class="headerlink" title="ステップ 2: 新入社員の初日に実行されるタスクをカスタマイズする。"></a>ステップ 2: 新入社員の初日に実行されるタスクをカスタマイズする。</h3><p>各ワークフロー テンプレートにはシナリオに対応した <strong>事前定義のタスク</strong> があるため、追加のタスクを構成する必要ありません。管理者は、適切なシナリオに対して、<strong>追加のビルトイン タスク</strong> を使用して、ワークフローをさらにカスタマイズすることができます。また、<strong>カスタムの拡張タスク</strong> を利用して、Microsoft の強力なロー コード ソリューションである <strong>Logic Apps で追加のアクション</strong> を実行することもできます。</p><p>新しいライフサイクル ワークフローの機能強化により、アクセス パッケージの割り当てリクエストを行ったり、 カスタマイズした件名や本文、言語、追加の受信者を CC に追加することに加え、企業のロゴやドメインを含む独自のブランドでカスタマイズされた E メールを作成したりすることも可能です。</p><p>Woodgrove の新入社員に対してやるべきチェックリストのすべての項目を漏れなく確認できるよう、Lisa は <strong>既存の Logic Apps</strong> を活用して、ノート パソコンの配送を依頼する <strong>Service Now チケット</strong> を作成するタスクを追加します。</p><p>Lisa は、Woodgrove の企業ロゴが含まれたウェルカム E メールをカスタマイズし、Woodgrove の新入社員ポータルへのリンクを追加したり、社員が Woodgrove からの E メールであることを認識できるように、新入社員のチームメンバーを CC に入れるなどできるようになりました。</p><p><img src="/blog/azure-active-directory/lifecycle-workflows-ga/lifecycle-workflows-ga3.png" alt="新しくオンボードされた従業員のために、会社のロゴと関連情報が一致するようにウェルカム E メールをカスタマイズできます。"></p><p>Lisa は、すべての変更を確認するために [確認と作成] タブをクリックし、次に [スケジュールの有効化] チェックボックスをクリックして、[作成] をクリックしてワークフローを保存します。ワークフローは、テナントのスケジュールに基づいて自動的に実行され、<strong>実行条件</strong> を満たしたユーザーに対してのみ実行されます。</p><h3 id="ステップ-3-ワークフローのステータスを監視する。"><a href="#ステップ-3-ワークフローのステータスを監視する。" class="headerlink" title="ステップ 3: ワークフローのステータスを監視する。"></a>ステップ 3: ワークフローのステータスを監視する。</h3><p>作成、更新、および処理イベントを含め、ライフサイクル ワークフローによって実行されたすべてのアクションは、監査ログレポートに保存されます。さらに、ライフサイクル ワークフローではワークフローの履歴機能を提供しているため、<strong>詳細なレポーティング機能</strong> により、誰に対して何が実行され、それが成功したかを素早く確認することができます。Lisa は選択したワークフローの <strong>ワークフロー履歴</strong> に移動して、ユーザー、実行、タスクのビューでワークフローの処理ステータスをチェックして、トラブルシューティングやコンプライアンスの目的で利用することができます。</p><p><img src="/blog/azure-active-directory/lifecycle-workflows-ga/lifecycle-workflows-ga4.png" alt="ワークフロー履歴からユーザーのワークフローのステータスを確認してトラブルシューティングとコンプライアンスに活用できます。"></p><h2 id="シナリオ-2-タイムリーにアクセスを削除するために従業員のオフボーディング-プロセスを自動化する。"><a href="#シナリオ-2-タイムリーにアクセスを削除するために従業員のオフボーディング-プロセスを自動化する。" class="headerlink" title="シナリオ 2: タイムリーにアクセスを削除するために従業員のオフボーディング プロセスを自動化する。"></a>シナリオ 2: タイムリーにアクセスを削除するために従業員のオフボーディング プロセスを自動化する。</h2><p>もう 1 つの重要な ID ライフサイクルのシナリオは、従業員のオフボーディングです。退職、離職、競合他社への移籍など、従業員をオフボーディングする必要がある理由はさまざまです。オフボーディングの理由にかかわらず、IT 管理者にとって重要なのは、セキュリティ リスクを低減するために、これらのアカウントを無効にし、すべてのリソース アクセスがタイムリーに元従業員から削除されるようにすることです。</p><p>オフボーディング プロセスが数週間前から計画されている場合でも、リアルタイムで行われる場合でも、更には従業員が退職した後のアクセス削除の場合でも、ライフサイクル ワークフローの <strong>組み込みのオフボーディング ワークフロー テンプレート</strong> を用いることで、プロセスを自動化して柔軟に離職処理を行うことが可能となります。</p><p>Tailspinonline 社の IT 管理者である Vance は、オフボーディング プロセスの管理を担当しています。ライフサイクル ワークフローに組み込まれたオフボーディング テンプレートを使用することで、会社のポリシーに基づいて、事前オフボーディング、リアルタイムのオフボーディング、事後オフボーディングのワークフローを事前に設定し、時間を節約することができます。このケースでは、 Vance は競合他社に移る従業員を迅速にオフボーディングする必要があるため、ユーザー アカウントを無効にするとともに、すべての Azure AD グループと Microsoft Teams から削除して、従業員のアクセスを即座にブロックすることとなります。</p><p>それでは、どのように実現するか見てみましょう！</p><h3 id="ステップ-1-シナリオに適した既定のワークフロー-テンプレートを使用してカスタム-ワークフローを設定する。-1"><a href="#ステップ-1-シナリオに適した既定のワークフロー-テンプレートを使用してカスタム-ワークフローを設定する。-1" class="headerlink" title="ステップ 1: シナリオに適した既定のワークフロー テンプレートを使用してカスタム ワークフローを設定する。"></a>ステップ 1: シナリオに適した既定のワークフロー テンプレートを使用してカスタム ワークフローを設定する。</h3><p>Vance は、<a href="https://entra.microsoft.com/#view/Microsoft_AAD_LifecycleManagement/CommonMenuBlade/~/overview">Entra Identity Governance -&gt; Lifecycle Workflows</a> に移動し、[ワークフローの作成] をクリックして、シナリオに合った組み込みのワークフロー テンプレートを選択します。この場合、退職のシナリオに相当するため、[リアルタイムの従業員の退職] ワークフロー テンプレートを選びます。</p><p><img src="/blog/azure-active-directory/lifecycle-workflows-ga/lifecycle-workflows-ga5.png" alt="ライフサイクル ワークフローには、リアルタイムの従業員解雇など、複数の退職者シナリオのテンプレートが含まれています。"></p><p>Vance は、[基本情報] タブからワークフロー名をカスタマイズし、トリガー イベントの詳細がすでに <strong>オンデマンド トリガーとしてトリガー イベント</strong> で構成されていることを確認します。このテンプレートにより、Vance のような IT 管理者は、選択したユーザーに対してワークフローを即座に実行するか、今設定して後で実行するかを選択できるようになります。</p><p>他のオフボーディング シナリオに対しては、彼は従業員の <strong>employeeLeaveDateTime 属性</strong> に基づいて <strong>トリガー</strong> するように、他の定義済みのワークフロー テンプレートから選択できます。この属性は、人事システムから取得されるとします。</p><h3 id="ステップ-2-従業員に対してリアルタイムに実行するタスクをカスタマイズする。"><a href="#ステップ-2-従業員に対してリアルタイムに実行するタスクをカスタマイズする。" class="headerlink" title="ステップ 2: 従業員に対してリアルタイムに実行するタスクをカスタマイズする。"></a>ステップ 2: 従業員に対してリアルタイムに実行するタスクをカスタマイズする。</h3><p>各ワークフロー テンプレートには、シナリオに応じたタスクが <strong>あらかじめ定義</strong> されているため、追加タスクは必須ではありません。しかし、管理者はニーズに合わせてタスクのリストをカスタマイズすることができます。この場合、Vance はテンプレートに、<strong>ユーザーをすべてのグループと Teams から削除し、ユーザー アカウントを削除する</strong> タスクがすでに定義済みであることを確認できます。Vance の会社のポリシーでは、アカウントはオフボーディング後のプロセスの一部として削除されるため、ユーザー アカウントの削除タスクをここでは削除することとします。次に、<strong>ユーザー アカウントを無効にする</strong> タスクを追加し、<strong>従業員がサインインできない</strong> ようにします。</p><p>このテンプレートは、Vance のような IT 管理者に、<strong>今すぐユーザーを選択</strong> し <strong>ワークフローを実行する</strong> か、今すぐワークフローを作成し、<strong>後でユーザーを選択して実行する</strong> かという選択肢を提供します。[ユーザーの選択] タブから、Vance はユーザーを選択し、[確認と作成] タブをクリックし、全ての変更点を確認した後、[作成] をクリックしワークフローを保存します。ワークフローは直ちに Vance が選択したユーザーの処理を開始します。</p><p><img src="/blog/azure-active-directory/lifecycle-workflows-ga/lifecycle-workflows-ga6.png" alt="リアルタイムの従業員の離職ワークフローにおいて必要に応じて複数のユーザーを選択可能です。"></p><h3 id="ステップ-3-ワークフローのステータスの監視する。"><a href="#ステップ-3-ワークフローのステータスの監視する。" class="headerlink" title="ステップ 3: ワークフローのステータスの監視する。"></a>ステップ 3: ワークフローのステータスの監視する。</h3><p>Vance は、選択したワークフローの <strong>ワークフロー履歴</strong> を開き、進捗状況を監視し、退職処理が処理中であるかを確認することができます。オプションとして、個々のタスクのステータスを確認して、問題をチェックすることも可能です。</p><p><img src="/blog/azure-active-directory/lifecycle-workflows-ga/lifecycle-workflows-ga7.png" alt="リアルタイムな従業員のオフボーディング テンプレートを活用することで、従業員の退職と同時に確実にアクセス権を削除できます。"></p><p>リアルタイムの従業員の退職テンプレートを使用することで、Vance はオフボーディング プロセスを自動化し、従業員の離職時にアクセス権が削除されるようにしました。また、オフボーディング プロセスの各タスクが正常に完了したことをワークフローの履歴で確認することで、組織の重要なデータの保護を支援をしました。</p><p><strong>このような新しいライフサイクル ワークフローの機能強化</strong> により、<strong>より細かいワークフローの実行監査</strong> が可能となりました。いつでも <a href="https://entra.microsoft.com/#view/Microsoft_AAD_LifecycleManagement/CommonMenuBlade/~/auditlogs">ライフサイクル ワークフローの監査ログ</a> または <a href="https://entra.microsoft.com/#view/Microsoft_AAD_ERM/DashboardBlade/~/Audit%20logs">Entra Identity Governance の監査ログ</a> に移動して、ワークフロー実行情報やその他のワークフロー管理アクティビティを確認することができます。</p><h2 id="お客様の声"><a href="#お客様の声" class="headerlink" title="お客様の声"></a>お客様の声</h2><p>プレビュー期間中、お客様やパートナー様から素晴らしいフィードバックをいただきました：</p><blockquote><p>「ライフサイクル ワークフローにより、マイクロソフトの Entra プラットフォームにれまで欠けていた Identity Governance の核となる要素が追加され、顧客が望んでいた自動的な JML(Joiner, Mover and Leaver) のユース ケースの課題が解決されました。これは、Entra をクライアントのシステム内の中心的な ID 管理システムとして使用するための大きな一歩となります。」- Erik Siebler (IAM Lead, DXC) </p></blockquote><p><img src="/blog/azure-active-directory/lifecycle-workflows-ga/lifecycle-workflows-ga8.png"></p><blockquote><p>「ライフサイクル ワークフローの製品ビジョンにこれまで期待を寄せていましたが、ようやく現在の入社、異動、退社のワークフローをレガシーな IAM プラットフォームからクラウド ネイティブの IAM ソリューションに移行する未来が見えてきました。すでにいくつかのワークフローをライフサイクル ワークフローに移行し、O365 ライセンス、SMS、マネージャーへのメール通知を含め、店舗やバックオフィスの従業員のオンボーディングを行っています。」- Maqsood Ali Bhatti (IAM Lead, Elkjøp Nordic AS)</p></blockquote><p><img src="/blog/azure-active-directory/lifecycle-workflows-ga/lifecycle-workflows-ga9.png"></p><blockquote><p>「ライフサイクル ワークフローによって、弊社ではついに、新入社員と退職者のプロセスを自動化して、自身とお客様のビジネスをサポートできるようになりました。この強力で素晴らしい機能により、弊社とお客様は共に Azure AD のアカウントのライフサイクルをコントロールして、アカウントを自動的にプロビジョニングおよびデプロビジョニングできるようになりました。」- Pim Jacobs (Principal Consultant, InSpark)</p></blockquote><p><img src="/blog/azure-active-directory/lifecycle-workflows-ga/lifecycle-workflows-ga10.png"></p><blockquote><p>「どのお客様も ID の管理を難しいと感じていますが、弊社では Logic App を使用したり、ハイブリッドな働き方をする従業員に自動化の仕組みを利用してきました。このライフサイクル ワークフローは、様々な Azure サービスと完璧に統合されており、使ったことがなくてもすでに使い慣れることができるというのが、非常に良い点です。どのお客様でも、アカウントの管理は非常に煩雑であり、ライフサイクル ワークフローを使うことで、サードパーティの ID システムやアクセス管理ソリューションを利用するよりもはるかに少ないステップで、簡単に ID ワークフローの構築を開始することができます。この機能は、今後弊社にとって非常に重要なものになるでしょう。」- Nicola Alig (IAM Lead, BaseVision) </p></blockquote><p><img src="/blog/azure-active-directory/lifecycle-workflows-ga/lifecycle-workflows-ga11.png"></p><h2 id="新機能をぜひお試しください"><a href="#新機能をぜひお試しください" class="headerlink" title="新機能をぜひお試しください"></a>新機能をぜひお試しください</h2><p>この新機能をぜひご利用いただきたいと思います。現在 Microsoft Entra ID Premium をご利用のお客様は、2 つの方法で新機能をご利用いただけます:</p><ol><li><a href="https://aka.ms/EntraIDGovTrial">https://aka.ms/EntraIDGovTrial</a> で Microsoft Entra ID Governance のトライアルをセットアップする。</li><li>Microsoft Entra ID Governance にアップグレードする。この方法の場合、ライセンスをオンラインで購入するか、ライセンスパートナー経由で購入するか、Microsoft アカウントチームと連携している場合は Microsoft から直接購入ください。</li></ol><p>Joseph Dadzie<br>Partner Director of Product Management<br>LinkedIn: <a href="https://www.linkedin.com/in/joedadzie">@joedadzie</a><br>Twitter: <a href="https://twitter.com/joe_dadzie">@joe_dadzie</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 中村 です。 &lt;/p&gt;
&lt;p&gt;本記事は、2023 年 7 月 14 日に米国の Microsoft Entra (Azure AD) Blog で公開された &lt;a href=&quot;https://techcommun</summary>
      
    
    
    
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
    <category term="Lifecycle Workflows" scheme="https://jpazureid.github.io/blog/tags/Lifecycle-Workflows/"/>
    
  </entry>
  
  <entry>
    <title>登録キャンペーンによる先進的で強力な認証の推進</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/advancing-modern-strong-authentication/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/advancing-modern-strong-authentication/</id>
    <published>2023-08-18T00:00:00.000Z</published>
    <updated>2023-08-18T17:00:11.273Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 五十嵐 です。</p><p>本記事は、2023 年 7 月 17 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/advancing-modern-strong-authentication/ba-p/3773135">Advancing Modern Strong Authentication</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><div class="alert is-info"><p class="alert-title">Note</p><p>本件の [サインインを改善する] のプロンプトが表示されるアップデートに関しては、Azure AD Free テナントに対しては MC584364 にて、また Azure AD Premium テナントに対しては MC650420 にてアナウンスが行われております。2023 年 8 月 18 日現在、Azure AD Free テナントに対しては本機能の展開が完了しており、MC584364 のメッセージの閲覧可能期限は既に終了している状況です。</p></div><hr><p>以前のブログ <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/it-s-time-to-hang-up-on-phone-transports-for-authentication/ba-p/1751752">“認証に電話網を使うのはそろそろやめよう (It’s Time to Hang Up on Phone Transports for Authentication)”</a> で、SMS や音声などの多要素認証 (MFA) メカニズムの脆弱性について書きました。マイクロソフトの <a href="https://arxiv.org/pdf/2305.00945.pdf">最近の MFA に関する調査研究</a> によると、SMS は <a href="https://www.microsoft.com/ja-jp/security/mobile-authenticator-app">Microsoft Authenticator</a> アプリと比較して、悪意のある攻撃者を阻止する効果が 40％ 低いと結論づけています。</p><p>また、Authenticator の <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/new-microsoft-authenticator-security-features-are-now-available/ba-p/2464386">セキュリティの改善</a> (日本語訳したブログは <a href="https://jpazureid.github.io/blog/azure-active-directory/new-authenticator-security-features/">こちら</a>) にも引き続き取り組んでいます。しかし、電話ベースの認証から脱却することには明確な利点があるにもかかわらず、未だ MFA 要求の約 44% が SMS や音声電話によるものです。悪意のある攻撃者は、電話方式に基づく MFA を悪用し続けているのです。ユーザーを保護するために、是非より強力な認証方法を使用していきましょう。</p><p>本日は、改善に向けて取り組む皆様を支援するために、さらなる取り組みを共有したいと思います。まず、<strong>強力な認証方法の登録キャンペーン機能を改善</strong> し、ユーザーがより良い認証方法を登録できるようにします。そして、FIDO2 のような先進の機能をより多くの環境で利用できるように、<strong>iOS と macOS ブラウザーでの FIDO2 サポート</strong> の一般提供を開始します。</p><h2 id="強力な認証の登録キャンペーン"><a href="#強力な認証の登録キャンペーン" class="headerlink" title="強力な認証の登録キャンペーン"></a>強力な認証の登録キャンペーン</h2><p>2021 年 11 月、Microsoft Authenticator を始めとして最新の認証方法の採用を促進するため、<a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/new-microsoft-authenticator-security-features-are-now-available/ba-p/2464386">登録キャンペーンの機能をリリース</a> しました。リリース以来、何千もの企業がこの機能を利用して最新の認証方法の採用を促進し、130 万人以上のユーザーが Microsoft Authenticator を主要な認証方法として設定し、利用を開始しています。しかしながら、お客様から、最新の強力な認証方法の登録に当たり、より細かく登録動作をコントロールしたいという声をお聞きしました。この声にこたえるため、新しい機能を追加しました。</p><p><img src="/blog/azure-active-directory/advancing-modern-strong-authentication/advancing-modern-strong-authentication1.png" alt="登録キャンペーンのサインイン プロンプト"></p><p>まず始めに、プロンプトのスキップ回数に上限を導入します。最新のアップデートにより、ユーザーは最大 3 回まで登録を延期できるようになります。これにより、キャンペーンの効果を高めつつ、ユーザーは変更に向けて予定や準備に十分な時間をえることができるようになります。</p><p>第二に、設定が “Microsoft マネージド” として設定されている組織の場合、MFA の方法として SMS または音声を利用しているユーザーに対して、この機能を自動的に有効にします。今月 (2023 年 7 月) より、この変更の段階的な展開を開始します。<a href="https://go.microsoft.com/fwlink/p/?linkid=2070717">Microsoft 365 管理センターのメッセージ センター</a> で、管理者に対してこの変更が具体的に組織に影響する時期を通知しますので、ご注目ください。</p><h2 id="iOS-および-macOS-ブラウザーでの-FIDO2-サポートの一般提供開始"><a href="#iOS-および-macOS-ブラウザーでの-FIDO2-サポートの一般提供開始" class="headerlink" title="iOS および macOS ブラウザーでの FIDO2 サポートの一般提供開始"></a>iOS および macOS ブラウザーでの FIDO2 サポートの一般提供開始</h2><p>また、iOS および macOS の Web ブラウザーで、FIDO2 セキュリティキーを使用して Microsoft Entra ID と連携しているアプリケーションにサインインできるようになったことをお知らせします。FIDO2 セキュリティキーは、生体認証要素 (指紋) または PIN によって保護された、強力でフィッシング耐性のある認証を提供します。</p><p>これは、フィッシング耐性のある認証を必要とする大統領令 14028「Improving the Nation’s Cybersecurity (国家のサイバーセキュリティの改善)」に準拠する必要がある米国政府機関など、厳格なコンプライアンス要件がある規制の厳しい組織にとって特に有用です。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/howto-authentication-passwordless-security-key">このページ</a> の指示に従って、FIDO2 セキュリティキーによるパスワードレス サインインを有効化ください。</p><p><img src="/blog/azure-active-directory/advancing-modern-strong-authentication/advancing-modern-strong-authentication2.png" alt="FIDO2 セキュリティキーによるパスワードレス サインイン"></p><p>サポートされるブラウザーのシナリオの詳細については、<a href="https://aka.ms/FIDOMatrix">https://aka.ms/FIDOMatrix</a> (日本語版の公開情報は <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/fido2-compatibility">こちら</a>) を参照ください。</p><p>この取り組みにより、何百万人ものユーザーがより良い MFA の方法を利用するようになることを願っております。</p><p>Alex</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 五十嵐 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 7 月 17 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techc</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>新しい会社のブランド機能が一般公開されました</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/company-branding-ga/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/company-branding-ga/</id>
    <published>2023-08-17T00:00:00.000Z</published>
    <updated>2023-08-18T17:00:11.429Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。 Azure ID チームの小出です。</p><p>本記事は、2023 年 7 月 25 日に公開されました  <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/enhanced-company-branding-for-sign-in-experiences-now-generally/ba-p/3823765">Enhanced Company Branding for Sign-in Experiences Now Generally Available</a> の記事をもとに、分かりやすく日本語におまとめしなおした記事となります。ご不明点などございましたらお気軽にサポートまでお問い合わせください。</p><p>今回の記事では、新しく一般公開 (GA) された「強化された新しい会社のブランド機能」について、詳細をご紹介いたします。</p><hr><p>会社のブランド機能は、2022 年 12 月頃に新しい機能が追加され、以前 <a href="https://jpazureid.github.io/blog/azure-active-directory/introducing-enhanced-company-branding-for-sign-in-experiences/">こちら</a> にてパブリック プレビューの開始をお知らせしました。今回、こちらの機能が一般公開されましたので、これまでプレビューを利用していなかった、もしくは利用できなかったお客様もぜひご利用ください。</p><p>新しい会社のブランド機能について少し下記にて紹介します。具体的に表示をカスタマイズできる項目は下記赤枠および赤文字記載の部分です。</p><p><img src="/blog/azure-active-directory/company-branding-ga/company-branding-ga1.png"></p><p><img src="/blog/azure-active-directory/company-branding-ga/company-branding-ga2.png"></p><h2 id="レイアウトの構成"><a href="#レイアウトの構成" class="headerlink" title="レイアウトの構成"></a>レイアウトの構成</h2><p>サインイン ページにおける各要素の配置を指定することができます。</p><p><img src="/blog/azure-active-directory/company-branding-ga/company-branding-ga3.png"></p><p>たとえば、上記にて「テンプレート」の項目を「一部画面の背景」とすると、通常画面真ん中に表示されるユーザー名入力画面が右側に表示されるようになります。AD FS ではこの右寄りのデザインが既定であるため、AD FS のサインイン画面と一貫性を持たせたい場合は「一部画面の背景」をご利用いただくのも手です。</p><p><strong>全画面の背景</strong></p><p><img src="/blog/azure-active-directory/company-branding-ga/company-branding-ga4.png"></p><p><strong>一部画面の背景</strong></p><p><img src="/blog/azure-active-directory/company-branding-ga/company-branding-ga5.png"></p><p>CSS を利用できるお客様は、下記を利用してカスタム CSS をアップロードすることも可能です。弊社サポートでは、 CSS を代理で作成するようなご支援などは恐縮ながら承っていないため、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/reference-company-branding-css-template">こちらのリファレンス ガイド</a> を利用しお客様側で CSS を作成ください。</p><h2 id="カスタムのセルフ-サービス-パスワード-リセットのハイパーリンク"><a href="#カスタムのセルフ-サービス-パスワード-リセットのハイパーリンク" class="headerlink" title="カスタムのセルフ サービス パスワード リセットのハイパーリンク"></a>カスタムのセルフ サービス パスワード リセットのハイパーリンク</h2><p>この機能により、サインイン ページでのセルフ サービス パスワード リセットのリンクを表示したり、隠したり、カスタマイズすることが可能です。</p><p><img src="/blog/azure-active-directory/company-branding-ga/company-branding-ga6.png"></p><p>下記設定にて「パスワード収集の表示テキスト」に指定した文字列を表示させたり、 URL をカスタマイズしたりすることができます。</p><p><img src="/blog/azure-active-directory/company-branding-ga/company-branding-ga7.png"></p><h2 id="フッターのハイパーリンクのカスタマイズ"><a href="#フッターのハイパーリンクのカスタマイズ" class="headerlink" title="フッターのハイパーリンクのカスタマイズ"></a>フッターのハイパーリンクのカスタマイズ</h2><p>サインイン ページのフッターに表示されるプライバシーと利用規約の URL および表示文字列をカスタマイズいただけます。</p><p><img src="/blog/azure-active-directory/company-branding-ga/company-branding-ga8.png"></p><h2 id="Favicon-の設定"><a href="#Favicon-の設定" class="headerlink" title="Favicon の設定"></a>Favicon の設定</h2><p>ウェブ ブラウザーのタブに表示されるアイコンを設定いただけます。</p><p><img src="/blog/azure-active-directory/company-branding-ga/company-branding-ga9.png"></p><p>設定がアップロードされると、最終的なユーザー体験をご覧いただくことができます。</p><p><img src="/blog/azure-active-directory/company-branding-ga/company-branding-ga10.png"></p><p>Azue AD Premium もしくは Office 365 を利用して、会社のブランド機能をぜひ利用ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。 Azure ID チームの小出です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 7 月 25 日に公開されました  &lt;a href=&quot;https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-b</summary>
      
    
    
    
    
    <category term="Company Branding" scheme="https://jpazureid.github.io/blog/tags/Company-Branding/"/>
    
  </entry>
  
  <entry>
    <title>エンタイトルメント管理 - 新しく一般公開された機能のご紹介</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/entitlement-management-ga/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/entitlement-management-ga/</id>
    <published>2023-08-16T23:00:00.000Z</published>
    <updated>2023-08-18T17:00:11.517Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。 Azure ID チームの小出です。</p><p>本記事は、2023 年 7 月 18 日に公開されました  <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/microsoft-entra-id-governance-entitlement-management-new/ba-p/2466929">Microsoft Entra ID Governance Entitlement Management New Generally Available Capabilities</a>  の記事をもとに、分かりやすく日本語におまとめしなおした記事となります。ご不明点などございましたらお気軽にサポートまでお問い合わせください。</p><p>今回の記事では、エンタイトルメント管理にて、新しく一般公開 (GA) された機能について、それぞれ詳細をご紹介いたします。</p><h2 id="1-カスタム拡張属性を利用したアクセス-パッケージ"><a href="#1-カスタム拡張属性を利用したアクセス-パッケージ" class="headerlink" title="1. カスタム拡張属性を利用したアクセス パッケージ"></a>1. カスタム拡張属性を利用したアクセス パッケージ</h2><p>アクセス パッケージを作成するときに、任意項目なのでスキップしてしまいがちですが、下記のように「カスタム拡張機能」を指定できる機能があります。こちらが一般公開されました。</p><p><img src="/blog/azure-active-directory/entitlement-management-ga/entitlement-management-ga1.png"></p><p>この機能を使うと、アクセス パッケージが割り当てられたときや期限が切れそうなときに、事前に指定したカスタム拡張機能を実行することができます。たとえば上記のスクリーンショットでは、アクセス パッケージの割り当てが行われたことをメール通知するような機能をカスタム拡張機能として指定しています。その他にもカスタム拡張機能の実行のタイミングとして以下を選択可能です。</p><p><img src="/blog/azure-active-directory/entitlement-management-ga/entitlement-management-ga2.png"></p><p>カスタム拡張機能はカタログ内に項目として存在しており、下記から新しい拡張機能を作成することができます。また、以下の例では packageTask1 というロジック アプリに拡張機能を紐づけ、カスタム拡張機能が呼び出されると、このロジック アプリが実行される仕組みになっています。</p><p><img src="/blog/azure-active-directory/entitlement-management-ga/entitlement-management-ga3.png"></p><p>プログラミング スキルがなくても、下記のようなデザイナーを使って、どのような処理を行いたいかを GUI 上で構成することが可能です。</p><p><img src="/blog/azure-active-directory/entitlement-management-ga/entitlement-management-ga4.png"></p><p>なお、恐縮ながらスクリプトの支援と同様、ロジック アプリの具体的な記載方法などについてはサポートでは支援が難しい場合があります。<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-logic-apps-integration">こちらの公開情報</a> を参考いただき、まずはお客様側で実装いただけますと幸いです。</p><p>別途カスタム拡張機能を利用したサンプルなどをまとめしたブログを現在執筆しておりますので、公開次第こちらでもリンクをご紹介します。</p><h2 id="2-アクセス-パッケージの動的割り当てポリシー"><a href="#2-アクセス-パッケージの動的割り当てポリシー" class="headerlink" title="2. アクセス パッケージの動的割り当てポリシー"></a>2. アクセス パッケージの動的割り当てポリシー</h2><p>これまでアクセス パッケージでは、パッケージを割り当てたいユーザーを個別に指定するか、ユーザー側から要求してもらう必要がありましたが、動的割り当てポリシーが用意されたことにより、動的グループや動的管理単位のように、事前に指定したルールをもとにアクセス パッケージをユーザーへ割り当てることができるようになりました。</p><p>作成したアクセス パッケージのポリシー メニューにて、「自動割り当てポリシーの追加」 をクリックすると、下記のように、ルール構文を指定することができます。</p><p><img src="/blog/azure-active-directory/entitlement-management-ga/entitlement-management-ga5.png"></p><p>詳細につきましては、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-access-package-auto-assignment-policy">こちらの公開情報</a> をご確認ください。</p><h2 id="3-エンタイトルメント管理における-Verified-ID"><a href="#3-エンタイトルメント管理における-Verified-ID" class="headerlink" title="3. エンタイトルメント管理における Verified ID"></a>3. エンタイトルメント管理における Verified ID</h2><p>2023 年の春に、Verified ID とエンタイトルメント管理の統合について、パブリック プレビューを開始し、今回機能が一般公開されました。この統合により、Verified ID チェックをアクセス要求管理ワークフローに組み込むことができるようになりました。Verified ID チェックを利用することで、人的ミスを排除して不正アクセスのリスクを低減し、セキュリティを強化することができます。</p><p><img src="/blog/azure-active-directory/entitlement-management-ga/entitlement-management-ga6.png"></p><h2 id="4-条件付きアクセスにおけるエンタイトルメント管理のサポート"><a href="#4-条件付きアクセスにおけるエンタイトルメント管理のサポート" class="headerlink" title="4. 条件付きアクセスにおけるエンタイトルメント管理のサポート"></a>4. 条件付きアクセスにおけるエンタイトルメント管理のサポート</h2><p>条件付きアクセス ポリシーにおいて、エンタイトルメント管理のアプリを指定することができるようになりました。エンタイトルメント管理のアプリケーションは、Azure AD Identity Governance - Entitlement Management となります。たとえば利用シナリオとしては、このエンタイトルメント管理のアプリケーションや My access を条件付きアクセス ポリシーの適用対象外のアプリとして追加することなどが挙げられます。</p><p><img src="/blog/azure-active-directory/entitlement-management-ga/entitlement-management-ga7.png"></p><h2 id="5-My-Access-での検索機能が改善"><a href="#5-My-Access-での検索機能が改善" class="headerlink" title="5. My Access での検索機能が改善"></a>5. My Access での検索機能が改善</h2><p>アクセス パッケージをより効率的に検索できるよう、パッケージの中に含まれるリソースが表示されるようになりました。また、アクセスパッケージ名、説明、リソースなどの追加条件を使用してアクセスパッケージを検索できるようになりました。</p><p><img src="/blog/azure-active-directory/entitlement-management-ga/entitlement-management-ga8.png"></p><p>新しく一般公開されたエンタイトルメント管理の機能をぜひご利用ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。 Azure ID チームの小出です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 7 月 18 日に公開されました  &lt;a href=&quot;https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-b</summary>
      
    
    
    
    
    <category term="Identity Governance" scheme="https://jpazureid.github.io/blog/tags/Identity-Governance/"/>
    
  </entry>
  
  <entry>
    <title>[情報採取] Azure AD Connect に関わる問題などの際に採取、提供いただきたい情報</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory-connect/azure-ad-connect-general-information/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory-connect/azure-ad-connect-general-information/</id>
    <published>2023-08-16T15:00:00.000Z</published>
    <updated>2023-08-18T17:00:11.033Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、日本マイクロソフトの金子です。</p><p>本記事は、 2020 年に初回投稿された記事を、現在の情報採取手順やご案内に見直し更新いたしております。</p><p>Azure AD Connect に関わる問題が発生した場合にテクニカル サポートにお問い合わせいただく際、下記の情報をご提供いただくことで問い合わせがスムーズに行われますので、予め採取をお願いいたします。</p><p>調査過程で追加で採取いただく情報が増える可能性がありますので、予めご了承ください。</p><p>ここでご案内しました情報を事前に取得し、お問い合わせと合わせてご提供いただくことで次のようなメリットがあります。</p><ul><li>お問い合わせに対する回答・問題解決をよりはやくできます。</li><li>後々、再現できなくなり、問題発生時の情報がないために、問題の発生要因を追及できなくなるケースが減らせます。</li><li>サポート エンジニアより情報採取を案内される分のやり取りを減らせます。</li><li>情報があるため、サポート エンジニアがより事象についてより把握した状態でお客様とゴール設定ができます。</li></ul><p>Azure AD Connect トラブルシューティングは大区分として、Azure AD Connect サーバー全般に関わる問題か、特定のオブジェクトに関わる問題かにより調査に必要な情報が異なります。<br>上記内容をスクリプトで一括採取する方法につきましてもご用意させていただいていますので、こちらをもとにシナリオごとに情報を採取してください。</p><p> AADC サーバー情報一括採取ツール</p><p> <a href="https://github.com/jpazureid/aadconnect-diagnostic">https://github.com/jpazureid/aadconnect-diagnostic</a></p><p>なお、シナリオにかかわらず、以下の情報も一括採取ログと併せてお送りいただくと、よりスムーズな対応が可能です。</p><p>a. エラーの画面またはログ抜粋</p><p>　 オブジェクト同期に関わる問題につきましては、Synchronization Service Manager のステータスや詳細が確認できる画面キャプチャなど</p><p>b. テナント名   (例 contoso.onmicrosoft.com)</p><p>c. 発生日時</p><p>d. 現在の状況 (事象が継続中 or 断続的に発生 or 解消済み)</p><p>e. 事象発生前後の状況 (構成変更やアップグレードをした場合には具体的なバージョンなど)</p><h3 id="運用環境にて見慣れないエラーやイベントが発生した場合"><a href="#運用環境にて見慣れないエラーやイベントが発生した場合" class="headerlink" title="運用環境にて見慣れないエラーやイベントが発生した場合"></a>運用環境にて見慣れないエラーやイベントが発生した場合</h3><p>まず、上記の “簡易取得” を実行して取得し、お問い合わせ起票時に下記の情報と合わせて取得済みの旨お知らせください。</p><h3 id="特定のオブジェクトが同期できない・エラーが発生している場合"><a href="#特定のオブジェクトが同期できない・エラーが発生している場合" class="headerlink" title="特定のオブジェクトが同期できない・エラーが発生している場合"></a>特定のオブジェクトが同期できない・エラーが発生している場合</h3><p>上記 “簡易取得” と “オブジェクト情報 (AD/CS/MV) 取得” を実行してください。オブジェクト情報の取得を行うスクリプトを実行する際には、問題が発生しているオブジェクトの情報を指定して実行してください。</p><h3 id="パスワード-ハッシュ同期に失敗している・ユーザーのパスワード-ライトバックができない場合"><a href="#パスワード-ハッシュ同期に失敗している・ユーザーのパスワード-ライトバックができない場合" class="headerlink" title="パスワード ハッシュ同期に失敗している・ユーザーのパスワード ライトバックができない場合"></a>パスワード ハッシュ同期に失敗している・ユーザーのパスワード ライトバックができない場合</h3><p>上記 “簡易取得” と “シナリオトレース (オブジェクト同期、パスワードハッシュ同期、パスワードライトバック)” を実行してください。</p><h3 id="パススルー認証に関する問題の場合"><a href="#パススルー認証に関する問題の場合" class="headerlink" title="パススルー認証に関する問題の場合"></a>パススルー認証に関する問題の場合</h3><p>上記 “簡易取得” と ”シナリオトレース (パススルー認証)” を実行してください。</p><h3 id="Azure-AD-Connect-Health-がうまく稼働しない場合"><a href="#Azure-AD-Connect-Health-がうまく稼働しない場合" class="headerlink" title="Azure AD Connect Health がうまく稼働しない場合"></a>Azure AD Connect Health がうまく稼働しない場合</h3><p>”シナリオトレース (Azure AD Connect Health for Sync)” を実行してください。</p><h3 id="Azure-AD-Connect-インストール-ウィザードが開けない・ウィザードの先の画面に進めない場合"><a href="#Azure-AD-Connect-インストール-ウィザードが開けない・ウィザードの先の画面に進めない場合" class="headerlink" title="Azure AD Connect インストール ウィザードが開けない・ウィザードの先の画面に進めない場合"></a>Azure AD Connect インストール ウィザードが開けない・ウィザードの先の画面に進めない場合</h3><p>”シナリオトレース (構成ウィザード、またはその他のシナリオ)” を実行してください。</p><h3 id="接続面に問題があるようなエラーが発生している場合"><a href="#接続面に問題があるようなエラーが発生している場合" class="headerlink" title="接続面に問題があるようなエラーが発生している場合"></a>接続面に問題があるようなエラーが発生している場合</h3><p>Azure AD Connect の構成ウィザードでは、Active Directory や Azure AD への接続に問題が起きている場合にエラーが発生します。<br>接続の問題が疑われる場合は、 Azure AD Connect 構成ウィザード上のトラブルシューティングを実行し通信面の問題を確認することが可能です。</p><p>Azure AD Connect Sync を使用したオブジェクト同期のトラブルシューティング</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/connect/tshoot-connect-objectsync">https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/connect/tshoot-connect-objectsync</a></p><ol><li>Azure AD Connectインストール サーバー上で PowerShell を管理者として起動します。</li><li>Set-ExecutionPolicy RemoteSigned または Set-ExecutionPolicy Unrestricted を実行します。</li><li>続いてスタート メニューより [Azure AD Connect] を選択し、 Azure AD Connect 構成ウィザードを起動します。</li><li>[追加のタスク] – [トラブルシューティング] に移動し、 [次へ] を選択します。</li><li>PowerShell ウィンドウが起動するので、 Azure AD の通信状況を確認したい場合には「5」、オンプレミス AD の通信状況を確認したい場合には「6」を入力して Enter を押します。</li></ol><p> <img src="/blog/azure-active-directory-connect/azure-ad-connect-general-information/azure-ad-connect-general-information1.png"></p><ol start="6"><li>結果が表示されます。通信に問題がある場合にはエラーが表示されるので内容を基にトラブルシューティングを実施ください。</li></ol><p>また、弊社までお問い合わせ頂く際に合わせてエラー内容をお知らせ頂けますと調査をスムーズに行うことができる可能性がありますので、お問い合わせ時に共有いただけますと幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、日本マイクロソフトの金子です。&lt;/p&gt;
&lt;p&gt;本記事は、 2020 年に初回投稿された記事を、現在の情報採取手順やご案内に見直し更新いたしております。&lt;/p&gt;
&lt;p&gt;Azure AD Connect に関わる問題が発生した場合にテクニカル サポートにお問い合わせ</summary>
      
    
    
    
    
    <category term="情報採取" scheme="https://jpazureid.github.io/blog/tags/%E6%83%85%E5%A0%B1%E6%8E%A1%E5%8F%96/"/>
    
    <category term="Azure AD Connect" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-Connect/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Entra ID Governance の新しいダッシュボードが近々公開されます</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/new-microsoft-entra-id-governance-dashboard-experience-rolling/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/new-microsoft-entra-id-governance-dashboard-experience-rolling/</id>
    <published>2023-07-30T02:00:00.000Z</published>
    <updated>2023-08-18T17:00:11.781Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 高田 です。</p><p>本記事は、2023 年 7 月 19 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/new-microsoft-entra-id-governance-dashboard-experience-rolling/ba-p/2466928">New Microsoft Entra ID Governance Dashboard Experience Rolling Out Soon</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>2023 年 6 月 7 日に発表しましたとおり、Microsoft Entra ID Governance は現在 <strong>一般利用可能</strong> となり、より効率的にアクセス管理行いたいとお考えの企業様に新しい機能を提供しています。もしあなたが組織の IT 計画を立案および実行するような立場の場合、適切な人々が適切なリソースを適切な時間だけアクセスできるようにするというのは、ビジネス上の目標でもあり、ご自身の重要な職務でもあろうと思います。また、ID のガバナンス – 誰がいつ何にアクセスし、その理由は何なのかを把握すること – はゼロ トラストにおいてその基礎となるものです。ID のガバナンスと管理 (IGA) を推進するビジネス上の目標が何であれ、ビジネスの利害関係者に分かりやすい形で IGA の状況を示すことが重要性となっています。お客様からもこの声を頂戴しており、弊社としてその声に是非お応えしたいと思っています。</p><p>そこで、新たな Microsoft Entra ID Governance のダッシュボードを作成しました。このダッシュボードは、情報をまとめて現在の ID ガバナンスの状態を一目で把握できるよう表示するとともに、IGA の様々な機能を起動して、コンプライアンスのレポートへ素早くアクセス出来るような機能を提供します。ID のガバナンスを実現するには長い道のりを要するため、お客様によりその進み具合は様々と思われます。</p><ul><li>まだ ID ガバナンスの取り組みを始めたばかりの場合は、まずダッシュボードを使用して IT 環境がどのような状況となっているかをご確認ください。テナント内のユーザーとゲストの数を特定し、業務アプリと特権ロールを把握ください。また、Entra ID Governance がどのような機能を提供しているかご覧いただき、必要なセキュリティとコンプライアンスに対応する実施計画を作成頂ければと思います。</li><li>すでにガバナンス機能を展開し利用している場合は、ダッシュボードを使用して現在のガバナンスへの取り組みが全体のどの程度をカバーできているか把握し、実体と取り組みのギャップを確認ください。例えば、<a href="https://go.microsoft.com/fwlink/?linkid=2210375">エンタイトルメント管理</a> を使用してユーザーへのアクセス権の付与を自動化しているかもしれませんが、定期的な <a href="https://go.microsoft.com/fwlink/?linkid=2211313">アクセス レビュー</a> を設定していないということもあると思います。ダッシュボードのリンクを使用して、ID ガバナンスの状態をさらに改善ください。</li></ul><p>今後、ID Governance ダッシュボードをさらに進化させて、セキュリティとコンプライアンスのニーズにより対応したユーザー体験を提供するとともに、セットアップや構成の必要性をなくして、さらに利用しやすくしていく予定です。</p><h2 id="Microsoft-Entra-ID-Governance-ダッシュボードの使用方法"><a href="#Microsoft-Entra-ID-Governance-ダッシュボードの使用方法" class="headerlink" title="Microsoft Entra ID Governance ダッシュボードの使用方法"></a>Microsoft Entra ID Governance ダッシュボードの使用方法</h2><p><img src="/blog/azure-active-directory/new-microsoft-entra-id-governance-dashboard-experience-rolling/img.png"></p><p>ダッシュボードにアクセスするには、Microsoft Entra 管理センターにサインインし、”Identity Governance” の下の “Dashboard” ブレードを選択ください。</p><div class="alert is-info"><p class="alert-title">Note</p><p>お使いのテナントではまだ機能が有効になっておらず、ブレードが存在しない場合がございます。</p></div><p>ダッシュボードは次のようなコンポーネントで構成されています。</p><ul><li><strong>一覧性に優れたカード</strong>: これらのカードは、従業員、ゲスト、特権 ID、およびアプリケーションのアクセスのガバナンスの観点から、テナントで何が起きているかについての概要レベルの情報を提供します。カードのナビゲーション リンクをクリックすると、ID Governance のクイック スタート ガイドとチュートリアルにジャンプします。</li><li><strong>ID Governance のステータス</strong>: この画面は、従業員、ゲスト、業務アプリ、グループ、特権ロールの数という観点から ID の全体像を表示します。そして、これら従業員などの要素をよりよく管理するための各 Microsoft Entra ID Governance の機能を提示します。まだ機能を利用しておらず構成されていない場合は、ボタンを押してその機能の設定ブレードを開く事も可能です。</li><li><strong>チュートリアル</strong>: このセクションには、よく利用される ID Governance の使用例のチュートリアルが表示されます。</li><li><strong>ハイライト</strong>: このセクションでは、最新の ID Governance 機能について情報を得たり、他のお客様が ID Governance をどのように使用してセキュリティとコンプライアンスの状態を改善しているかを学んだすることが可能です。</li></ul><p>この新しいダッシュボードについて詳しく知るためには、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/governance/governance-dashboard">Microsoft Entra ID Governance ダッシュボード</a> の記事をご覧ください。</p><h2 id="是非お試しください"><a href="#是非お試しください" class="headerlink" title="是非お試しください"></a>是非お試しください</h2><p>これらの新機能をぜひ皆さんに試していただきたいと思っています！現在 Microsoft Entra ID Premium ライセンスをお持ちのお客様は、以下の 2 つのいずれかの方法で新しい機能をご利用いただけます:</p><ol><li><a href="https://aka.ms/EntraIDGovTrial">https://aka.ms/EntraIDGovTrial</a> から Microsoft Entra ID Governance のトライアルを開始する。</li><li>オンラインもしくはライセンス パートナーを通じてか、Microsoft の営業チームと連携している場合は直接 Microsoft から Microsoft Entra ID Governance にアップグレードする。</li></ol><p>Joseph Dadzie<br>Partner Director of Product Management<br>LinkedIn: <a href="https://www.linkedin.com/in/joedadzie/">@joedadzie</a><br>Twitter: <a href="https://twitter.com/joe_dadzie">@joe_dadzie</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 高田 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 7 月 19 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Entra ワークロード ID の新しい App Health 推奨機能</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/new-app-health-recommendations-in-microsoft-entra-workload-identities/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/new-app-health-recommendations-in-microsoft-entra-workload-identities/</id>
    <published>2023-07-30T01:00:00.000Z</published>
    <updated>2023-08-18T17:00:11.773Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 名取 です。</p><p>本記事は、2023 年 6 月 29 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/new-app-health-recommendations-in-microsoft-entra-workload/ba-p/2959984">New App Health Recommendations in Microsoft Entra Workload Identities</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>先日、弊社では <a href="https://query.prod.cms.rt.microsoft.com/cms/api/am/binary/RW10qzO">2023 年クラウドにおけるアクセス許可のリスク状態</a> のレポートを発表し、クラウド環境の拡大だけでなく、重要なクラウド リソースにアクセスする ID の種類の増加に関して非常に興味深い調査結果を公表しました。このレポートでは、ワークロード ID のセキュリティ保護がこれまで以上に重要になっている理由について興味深い調査結果が明らかにされています:</p><ul><li>ワークロード ID は、人間の ID を 10:1 で上回り、2021 年の 2 倍になりました。この大幅な増加により、新たなセキュリティ リスクが生じています。</li><li>ワークロード ID の 80% 以上が非アクティブであり、2021 年に報告された割合の 2 倍となっています。</li><li>ワークロード ID は付与されたアクセス許可の 5% 未満しか使用していません。</li><li>ワークロード ID の約 70% が機密データにアクセスできます。</li></ul><p>膨大な数の非アクティブなワークロード ID と資格情報が存在するということは、特にその多くが高いアクセス許可を持っており、クラウド全体で動作していることを考えると、大幅なリスク軽減の機会となります。非アクティブな ID や古い認証情報は侵害のターゲットになりやすく、通常は削除しても影響はありませんが、資格情報の有効期限が切れると障害がにつながる可能性もあります。</p><p>Kuppinger Cole のホワイトペーパー<a href="https://www.kuppingercole.com/reprints/cb05bfdbbdb25b6535a42835b77465e2#heading1">Securing Non-Human Identities</a> によると、直近での大きな変化は、ワークロード ID を含む人間以外の ID の数と種類が急速に増加していることです。ビジネス リスク、セキュリティ リスク、コンプライアンス リスクにさらされないように、適切に ID を管理することはますます難しくなっています。</p><p>人間以外の ID に関する新たな問題を解決するために、<a href="https://jpazureid.github.io/blog/azure-active-directory/managing-governing-and-securing-identities-for-apps-and-services/">2022 年 11 月に Microsoft Entra Workload Identities</a> を発表しました。これにより、企業はワークロード ID に対して条件付きアクセス、ID Protection、資格情報ポリシー、およびアクセス レビューを構成できるようになります。つまり、ユーザーとは異なる動作をしている可能性のあるワークロードのリスクを検出して修正することが可能になります。</p><p>どの ID に危険な構成があるのか​​、または完全に削除する必要があるのかどうか​​を容易に確認することが非常に重要になっています。そのため、Microsoft Entra ワークロード ID 内の新機能であるアプリの正常性に関する推奨事項をこの度発表いたします。</p><h2 id="App-Health-推奨事項によるアプリの正常性強化"><a href="#App-Health-推奨事項によるアプリの正常性強化" class="headerlink" title="App Health 推奨事項によるアプリの正常性強化"></a>App Health 推奨事項によるアプリの正常性強化</h2><p>ワークロード ID の 80% 以上が非アクティブであるため、これらのアプリやサービスを可視化することは非常に重要です。Microsoft Entra ワークロード ID のアプリの正常性に関する推奨機能は、システム環境を保護し、推奨されるベスト プラクティスに従って障害を回避するのに役立つ知見と実用的なガイダンスを提供します。例えば、30 日以上使用されていないアプリケーションへの対処、未使用のアプリケーションの資格情報の削除、期限切れが近い資格情報の更新などです。</p><p>未使用のアプリケーションおよび未使用のアプリケーション認証情報を削除することで、ワークロード ID 全体のセキュリティ体制が向上し、良好な ID の状態が実現されます。これにより、攻撃者が未使用のアプリケーションを発見して悪用するなどの侵害のリスクが軽減されます。未使用の ID に付与されたアクセス許可によっては、組織の機密データの漏洩につながったり、攻撃者がより攻撃の幅を広げてしまう可能性があります。</p><h2 id="推奨事項とその対処方法"><a href="#推奨事項とその対処方法" class="headerlink" title="推奨事項とその対処方法"></a>推奨事項とその対処方法</h2><p>これらの新機能は、<a href="https://learn.microsoft.com/azure/active-directory/reports-monitoring/overview-recommendations">Azure AD の推奨事項</a> で利用可能です。各推奨事項には、問題の説明、アクションを実行する利点、段階的な改善手順を含むアクション プランが含まれています。Microsoft Entra ワークロード ID の一部として最初に提供される、3 つのアプリの正常性に関する推奨事項は次のとおりです:</p><ol><li>未使用のアプリケーション</li><li>未使用のアプリケーション資格情報</li><li>期限切れのアプリケーション資格情報</li></ol><p>推奨事項の <strong>状態</strong> は、手動かシステムによって自動で更新されます。すべてのリソースがアクション プランに従って対処されると、その次に推奨事項のサービスが実行されるときに、推奨事項のステータスが自動的に「完了」に変わります。</p><p><img src="/blog/azure-active-directory/new-app-health-recommendations-in-microsoft-entra-workload-identities/new-app-health-recommendations-in-microsoft-entra-workload-identities.png"></p><p>上記画面を確認し、最善の対応を行うには、以下の手順を実施ください:</p><p>　1. Microsoft Entra 管理センター &gt; Azure AD &gt; [概要] に移動し、[推奨設定] を選択します。<br>　2. リストから推奨事項を選択すると、詳細、状態、アクション プランが表示されます。<br>　3. アクション プランに従い操作を行います。<br>　4. 該当する場合は、推奨事項内のリソースのステータスをクリックし、[次としてマーク] を選択してステータスを選択します。</p><p> Microsoft Graph を使用してアプリの正常性に関する推奨事項を操作したい場合は、<a href="https://learn.microsoft.com/en-us/azure/active-directory/reports-monitoring/howto-use-recommendations?toc=/azure/active-directory/workload-identities/toc.json&bc=/azure/active-directory/workload-identities/breadcrumb/toc.json">こちらのドキュメント</a> を参照ください。</p><h2 id="アプリの正常性に関する推奨事項を今すぐ試してベスト-プラクティスを実施ください"><a href="#アプリの正常性に関する推奨事項を今すぐ試してベスト-プラクティスを実施ください" class="headerlink" title="アプリの正常性に関する推奨事項を今すぐ試してベスト プラクティスを実施ください"></a>アプリの正常性に関する推奨事項を今すぐ試してベスト プラクティスを実施ください</h2><p>クラウド基盤にアクセスするワークロード ID が増加し続ける中、企業が攻撃や停止のリスクを軽減するために、セキュリティ体制を見直すことが重要です。</p><p><strong>参考情報:</strong></p><ul><li>人間以外の ID、アクセス許可のリスクについて詳しく知り、Microsoft Entra ワークロード ID と Permissions Management の概要を把握するには、この <a href="https://www.kuppingercole.com/reprints/cb05bfdbbdb25b6535a42835b77465e2#heading1">Kuppinger Cole whitepaper</a> と <a href="https://query.prod.cms.rt.microsoft.com/cms/api/am/binary/RW10qzO">2023 年のクラウド アクセス許可リスクの状況レポート</a> を参照ください。</li><li>Microsoft Entra のワークロード ID のベスト プラクティスの詳細については、以下を参照ください:<ul><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/identity-protection/concept-workload-identity-risk">ワークロード ID をセキュリティで保護する</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/zero-trust-for-developers">ゼロ トラストの原則を使用してアプリケーションのセキュリティを強化する</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/security-best-practices-for-app-registration">Azure Active Directory でのアプリケーション プロパティのセキュリティに関するベスト プラクティス</a></li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 名取 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 6 月 29 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Entra ID における制限付き管理の管理単位の紹介</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/introducing-restricted-management-au-in-microsoft-entra-id/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/introducing-restricted-management-au-in-microsoft-entra-id/</id>
    <published>2023-07-30T00:00:00.000Z</published>
    <updated>2023-08-18T17:00:11.685Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 北村 です。</p><p>本記事は、2023 年 7 月 12 日に米国の Microsoft Entra (Azure AD) Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/introducing-restricted-management-administrative-units-in/ba-p/3867839">Introducing Restricted Management Administrative Units in Microsoft Entra ID</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>Microsoft Entra ID の新しいロールベースのアクセス制御 (RBAC) 機能である、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/roles/admin-units-restricted-management">制限付き管理の管理単位</a> のパブリック プレビューを共有できることを嬉しく思います。</p><h2 id="制限付き管理の管理単位でできること"><a href="#制限付き管理の管理単位でできること" class="headerlink" title="制限付き管理の管理単位でできること"></a>制限付き管理の管理単位でできること</h2><p>制限付き管理の管理単位を使用すると、Microsoft Entra ID テナント内の特定のユーザー、セキュリティ グループ、またはデバイスを指定して、それらをテナント レベルの管理者から変更ができないようにすることが可能となります。</p><p>これは以下のような場合に有用です： </p><ul><li>役員など、機密性の高いユーザー アカウントを、通常のヘルプデスク管理者によるパスワードや多要素認証設定の変更から保護したい。</li><li>特定の国の特定のユーザー アカウント、セキュリティ グループ、またはデバイスを、その国の指定された管理者のみが変更できるようにしたい。</li><li>機密データへのアクセスを許可する特定のセキュリティ グループがあり、そのメンバーシップを変更できる人を一部の管理者に限定したい。</li></ul><p>機密オブジェクトを制限付き管理の管理単位に配置することで、テナント レベルの管理者はそれらのオブジェクトを変更できなくなります。 管理単位自体のスコープに明示的に割り当てた管理者だけが変更を加えることができます。</p><p><img src="/blog/azure-active-directory/introducing-restricted-management-au-in-microsoft-entra-id/restricted-management-administrative-units1.png" alt="テナント スコープの管理者およびその他の管理単位スコープの管理者は、役員のアカウント パスワードをリセットできません。 これらのアカウントを管理できるのは、明示的に指定された管理単位の管理者のみです。"> </p><p>機密性の高いオブジェクトと、その他の機密性の低いオブジェクトを同列に扱うよりも、このように管理単位でまとめる方が遥かに簡単です。</p><h2 id="お使いのテナントで制限付き管理の管理単位を使用する方法"><a href="#お使いのテナントで制限付き管理の管理単位を使用する方法" class="headerlink" title="お使いのテナントで制限付き管理の管理単位を使用する方法"></a>お使いのテナントで制限付き管理の管理単位を使用する方法</h2><p>ここでは、制限付き管理の管理単位を使用して、テナント内の機密性の高いユーザー アカウントを簡単に保護する例を示します： </p><ol><li><strong>[役割と管理者]</strong> で <strong>[管理単位]</strong> を選択し、 <strong>[追加]</strong> をクリックして新しい管理単位を作成します。</li></ol><p><img src="/blog/azure-active-directory/introducing-restricted-management-au-in-microsoft-entra-id/restricted-management-administrative-units2.png">  </p><ol start="2"><li><strong>[制限付き管理の管理単位]</strong> を [はい] に設定し、[次へ: ロールの割り当て] をクリックします。</li></ol><p><img src="/blog/azure-active-directory/introducing-restricted-management-au-in-microsoft-entra-id/restricted-management-administrative-units3.png">  </p><ol start="3"><li>機密性の高いアカウントのヘルプデスク管理者となるべき管理者（アカウントを管理したい人）を追加し、管理単位の作成を完了します。</li></ol><p><img src="/blog/azure-active-directory/introducing-restricted-management-au-in-microsoft-entra-id/restricted-management-administrative-units4.png"> </p><ol start="4"><li>この段階で、(他の管理単位の場合と同様に) 作成した制限付き管理の管理単位に、機密性の高いユーザー アカウントを追加することができます。</li></ol><p><img src="/blog/azure-active-directory/introducing-restricted-management-au-in-microsoft-entra-id/restricted-management-administrative-units5.png"> </p><p>これで完了です！ これで、テナント内で他の管理ロールがどれだけ割り当てられていても、機密性の高いユーザー アカウントは指定したユーザーのみが変更できるようになります。</p><p>制限付き管理の管理ユニットがテナント内の機密リソースの保護にどのように役立つかの詳細については、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/roles/admin-units-restricted-management">製品ドキュメント</a> をご覧ください！</p><p>よろしくお願いします。</p><p>Stuart Kwan<br>Partner Manager, Product Management<br>Microsoft Identity Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 北村 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 7 月 12 日に米国の Microsoft Entra (Azure AD) Blog で公開された &lt;a href=&quot;https://techcommuni</summary>
      
    
    
    
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
    <category term="Microsoft Entra" scheme="https://jpazureid.github.io/blog/tags/Microsoft-Entra/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD Connect インストール前の確認事項</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory-connect/checklist-before-installing-aad-connect/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory-connect/checklist-before-installing-aad-connect/</id>
    <published>2023-07-25T15:00:00.000Z</published>
    <updated>2023-08-18T17:00:11.053Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure &amp; Identity サポート チームです。<br>Azure AD Connect の新規構築、サーバー移行時に多くお問い合わせいただく事前に確認点をお纏めいたしました。<br>大きく分けて要件としては下記となります。</p><ul><li>A. Azure AD Connect の要件</li><li>B. Azure AD Connect Health Agent の要件</li><li>C. 認証方法による要件</li><li>D. パスワードライトバック機能</li></ul><p>それぞれの要件につきまして、良くあるご質問、技術情報を含め纏めさせていただきました。</p><h2 id="A-Azure-AD-Connect-の要件"><a href="#A-Azure-AD-Connect-の要件" class="headerlink" title="A. Azure AD Connect の要件"></a>A. Azure AD Connect の要件</h2><p>Azure AD Connect 自体の要件としては下記技術情報のとおりとなります。</p><ul><li>Azure AD Connect の前提条件<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-install-prerequisites">https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-install-prerequisites</a></li></ul><h3 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="[Q&amp;A]"></a>[Q&amp;A]</h3><hr><ul><li>Q. Azure AD Connect をドメイン コントローラー上にインストールして問題ないか ?</li><li>A. 技術的には共存させることは可能ですが、運用面やトラブル シューティング観点では、別のサーバーに構築する方が安心です。Azure AD Connect もドメイン コントローラーと同等のセキュリティで保護することを推奨していますが、ドメイン コントローラーには特に厳しい制限を課していることが一般的となりますため、通信やセキュリティの要件などを考慮し、お客様側で判断してください。</li></ul><hr><ul><li>Q. Azure AD Connect を他のサービスが稼働している既存のサーバーに構成しても問題か？</li><li>A. 各要件を満たしている場合には特に技術的な制約はありませんが、弊社としてはドメイン コントローラーと同様、機能ごとにサーバーを分けることを推奨しています。<br>運用面にてメンテナンスやセキュリティ面での可用性を確保できるように構成してください。</li></ul><hr><ul><li>Q. Azure AD Connect をスタンドアローン (ワークグループ) で構成可能か。</li><li>A. 構成自体はカスタム インストールにて行うことが可能ですが、ドメイン メンバー サーバーに構成する必要があります。</li></ul><hr><h2 id="B-Azure-AD-Connect-Health-Agent-for-Sync-の要件"><a href="#B-Azure-AD-Connect-Health-Agent-for-Sync-の要件" class="headerlink" title="B. Azure AD Connect Health Agent for Sync の要件"></a>B. Azure AD Connect Health Agent for Sync の要件</h2><p>Azure AD Connect に同梱されている Azure AD Connect Health Agent for Sync を構成する場合、プロキシ構成や要件は Azure AD Connect とは別に用意されています。<br>弊社に Azure AD Connect インストール時にこの要件 (主にネットワーク関連の設定箇所) を満たしていないことでインストール ウィザードで警告が表示されるなどのお問い合わせを多くいただいております。<br>各エンドポイント、プロキシの設定をインストール前に確認をお願いします。</p><ul><li>Azure AD Connect Health エージェントのインストール<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-health-agent-install">https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-health-agent-install</a></li></ul><h3 id="Q-amp-A-1"><a href="#Q-amp-A-1" class="headerlink" title="[Q&amp;A]"></a>[Q&amp;A]</h3><hr><ul><li>Q. Azure AD Connect Health Agent をインストールし、同期対象となるテナントにて Azure AD Premium ライセンスがないが問題ないか ?<br>A. インストール自体の処理やライセンス規約などに問題は起きません。<br> ただし、 Azure ポータルからの監視機能が使用できないなどの制約が生じます。</li></ul><hr><p> </p><ul><li>Q. Azure AD Connect Health Agent for Sync を誤ってアンインストールしてしまった場合の対象方法を教えてください。</li><li>A. Azure AD Connect のインストール ウィザードを再試行することで再インストールされます。</li></ul><hr><ul><li>Q. Azure AD Connect Health Agent for Sync 単体でアップグレード可能か ?</li><li>A. いいえ、Azure AD Connect に同梱となり単体でのアップグレードは行えません。 </li></ul><hr><h2 id="C-認証方法による要件"><a href="#C-認証方法による要件" class="headerlink" title="C. 認証方法による要件"></a>C. 認証方法による要件</h2><p>Azure AD Connect で構成する認証方式 (パスワード ハッシュ同期 (PHS) かパススルー認証) により要件は異なります。</p><h3 id="C-1-パスワード-ハッシュ同期-PHS"><a href="#C-1-パスワード-ハッシュ同期-PHS" class="headerlink" title="C-1. パスワード ハッシュ同期 (PHS)"></a>C-1. パスワード ハッシュ同期 (PHS)</h3><p>パスワード ハッシュ同期では Azure AD Connect のインストール要件を満たしていれば、追加でポートの開放や設定は不要となります。</p><ul><li>Azure AD Connect 同期を使用したパスワード ハッシュ同期の実装<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-password-hash-synchronization">https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-password-hash-synchronization</a></li></ul><p> </p><h3 id="C-2-パススルー認証"><a href="#C-2-パススルー認証" class="headerlink" title="C-2. パススルー認証"></a>C-2. パススルー認証</h3><p>パススルー認証エージェント (PTA) は Azure AD Connect をインストールするサーバーが 1 台目となり、他のサーバーに PTA を別途インストールすることにより複数台で構成することを推奨しています。<br>PTA をインストールするサーバーでは上述の A. B. とは別にネットワーク要件を満たす必要があります。<br> <br>ファイアウォールでの構成にて各エージェントの要件は下記となります。</p><ul><li>Azure Active Directory パススルー認証: クイック スタート - 手順 1: 前提条件を確認する<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-pta-quick-start#step-1-check-the-prerequisites">https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-pta-quick-start#step-1-check-the-prerequisites</a></li></ul><p>プロキシを経由し Azure AD と接続する場合には、WPAD が構成されていない環境の場合には下記技術情報に記載のとおり構成ファイルを編集する必要があります。</p><ul><li>パススルー認証エージェントは、送信 Web プロキシ サーバーで通信できますか。<br><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/connect/how-to-connect-pta-faq#------------------web-------------------">https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/connect/how-to-connect-pta-faq#------------------web-------------------</a></li></ul><h3 id="Q-amp-A-2"><a href="#Q-amp-A-2" class="headerlink" title="[Q&amp;A]"></a>[Q&amp;A]</h3><hr><ul><li>Q. パスワード ハッシュ同期を複数の Azure AD Connect サーバーで構成することが可能か。</li><li>A. いいえ、できません。パスワード ハッシュ同期はアクティブの Azure AD Connect サーバーでのみ行われます。その他の Azure AD Connect サーバーはステージング サーバーとなり、パスワード ハッシュ同期が有効化されている場合も、動作は停止しています。</li></ul><hr><ul><li>Q. PTA の必要数は ?</li><li>A. 1 台で動作はしますが、下記技術情報のとおり、運用環境では 3 つ以上実行することを推奨しております。Azure AD Connect 1 台 (PTA 1 台目) + PTA 2 台目 + PTA 3 台目<br>  <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-pta-quick-start#step-1-check-the-prerequisites">https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-pta-quick-start#step-1-check-the-prerequisites</a></li></ul><h2 id="D-パスワードライトバック機能"><a href="#D-パスワードライトバック機能" class="headerlink" title="D. パスワードライトバック機能"></a>D. パスワードライトバック機能</h2><p>パスワードの書き戻しを有効とした場合には、Azure AD から Active Directory へのパスワードの書き戻し処理のために下記の要件を満たす必要があります。 </p><ul><li>オンプレミス Active Directory への書き込み権限<br>Azure AD Connect に対するアカウントのアクセス許可を構成する<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/tutorial-enable-sspr-writeback#configure-account-permissions-for-azure-ad-connect">https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/tutorial-enable-sspr-writeback#configure-account-permissions-for-azure-ad-connect</a></li></ul><blockquote><p>[補足]<br>セルフパスワード リセット サービス (SSPR) を構成する場合には、下記 URL およびデータセンター IP  アドレスへの送信 HTTPS アクセスが許可される必要があります。<br>  *.passwordreset.microsoftonline.com<br>  *.servicebus.windows.net<br> <br>  Microsoft Azure Datacenter IP Ranges<br>  <a href="https://www.microsoft.com/en-us/download/details.aspx?id=41653">https://www.microsoft.com/en-us/download/details.aspx?id=41653</a> </p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure &amp;amp; Identity サポート チームです。&lt;br&gt;Azure AD Connect の新規構築、サーバー移行時に多くお問い合わせいただく事前に確認点をお纏めいたしました。&lt;br&gt;大きく分けて要件としては下記となります。&lt;/p&gt;
&lt;ul&gt;
</summary>
      
    
    
    
    
    <category term="Azure AD Connect" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-Connect/"/>
    
  </entry>
  
  <entry>
    <title>Health service data is not up to date. の通知メールについて</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory-connect/azure-ad-connect-health-notification/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory-connect/azure-ad-connect-health-notification/</id>
    <published>2023-07-24T15:00:00.000Z</published>
    <updated>2023-08-18T17:00:11.037Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>本記事は Technet Blog の更新停止に伴い <a href="https://blogs.technet.microsoft.com/jpazureid/2018/03/01/aadc-health-notification/">https://blogs.technet.microsoft.com/jpazureid/2018/03/01/aadc-health-notification/</a> の内容を移行したものです。</p><p>元の記事の最新の更新情報については、本内容をご参照ください。</p><p>2018 年 3 月 1 日に「Azure AD Connect Health Notification メールについて」 として公開しておりましたが、情報が古くなってまいりましたので、 2023 年 7 月 25 日時点の最新情報として改めて更新のうえ公開しております。</p></div><p>こんにちは！ Azure Identity サポートの小出です。  </p><p>Azure AD Connect を利用してオンプレミスと Azure AD を連携している環境で最近 (2018 年 2 月) 突然次のような通知メールが届いているケースがあると思います。<br>この通知メールについて Q&amp;A 形式で纏めました。  </p><p>&lt;本文サンプル&gt;<br><img src="/blog/azure-active-directory-connect/azure-ad-connect-health-notification/notification1.png"></p><p><img src="/blog/azure-active-directory-connect/azure-ad-connect-health-notification/notification2.png"></p><h2 id="Q-このメールは何を通知しているのか？"><a href="#Q-このメールは何を通知しているのか？" class="headerlink" title="Q. このメールは何を通知しているのか？"></a>Q. このメールは何を通知しているのか？</h2><p>A. Azure AD Connect Health Agent による Azure データセンターへの正常性データのアップロードが RAISED (発生日時) から RESOLVE (解決日時) まで行われていなかったことを通知しています。<br>Azure AD Connect はオンプレミスの Active Directory のユーザー情報を Azure AD に同期しますが、その他にもオンプレミスのサーバーの監視をおこなう Azure AD Connect Health Agent というエージェントがあります。<br>このエージェントは定期的にオンプレミスの監視対象とするサーバーの情報を Azure AD にアップロードします。<br>今回の通知は、そのアップロードが一定期間  RAISED (発生日時) から RESOLVE (解決日時) まで、行えていなかったことを管理者に通知しています。<br>Azure AD Connect Health Agent サービスによるアップロードが 2 時間以上行われていないと Azure Portal 上にそのことを示す通知が行われます。<br>Azure Portal : URL:<a href="https://aka.ms/aadconnecthealth">https://aka.ms/aadconnecthealth</a>  </p><p>メールは上記サンプルのように、基本的には発生した時と解消した時の2回通知されます。</p><h2 id="Q-Resolved-だが、監視通信は正常な状態になっているのか？"><a href="#Q-Resolved-だが、監視通信は正常な状態になっているのか？" class="headerlink" title="Q. [Resolved] だが、監視通信は正常な状態になっているのか？"></a>Q. [Resolved] だが、監視通信は正常な状態になっているのか？</h2><p>A. “監視通信が行えていない” という情報が削除された結果であり、実際に監視通信が正常ではない状態が継続している可能性があります。  </p><p>例えば、Azure AD Connect (AADC) サーバーを数時間程度シャットダウンした場合には、停止後から約 2 時間で監視通信が行えていない内容の通知メールが送付され、起動後から約 2 時間で監視通信が再開できた (今回の通知メールと同じ内容の) 通知メールが送付されます。<br>そのため、1 つの目安として通知メール内の “RAISED (問題発生日時)” と “RESOLVE (問題解決日時)” を参照し、メンテナンスや意図した作業に伴い AADC サーバーから Azure AD に向けた通信が行えないような状態に心当たりがないか確認します。</p><h2 id="Q-通知メールはどのタイミングで配信されるのか？"><a href="#Q-通知メールはどのタイミングで配信されるのか？" class="headerlink" title="Q. 通知メールはどのタイミングで配信されるのか？"></a>Q. 通知メールはどのタイミングで配信されるのか？</h2><p>A. データセンター側では約 2 時間おきにアップロード状況の確認が行われています。</p><p>確認が行われるまでに 2 時間以上アップロードされていない場合にメールで通知されるため、アップロードがされなくなってから、通知メールが配信されるまでは少なくとも 2 時間、場合によっては 4 時間ほど要します。</p><h2 id="Q-監視通信が行えていないが、Azure-Active-Directory-との同期処理は問題ないか？"><a href="#Q-監視通信が行えていないが、Azure-Active-Directory-との同期処理は問題ないか？" class="headerlink" title="Q. 監視通信が行えていないが、Azure Active Directory との同期処理は問題ないか？"></a>Q. 監視通信が行えていないが、Azure Active Directory との同期処理は問題ないか？</h2><p>A. オンプレミスのサーバーを監視する Agent による通信に関してであり、ディレクトリ同期ができているか、できていないかとは関係しません。  </p><h2 id="Q-監視通信を使用していないので、無効化する手順は？"><a href="#Q-監視通信を使用していないので、無効化する手順は？" class="headerlink" title="Q. 監視通信を使用していないので、無効化する手順は？"></a>Q. 監視通信を使用していないので、無効化する手順は？</h2><p>A. 下記のサービスを停止することで無効化することが可能です。</p><ul><li>Azure AD Connect Health Sync Insights Service  </li><li>Azure AD Connect Health Sync Monitoring Service  </li></ul><h2 id="Q-監視通信が正常に行えているか確認する方法は？"><a href="#Q-監視通信が正常に行えているか確認する方法は？" class="headerlink" title="Q. 監視通信が正常に行えているか確認する方法は？"></a>Q. 監視通信が正常に行えているか確認する方法は？</h2><p>A. Azure AD Connect サーバーにて、上述の 2 つのサービスが稼働していることを確認します。<br>Azure AD Connect サーバーにて、下記のコマンドを実行します。  </p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Test-AzureADConnectHealthConnectivity</span> <span class="literal">-Role</span> Sync <span class="literal">-ShowResult</span>  </span><br></pre></td></tr></table></figure><p>コマンド実行例)</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">Test-AzureADConnectHealthConnectivity</span> <span class="literal">-Role</span> Sync <span class="literal">-ShowResult</span>  <span class="built_in">Test-AzureADConnectHealthConnectivity</span><span class="string">&#x27;s execution in details are as follows:  </span></span><br><span class="line"><span class="string">Starting Test-AzureADConnectHealthConnectivity ...  </span></span><br><span class="line"><span class="string">Connectivity Test Step 1 of 3: Testing dependent service endpoints begins ...  </span></span><br><span class="line"><span class="string">AAD CDN connectivity is skipped.  </span></span><br><span class="line"><span class="string">Connecting to endpoint https://login.microsoftonline.com  Endpoint validation for https://login.microsoftonline.com is Successful.  </span></span><br><span class="line"><span class="string">Connecting to endpoint https://login.windows.net  Endpoint validation for https://login.windows.net is Successful.  </span></span><br><span class="line"><span class="string">Connecting to endpoint https://policykeyservice.dc.ad.msft.net/clientregistrationmanager.svc  </span></span><br><span class="line"><span class="string">Endpoint validation for https://policykeyservice.dc.ad.msft.net/clientregistrationmanager.svc is Successful.  </span></span><br><span class="line"><span class="string">Connecting to endpoint https://policykeyservice.dc.ad.msft.net/policymanager.svc  </span></span><br><span class="line"><span class="string">Endpoint validation for https://policykeyservice.dc.ad.msft.net/policymanager.svc is Successful.  </span></span><br><span class="line"><span class="string">Connectivity Test Step 1 of 3 - Testing dependent service endpoints completed successfully.  </span></span><br><span class="line"><span class="string">Connectivity Test Step 2 of 3 - Blob data upload procedure begins ...  </span></span><br><span class="line"><span class="string">Tenant Id is successfully collected during agent registration.  </span></span><br><span class="line"><span class="string">Connectivity Test Step 2 of 3 - Blob data upload procedure completed successfully.  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Connectivity Test Step 3 of 3 - EventHub data upload procedure begins ...  </span></span><br><span class="line"><span class="string">Tenant Id is successfully collected during agent registration.  </span></span><br><span class="line"><span class="string">Connectivity Test Step 3 of 3 - EventHub data upload procedure completed successfully.  </span></span><br><span class="line"><span class="string">Test-AzureADConnectHealthConnectivity completed successfully...  </span></span><br></pre></td></tr></table></figure><ul><li>3 つの確認ステップが実行されますので、それぞれ “completed successfully” となるかを確認ください。  </li></ul><p>Title : Azure AD Connect Health サービスへの接続テスト<br>URL:<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/connect-health/active-directory-aadconnect-health-agent-install#test-connectivity-to-azure-ad-connect-health-service">https://docs.microsoft.com/ja-jp/azure/active-directory/connect-health/active-directory-aadconnect-health-agent-install#test-connectivity-to-azure-ad-connect-health-service</a></p><h2 id="Q-監視通信の通知メールの宛先を変更方法は？"><a href="#Q-監視通信の通知メールの宛先を変更方法は？" class="headerlink" title="Q. 監視通信の通知メールの宛先を変更方法は？"></a>Q. 監視通信の通知メールの宛先を変更方法は？</h2><p>A. Azure Portal 画面より変更、無効化することが可能です。  </p><ol><li>Azure ポータル（<a href="http://portal.azure.com)にサインインします./">http://portal.azure.com）にサインインします。</a>  </li><li>左側のメニューから [Azure Active Directory] – [Azure AD Connect] - [Connect 同期] をクリックします。  </li><li>[正常性と分析] の下にある [Azure AD Connect Health] をクリックします。  </li><li>[Azure Active Directory Connect (Sync)] の枠内にある [同期サービス] をクリックし、対象テナントをクリックします。  </li><li>[操作] の枠内をクリックします。  </li><li>[通知設定] をクリックします。<br>通知を無効化する場合 : “新しいアラートの通知を電子メールで受け取ります。” 項目のチェックをオフに設定します。<br>通知先を変更する場合 : 変更を行うメールアドレス欄を選択し、変更後のアドレスを入力します。  </li><li>[保存] をクリックします。  </li></ol><p>Title : Azure Active Directory Connect Health の操作<br>URL:<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/connect-health/active-directory-aadconnect-health-operations">https://docs.microsoft.com/ja-jp/azure/active-directory/connect-health/active-directory-aadconnect-health-operations</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;本記事は Technet Blog の更新停止に伴い &lt;a href=&quot;https://blogs.technet.microsoft.com/jpazure</summary>
      
    
    
    
    
    <category term="Azure AD Connect" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-Connect/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Graph PowerShell v2.0 でサポートされた認証方法と変更点</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/microsoft-graph-powershell-v2.0/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/microsoft-graph-powershell-v2.0/</id>
    <published>2023-07-20T00:00:00.000Z</published>
    <updated>2023-08-18T17:00:11.753Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Azure Identity チームの沓澤です。</p><p>多くのお客様にお使いいただいている Microsoft Graph PowerShell モジュールの v2.0 が 2023/7/5 にリリースされました！モジュールの再インストールやアップデートを実施した際に Microsoft Graph PowerShell v2.0 以降がインストールされるようになります。Microsoft Entra ID 関連の変更点としては、サポートされる認証方法が増えます。一方で、Microsoft Entra ID を含め全てのサービスに関連いたしますが、今回のアップデートには破壊的変更があります。</p><p>本記事では Microsoft Graph PowerShell v2.0 のインストール方法の説明した後、サポートされるようになった認証方法と破壊的変更の内容について説明します。</p><h2 id="Microsoft-Graph-PowerShell-v2-0-のインストール"><a href="#Microsoft-Graph-PowerShell-v2-0-のインストール" class="headerlink" title="Microsoft Graph PowerShell v2.0 のインストール"></a>Microsoft Graph PowerShell v2.0 のインストール</h2><p>Microsoft Graph PowerShell は Microsoft Graph REST API (v1.0/Beta) を呼び出すためのモジュールです。Microsoft Graph PowerShell v1.x では 1 つのモジュール (Microsoft Graph PowerShell) で Microsoft Graph REST API v1.0 と Microsoft Graph REST API Beta の両方を呼び出せます。</p><p>一方、Microsoft Graph PowerShell v2.0 では、大きく二つのモジュールに分けられており、Microsoft Graph REST API v1.0 の呼び出しには Microsoft Graph PowerShell モジュールを使用し、Microsoft Graph REST API Beta の呼び出しには Microsoft Graph PowerShell Beta モジュールを使う必要があります。そのため、Microsoft Graph REST API Beta の呼び出しを計画している場合には Microsoft Graph PowerShell Beta のインストールが必要です。</p><p><img src="/blog/azure-active-directory/microsoft-graph-powershell-v2.0/module-image.png"></p><p>以下では、Microsoft Graph PowerShell モジュールおよび Microsoft Graph PowerShell Beta モジュールのインストール方法を説明します。</p><p>公開情報は既に v2.0 を前提とした説明に更新されていますので詳細は <a href="https://learn.microsoft.com/en-us/powershell/microsoftgraph/installation?view=graph-powershell-1.0#installation">Install the Microsoft Graph PowerShell SDK</a> をご確認ください。</p><h3 id="Microsoft-Graph-PowerShell-モジュールのインストールおよびアップデート"><a href="#Microsoft-Graph-PowerShell-モジュールのインストールおよびアップデート" class="headerlink" title="Microsoft Graph PowerShell モジュールのインストールおよびアップデート"></a>Microsoft Graph PowerShell モジュールのインストールおよびアップデート</h3><p>Microsoft Graph PowerShell を初めて使用する場合は以下のコマンドでインストールください。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Install-Module</span> Microsoft.Graph</span><br></pre></td></tr></table></figure><p>既に Microsoft Graph PowerShell v1.x を使用中の場合は以下のコマンドでアップデートできます。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Update-Module</span> Microsoft.Graph</span><br></pre></td></tr></table></figure><h3 id="Microsoft-Graph-PowerShell-Beta-モジュールのインストール"><a href="#Microsoft-Graph-PowerShell-Beta-モジュールのインストール" class="headerlink" title="Microsoft Graph PowerShell Beta モジュールのインストール"></a>Microsoft Graph PowerShell Beta モジュールのインストール</h3><p>Microsoft Graph PowerShell Beta モジュールは、Microsoft Graph PowerShell モジュールと別々にインストールできます。言い換えますと Microsoft Graph PowerShell と Microsoft Graph PowerShell Beta は共存できます。運用環境にて Beta エンドポイントの利用を避けたい (v1.0 エンドポイントのみを利用したい) 場合は、上記手順で Microsoft Graph PowerShell モジュールのみをインストールし、Microsoft Graph PowerShell Beta モジュールをインストールしないということも可能です。</p><p>インストールするには以下コマンドを実行します。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Install-Module</span> Microsoft.Graph.Beta</span><br></pre></td></tr></table></figure><h2 id="v2-0-からサポートされる認証方法"><a href="#v2-0-からサポートされる認証方法" class="headerlink" title="v2.0 からサポートされる認証方法"></a>v2.0 からサポートされる認証方法</h2><p>以下 2 つを使用した認証方法がサポートされるようになりました。</p><ul><li>マネージド ID</li><li>クライアント シークレット</li></ul><h3 id="マネージド-ID"><a href="#マネージド-ID" class="headerlink" title="マネージド ID"></a>マネージド ID</h3><p>システム割り当てマネージド ID での認証をする場合は以下コマンドを実行ください。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">Connent<span class="literal">-MgGraph</span> <span class="literal">-Identity</span></span><br></pre></td></tr></table></figure><p>ユーザー割り当てマネージド ID での認証をする場合は以下コマンドを実行ください。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Connect-MgGraph</span> <span class="literal">-Identity</span> <span class="literal">-u</span> &lt;ユーザー割り当てマネージド ID のアプリケーション ID&gt;</span><br></pre></td></tr></table></figure><h3 id="クライアント-シークレット"><a href="#クライアント-シークレット" class="headerlink" title="クライアント シークレット"></a>クライアント シークレット</h3><p>クライアント シークレットで認証する場合は以下コマンドを実行ください。認証ポップアップにクライアント シークレットの文字列を入力します。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ClientSecretCredential</span> = <span class="built_in">Get-Credential</span> <span class="literal">-Username</span> <span class="string">&quot;&lt;アプリケーション ID&gt;&quot;</span> Message <span class="string">&quot;Enter the client secret string.&quot;</span></span><br><span class="line"><span class="built_in">Connect-MgGraph</span> <span class="literal">-TenantId</span> <span class="string">&quot;&lt;テナント Id&gt;&quot;</span> <span class="literal">-ClientSecretCredential</span> <span class="variable">$ClientSecretCredential</span></span><br></pre></td></tr></table></figure><h2 id="破壊的変更"><a href="#破壊的変更" class="headerlink" title="破壊的変更"></a>破壊的変更</h2><p>Microsoft Graph PowerShell を使用し Microsoft Entra ID 関連のデータ操作をする際に、関連するものを数点ピックアップします。</p><p>詳細については GitHub の <a href="/blog/docs/upgrade-to-v2/">v2.0 へのアップグレード ガイド</a> をご確認ください</p><h3 id="Select-MgProfile-コマンドの廃止"><a href="#Select-MgProfile-コマンドの廃止" class="headerlink" title="Select-MgProfile コマンドの廃止"></a>Select-MgProfile コマンドの廃止</h3><p>Microsoft Graph PowerShell v1.x では Select-MgProfile コマンドにより Microsoft Graph REST API v1.0 と Microsoft Graph REST API Beta との呼び出し先の振り分けていました。v2.0 からは Select-MgProfile コマンドは廃止され、上述のとおり Microsoft Graph PowerShell モジュールからは Microsoft Graph REST API v1.0 を呼び出し、Microsoft Graph PowerShell Beta モジュールからは Microsoft Graph REST API Beta を呼び出すように変更になりました。</p><h3 id="Microsoft-Graph-REST-API-Beta-を呼び出す際のコマンドの命名規則が-lt-Verb-gt-MgBeta-lt-Noun-gt-に"><a href="#Microsoft-Graph-REST-API-Beta-を呼び出す際のコマンドの命名規則が-lt-Verb-gt-MgBeta-lt-Noun-gt-に" class="headerlink" title="Microsoft Graph REST API Beta を呼び出す際のコマンドの命名規則が &lt;Verb&gt;-MgBeta&lt;Noun&gt; に"></a>Microsoft Graph REST API Beta を呼び出す際のコマンドの命名規則が &lt;Verb&gt;-Mg<strong>Beta</strong>&lt;Noun&gt; に</h3><p>Micrsosft Graph REST API Beta を呼び出す際には Microsoft Graph PowerShell Beta モジュール内のコマンドを使用します。命名規則は &lt;Verb&gt;-Mg<strong>Beta</strong>&lt;Noun&gt; です。</p><p>下表に例を記載します。</p><table><thead><tr><th align="center">v1.0</th><th align="center">Beta</th></tr></thead><tbody><tr><td align="center">Get-MgUser</td><td align="center">Get-MgBetaUser</td></tr><tr><td align="center">Get-MgUserMessage</td><td align="center">Get-MgBetaUserMessage</td></tr></tbody></table><h3 id="Connect-MgGraph-コマンドにおける-ForceRefresh-オプションの廃止"><a href="#Connect-MgGraph-コマンドにおける-ForceRefresh-オプションの廃止" class="headerlink" title="Connect-MgGraph コマンドにおける -ForceRefresh オプションの廃止"></a>Connect-MgGraph コマンドにおける -ForceRefresh オプションの廃止</h3><p>Connect-MgGraph -ForceRefresh が使用不可になり、代わりに Disconnect-MgGraph 後に Connect-MgGraph を実行する必要があります。</p><h3 id="Connect-MgGraph-コマンドにおける-AccessToken-オプションでは-SecureString-型の引数が必要に"><a href="#Connect-MgGraph-コマンドにおける-AccessToken-オプションでは-SecureString-型の引数が必要に" class="headerlink" title="Connect-MgGraph コマンドにおける -AccessToken オプションでは SecureString 型の引数が必要に"></a>Connect-MgGraph コマンドにおける -AccessToken オプションでは SecureString 型の引数が必要に</h3><p>以下コマンドではエラーが生じます。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Connect-MgGraph</span> <span class="literal">-AccessToken</span> &lt;アクセス トークンの文字列&gt;</span><br></pre></td></tr></table></figure><p>代わりに以下のように SecureString 型の引数を指定する必要があります:</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$st</span> = <span class="built_in">ConvertTo-SecureString</span> &lt;アクセス トークンの文字列&gt; <span class="literal">-AsPlainText</span> <span class="literal">-Force</span></span><br><span class="line"><span class="built_in">Connect-MgGraph</span> <span class="literal">-AccessToken</span> <span class="variable">$st</span></span><br></pre></td></tr></table></figure><h3 id="モジュール名のリネーム"><a href="#モジュール名のリネーム" class="headerlink" title="モジュール名のリネーム"></a>モジュール名のリネーム</h3><p>モジュール名の変更を下表にまとめます:</p><table><thead><tr><th align="center">v1.x</th><th align="center">v2.0</th></tr></thead><tbody><tr><td align="center">DeviceManagement.Enrolment</td><td align="center">DeviceManagement.Enrollment</td></tr><tr><td align="center">DeviceManagement.Enrollment</td><td align="center">Identity.Governance</td></tr></tbody></table><p>スクリプト内で Import-Module をしている場合にはモジュール名の変更が必要です。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Azure Identity チームの沓澤です。&lt;/p&gt;
&lt;p&gt;多くのお客様にお使いいただいている Microsoft Graph PowerShell モジュールの v2.0 が 2023/7/5 にリリースされました！モジュールの再インストールやアップデート</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Microsoft Graph" scheme="https://jpazureid.github.io/blog/tags/Microsoft-Graph/"/>
    
    <category term="Microsoft Graph PowerShell" scheme="https://jpazureid.github.io/blog/tags/Microsoft-Graph-PowerShell/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Entra - Security Service Edge へ拡大するための新機能</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/microsoft-entra-expands-into-securityserviceedge-with-two-new-offerings/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/microsoft-entra-expands-into-securityserviceedge-with-two-new-offerings/</id>
    <published>2023-07-19T00:00:00.000Z</published>
    <updated>2023-08-18T17:00:11.741Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 姚 (ヨウ) です。</p><p>本記事は、2023 年 7 月 11 日に米国の Microsoft Entra (Azure AD) Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/microsoft-entra-expands-into-security-service-edge-with-two-new/ba-p/3847829">Microsoft Entra Expands into Security Service Edge with Two New Offerings - Microsoft Community Hub</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>柔軟な仕事環境やデジタル トランスフォーメーションにより、どのようにして情報に安全にアクセスするかという方法も変化してきています。従来のネットワークをベースにしたセキュリティのアプローチは現在の環境には適さなくなってきました。従来の方法は、エンド ユーザーの体験を損なうだけでなく、ユーザーに対して、ネットワーク全体に必要以上のアクセス権を与えることになります。攻撃者が、1 名の情報漏洩ユーザー、1 つの感染デバイスなど、1 つのきっかけを得るだけで、内部ネットワークへ自由に入り込み、重要情報資産が流出することになります。</p><p><img src="/blog/azure-active-directory/microsoft-entra-expands-into-securityserviceedge-with-two-new-offerings/over_view.png"></p><p>先進的なアクセス ソリューションをシステムに導入したとしても、複数の ID とネットワーク ツールを統合し、管理する必要があります。なぜなら、単独の ID またはネットワーク ツールだけでは、すべてのアクセス ポイントを保護することはできないからです。もしうまく統合できないツールを利用してしまうと、重要な統合ポイントを見逃してしまう可能性があります。熟練した攻撃者はそういったソリューションの間にある隙間を攻撃するのです。全アプリケーションまたはリソースを保護するためには簡単かつアジャイルなアプローチが必要です。本日弊社が紹介する新しいネットワーク モデルにより、アクセス保護の仕方も変わってくるでしょう。</p><p>本日は <a href="https://www.microsoft.com/en-us/security/blog/2023/07/11/microsoft-entra-expands-into-security-service-edge-and-azure-ad-becomes-microsoft-entra-id/">2 つの新しい製品</a> を紹介いたします。</p><ul><li>Microsoft Entra Internet Access</li><li>Microsoft Entra Private Access</li></ul><p>ID とネットワーク ソリューションを連携させることにより、個々のアプリにどのツールが適切か考えたり、ID 担当チームが作成したポリシーとネットワーク担当チームが作成したポリシーとを連携させる方法を検討したりすることに時間に費やす必要はなくなります。Microsoft Entra の条件付きアクセスを利用して ID とネットワークを総合的に制御することができるようになります。</p><p>クラウドベースの ID 中心のネットワーク アクセス ソリューションを通して、すべてのエンドユーザー、アプリケーション、外部リソースそして IT システムをつなぐことができるようになります。このクラウド サービスはレガシーのオンプレミス システムと比較すると、変化に柔軟で管理が容易であり、コスト効率がよいため、ユーザーの生産性を損なうことはありません。このモデルはゼロ トラストの原則をベースとしており、ID を検証すると共に、リスクに基づいた検出も行うことで、ユーザーの仕事に必要なアプリケーション、リソースにアクセスできるよう支援します。</p><h2 id="Microsoft-Entra-Internet-Access"><a href="#Microsoft-Entra-Internet-Access" class="headerlink" title="Microsoft Entra Internet Access"></a>Microsoft Entra Internet Access</h2><p>Microsoft Entra Internet Access は、SaaS アプリケーションおよびインターネット通信向けの、ID を軸とした Secure Web Gateway (SWG) であり、悪意がある接続や危険/非準拠なコンテンツ、外部インターネットからの脅威から保護するためのサービスです。例えば、高リスクと判断されたユーザーまたは非準拠デバイスからのアクセスは、セルフサービス パスワード リセットのページを除いて通信をすべてブロックするということが可能になります。これは、条件付きアクセスの条件の設定をネットワークの条件で拡張するようなものとお考えください。これにより、例えばセッション トークンが盗まれたとしても、その再利用を抑止するために、”準拠ネットワーク” からのみリソースへのアクセスを許可するようにも構成できます。</p><p>Universal Tenant Restrictions という Microsoft 365 向けの独自の機能も備えており、匿名アクセスを含め他テナントや個人アカウントへのデータ流出を防止し、リアルタイムに近い脅威の検出、ユーザー、場所およびデバイスに対する高精度のリスク評価、および Microsoft 365 アプリへのよりシームレスなアクセスを実現します。Microsoft Entra Internet Access はメイン ソリューションとしても、ほかの SSE ソリューションと組み合わせても展開でき、新しい Microsoft Graph API による統合も提供されます。また、ネットワーク トラフィックの情報は、エンドユーザーのクロスプラットフォームの OS およびリモート ネットワークの IPSec トンネリングを利用しても取得できます。</p><p>Microsoft 365 用および Windows 用の Microsoft Entra Internet Access が現在パブリック プレビューとして公開されています。他のすべてのトラフィック、クラウド ファイヤーウォール、脅威検知および他の OS のサポートは今年の後半に公開予定です。</p><p><img src="/blog/azure-active-directory/microsoft-entra-expands-into-securityserviceedge-with-two-new-offerings/internet_access.png"></p><h2 id="Microsoft-Entra-Private-Access"><a href="#Microsoft-Entra-Private-Access" class="headerlink" title="Microsoft Entra Private Access"></a>Microsoft Entra Private Access</h2><p>Microsoft Entra の Application Proxy をご存じかと思います。現在数千のお客様が内部ウェブ アプリケーションへのアクセスに Application Proxy を利用しています。本日、これにより優れたソリューションを発表いたします。Application Proxy と同じアプリ コネクターを共有する仕組みでありながら、組織の内部のリソース、ポートまたはプロトコールへのアクセスを保護する、ID 中心のゼロトラスト ネットワーク  アクセス (ZTNA) ソリューションです。</p><p>Microsoft Entra Private Access により、ユーザーがオフィスまたはリモートのどこにいようと、アプリケーションがオンプレミスのデータセンターまたは外部クラウドのどこにホストされていようと、より迅速かつ簡単にアプリケーションへ接続となります。これらのアプリケーションに対して何ら変更を加える必要はありません。追加の変更なく、多要素認証 (MFA) やデバイス準拠の検証、ID Protection、ID Governance、およびシングル サインオンを TCP/UDP をベースとしたアプリケーションに構成できます。加えて、SSH、RDP、SAP、SMB ファイル共有やほかの内部リソースもサポートします。</p><p>属性ベースの条件付きアクセス ポリシーを利用することにより、エンタープライズ向けのアプリケーションの重要度に基づき、より効果的に複数のアプリケーションを対象にしてシンプルなポリシーを作成することはできます。例えば、MFA を要求するポリシー、デバイスの準拠を要求するポリシー、ユーザーが低リスクであることを要求するポリシー、重要なアプリケーションに対して準拠したネットワークからのアクセスを要求するポリシーが挙げられます。特定のアプリケーションを対象にした個別のポリシーを構成することももちろん可能です。条件付きアクセス ポリシーと継続的アクセス評価 (CAE) との統合によって、レガシー アプリケーションの認証方法である Kerberos または NTLM を変更することなく、安全かつシームレスに先進的な認証を追加することができます。Microsoft Entra Private Access は現在パブリック プレビューです。</p><p><img src="/blog/azure-active-directory/microsoft-entra-expands-into-securityserviceedge-with-two-new-offerings/private_access.png"></p><h2 id="ID-中心の-Security-Service-Edge-SSE-ソリューションでどこからでもアプリケーションやリソースへ安全にアクセス"><a href="#ID-中心の-Security-Service-Edge-SSE-ソリューションでどこからでもアプリケーションやリソースへ安全にアクセス" class="headerlink" title="ID 中心の Security Service Edge (SSE) ソリューションでどこからでもアプリケーションやリソースへ安全にアクセス"></a>ID 中心の Security Service Edge (SSE) ソリューションでどこからでもアプリケーションやリソースへ安全にアクセス</h2><p>Microsoft Entra Internet Access と Private Access に加えて、弊社の SaaS - セキュリティに特化した CASB (Cloud Access Security Broker) - である Microsoft Defender for Cloud Apps を組み合わせることによって Microsoft の Security Service Edge ソリューションが構成されます。このソリューションは Microsoft の広範なセキュリティ製品と深く統合されており、オープンなパートナー エコシステムを形成するため、既存のネットワークとセキュリティ ソリューションとも連携できます。</p><p>Microsoft Internet Access と Private Access は、同じエージェントを共有しており、複数の種類の OS で動作し、なおかつ複数の種類のデバイスとネットワークで一貫した接続性を提供いたします。アプリケーションまたはウェブサイトに対して、利用する IdP に関係なく、しかもアプリケーションを変更することなく、ID、デバイス、アプリケーション、そして今後はネットワーク条件を考慮した制御を一つの条件付きアクセス ポリシーで実現できるようになるのです。</p><p><img src="/blog/azure-active-directory/microsoft-entra-expands-into-securityserviceedge-with-two-new-offerings/sse.png" alt="ID 中心の Security Service Edge (SSE) ソリューションでどこからでもアプリケーションやリソースへ安全にアクセス可能となります。一つの条件付きアクセスの制御を用いて、ネットワーク アクセスのセキュリティをよりシンプルにし、より良いユーザー体験をお届けします。"></p><p>Microsoft の SSE ソリューションは世界最大の企業ネットワークの 1 つである <a href="https://learn.microsoft.com/en-us/azure/networking/microsoft-global-network">Microsoft Global Network</a> によって提供されます。Microsoft Global Network は、<a href="https://azure.microsoft.com/en-us/explore/global-infrastructure/global-network/#features">185 以上のグローバルなネットワーク接続拠点</a> に加え、世界中に巨大な網目のように配置されたエッジ ノードにより、61 の Azure リージョンの<a href="https://azure.microsoft.com/en-us/explore/global-infrastructure/">データセンター</a> を結んでいます。これにより、ユーザーとデバイスをパブリックおよびプライベートのリソースにシームレスかつ安全に接続できるようになります。現在、Microsoft の SSE は北米とヨーロッパの一部の地域で提供されていますが、今年中に利用できる地域を追加する予定です。</p><p>我々の SSE ソリューションの導入により、Microsoft Internet Access と Private Access がユーザーの ID、デバイス 準拠状態、アプリケーション、そして今では新しいネットワークの準拠状態を条件として、どのアプリケーションおよびリソースに対しても、ID を中心とした単一のアプローチで安全な接続を実現します。すべてのアクセス ポリシーを統合し、継続的アクセス評価によりさらにポリシーを強化するということが、これまで以上に簡単になりました。</p><p>引き続き製品の Deep Dive ブログにもご期待ください。また、7 月 20 日の <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/live-series-6-27-amp-7-20-microsoft-entra-tech-accelerator/ba-p/2520433">Tech Accelerator Product Deep Dive Session</a> では、Microsoft Internet Access と Private Access がいかに組織のデジタル資産へのアクセスをより安全にするかという点をさらに紐解いて説明いたします。</p><p>このソリューションをより良くするために、ぜひパブリック プレビューに参加いただき、フィードバックを提供ください。</p><p>以下の公開情報もご参照いただけますと幸いです。</p><ul><li><a href="https://www.microsoft.com/security/business/identity-access/microsoft-entra-internet-access">Microsoft Entra Internet Access</a></li><li><a href="https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-private-access">Microsoft Entra Private Access</a></li><li><a href="https://aka.ms/SSEPublicPreview">Get started and try previews</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 姚 (ヨウ) です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 7 月 11 日に米国の Microsoft Entra (Azure AD) Blog で公開された &lt;a href=&quot;https://techcom</summary>
      
    
    
    
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD Connect アップグレード手順詳細</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory-connect/how-to-upgrade-details/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory-connect/how-to-upgrade-details/</id>
    <published>2023-07-13T15:00:00.000Z</published>
    <updated>2023-08-18T17:00:11.057Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。 Azure Identity サポートの小出です。</p><p>以前、Azure AD Connect の非推奨プロセスに伴い、多くのお客様にて推奨バージョンへのアップグレードご検討いただいている状況となり、弊社にも多くのお問い合わせをいただいておりました。<br>現在はすでに v1.x は廃止され、多くのお客様が v2.x を利用されていますので、以前展開していた手順詳細資料をこの度アップデートいたしました。</p><p>なお、2023 年 10 月 1 日以降は AADC v1.x からの接続を停止することから、まだ v1.x を利用しているお客様においては、早急にアップグレードの対応を実施いただいているかと思います。</p><p>利用されているバージョンが v1.x、v2.x にかかわらず、利用できる手順となりますので、実際の作業時の参考にしていただければ幸いです。</p><p>今回ご紹介する手順のシナリオは下記の 3 パターンとなります。</p><ul><li>A. Azure AD Connect 2 台構成によるスウィング アップグレード</li><li>B. Azure AD Connect 1 台構成に 1 台追加で構成し、アップグレード</li><li>C. Azure AD Connect 1 台構成によるインプレースアップグレード</li></ul><p>それぞれの手順の流れと手順内容を pptx ファイルに纏めさせていただいています。<br>ご利用いただいている環境に応じて、ご参照ください。</p><h2 id="A-Azure-AD-Connect-2-台構成によるスウィング-アップグレード"><a href="#A-Azure-AD-Connect-2-台構成によるスウィング-アップグレード" class="headerlink" title="A. Azure AD Connect 2 台構成によるスウィング アップグレード"></a>A. Azure AD Connect 2 台構成によるスウィング アップグレード</h2><h3 id="lt-手順概要-gt"><a href="#lt-手順概要-gt" class="headerlink" title="&lt;手順概要&gt;"></a>&lt;手順概要&gt;</h3><ol><li>既存環境の各サーバーにて、動作状況の確認などアップグレード前の事前確認を行います。</li><li>カスタム同期ルールをはじめ、設定内容を保存します。</li><li>Server B の Azure AD Connect のインプレース アップグレードを行います。</li><li>Server B にて、アップグレード後の動作状況を確認します。</li><li>Server A にて Azure AD Connect のステージング モードを有効化します。</li><li>Server B にて Azure AD Connect のステージング モードを無効化し、アクティブにします。</li><li>Server A の Azure AD Connect のインプレース アップグレードを行います。</li><li>Server A にて、アップグレード後の動作状況を確認します。</li></ol><h3 id="lt-手順詳細-gt"><a href="#lt-手順詳細-gt" class="headerlink" title="&lt;手順詳細&gt;"></a>&lt;手順詳細&gt;</h3><p><a href="/blog/azure-active-directory-connect/how-to-upgrade-details/aadc-upgrade-a-2023v2.pptx">アップグレード手順詳細 A</a></p><h2 id="B-Azure-AD-Connect-1-台構成に-1-台追加で構成し、アップグレード"><a href="#B-Azure-AD-Connect-1-台構成に-1-台追加で構成し、アップグレード" class="headerlink" title="B. Azure AD Connect 1 台構成に 1 台追加で構成し、アップグレード"></a>B. Azure AD Connect 1 台構成に 1 台追加で構成し、アップグレード</h2><h3 id="lt-手順概要-gt-1"><a href="#lt-手順概要-gt-1" class="headerlink" title="&lt;手順概要&gt;"></a>&lt;手順概要&gt;</h3><ol><li>既存環境の ServerA にて、動作状況の確認などアップグレード前の事前確認を行います。</li><li>カスタム同期ルールをはじめ、設定内容を保存します。</li><li>Server B となる新しいサーバーを用意します。</li><li>新規構築した ServerB に Azure AD Connect をインストールします。 (ステージング モード有効)</li><li>Server B で動作状況を確認します。</li><li>Server A にて、 Azure AD Connect のステージング モードを有効化します。</li><li>Server B にて、 Azure AD Connect のステージング モードを無効化し、アクティブにします。</li><li>Server A の Azure AD Connect のインプレース アップグレードを行います。</li><li>Server A で動作状況を確認します。</li></ol><h3 id="lt-手順詳細-gt-1"><a href="#lt-手順詳細-gt-1" class="headerlink" title="&lt;手順詳細&gt;"></a>&lt;手順詳細&gt;</h3><p><a href="/blog/azure-active-directory-connect/how-to-upgrade-details/aadc-upgrade-b-2023v2.pptx">アップグレード手順詳細 B</a></p><h2 id="C-Azure-AD-Connect-1-台構成によるインプレースアップグレード"><a href="#C-Azure-AD-Connect-1-台構成によるインプレースアップグレード" class="headerlink" title="C. Azure AD Connect 1 台構成によるインプレースアップグレード"></a>C. Azure AD Connect 1 台構成によるインプレースアップグレード</h2><h3 id="lt-手順概要-gt-2"><a href="#lt-手順概要-gt-2" class="headerlink" title="&lt;手順概要&gt;"></a>&lt;手順概要&gt;</h3><ol><li>既存環境の動作状況の確認</li><li>設定内容の保存</li><li>アップグレード</li><li>アップグレードの動作確認 (手順1. と同じ)</li></ol><h3 id="lt-手順詳細-gt-2"><a href="#lt-手順詳細-gt-2" class="headerlink" title="&lt;手順詳細&gt;"></a>&lt;手順詳細&gt;</h3><p><a href="/blog/azure-active-directory-connect/how-to-upgrade-details/aadc-upgrade-c-2023v2.pptx">アップグレード手順詳細 C</a></p><h2 id="資料の選び方について"><a href="#資料の選び方について" class="headerlink" title="資料の選び方について"></a>資料の選び方について</h2><p>どの資料が適切な手順が分からない場合には、下記フローも参考にしてください。<br><img src="/blog/azure-active-directory-connect/how-to-upgrade-details/which-step-is-best-for-the-upgdrade.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。 Azure Identity サポートの小出です。&lt;/p&gt;
&lt;p&gt;以前、Azure AD Connect の非推奨プロセスに伴い、多くのお客様にて推奨バージョンへのアップグレードご検討いただいている状況となり、弊社にも多くのお問い合わせをいただいておりました。</summary>
      
    
    
    
    
    <category term="Azure AD Connect" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-Connect/"/>
    
  </entry>
  
  <entry>
    <title>ハードマッチによる Azure AD (Office 365) 上のユーザーをオンプレミス Active Directory ユーザーと紐付ける方法</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory-connect/upn-hard-match/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory-connect/upn-hard-match/</id>
    <published>2023-07-13T15:00:00.000Z</published>
    <updated>2023-08-18T17:00:11.217Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>本記事は Technet Blog の更新停止に伴い <a href="https://blogs.technet.microsoft.com/jpazureid/2017/10/05/135/">https://blogs.technet.microsoft.com/jpazureid/2017/10/05/135/</a> の内容を移行したものです。</p><p>元の記事の最新の更新情報については、本内容をご参照ください。</p></div><blockquote><p>2020/09/26 更新<br><a href="/blog/azure-active-directory-connect/aboutSoftMatching/">ソフトマッチによるAzure AD (Office 365) 上のユーザーをオンプレミス Active Directory ユーザーと紐付ける方法</a> のブログの公開に併せて、タイトルに “ハードマッチ” の記載を追記しました。</p><p>2023/7/14 更新<br>MSOL コマンド部分を新しい Microsoft Graph PowerShell SDK コマンドに置き換えました。</p></blockquote><p>こんにちは、Azure &amp; Identity サポート チームです。</p><p>今回は Azure AD (Office 365) 上のユーザーをオンプレミス Active Directory ユーザーと紐付ける方法の一つで、ハードマッチと呼ばれる方法についてご紹介します。</p><p>既に Azure AD 上にユーザー アカウントが存在している状態で、そのユーザーを後からオンプレミスの Active Directory (AD) に追加し、同期をおこなうときにその既存のアカウントをそのまま利用したいということがあると思います。</p><p>このようなケースではオンプレミス AD で対象となるアカウントのメール アドレス、または UPN 名を一致させた上で同期をおこなうという手法が一般的には取られます (これをソフトマッチと呼びます)。このソフトマッチができない場合 (UPN 名が異なるアカウントを紐づける必要がある場合など) にはハード マッチと呼ばれる方法で直接的に同期時にオブジェクトの一意性を確保する ID 情報 Immutable ID を紐づけます。</p><p>Azure AD Connect の既定の構成では、オンプレミス AD の ObjectGUID (バージョン 1.1.486.0 以前) あるいは msDS-ConsistencyGuid (バージョン 1.1.524.0 以降) を Base64 でエンコードした値を Immutable ID (source Anchor) として紐づけています。</p><p>以下では Azure AD Connect で ObjectGUID を ImmutableId と紐づける構成とている場合においてハードマッチによる同期をおこなう設定をご紹介します。</p><h2 id="手順"><a href="#手順" class="headerlink" title="手順"></a>手順</h2><ol><li>オンプレミス AD にて Base64 でエンコードされた ObjectGUID を確認します</li><li>Azure AD 上で ImmutableId が設定されてないことを確認します</li><li>Azure AD 上のアカウントに ImmutableId を手動で設定します</li><li>手動で差分ディレクトリ同期を実施します</li></ol><p>※ 4 を除き、同期処理が止まっている状態で作業をご実施ください。同期処理が止まっていないと紐づけしたいオンプレミス AD のアカウントが同期されてしまい、Immutable ID を紐づけできません。</p><h3 id="1-オンプレミス-AD-にて-Base64-でエンコードされた-ObjectGUID-を確認"><a href="#1-オンプレミス-AD-にて-Base64-でエンコードされた-ObjectGUID-を確認" class="headerlink" title="1. オンプレミス AD にて Base64 でエンコードされた ObjectGUID を確認"></a>1. オンプレミス AD にて Base64 でエンコードされた ObjectGUID を確認</h3><p>オンプレミス上の紐づけ対象のアカウントの GUID 情報を取得します。</p><ol><li>オンプレミス Active Directory の任意の DC 上で [管理ツール] - [Active Directory ユーザーとコンピューター] を開きます。</li><li>メニューから [表示] - [拡張機能] にチェックを入れます。</li><li>該当ユーザー アカウントのプロパティを開きます。</li><li>[属性エディター] タブを開き、”distinguishedName” 値を選択し、[表示] をクリックします。</li><li>distinguishedName 値 (以下、DN 値) の内容をコピーします。</li><li>コマンド プロンプト (PowerShell でも可) を起動し、以下のコマンドを実行します。</li></ol><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">ldifde <span class="operator">-f</span> c:\ ldifde_user.txt <span class="literal">-d</span> <span class="string">&quot;手順 5. でコピーした内容&quot;</span> <span class="literal">-p</span> subtree</span><br></pre></td></tr></table></figure><p>コマンド例：</p><p><img src="/blog/azure-active-directory-connect/upn-hard-match/hardmatch_11.png"></p><p>1-7. 出力されたファイルを開き、ObjectGUID の値を確認します。<br>出力結果例：</p><p><img src="/blog/azure-active-directory-connect/upn-hard-match/hardmatch_2.png"></p><h2 id="2-Azure-AD-上で-ImmutableId-が設定されてないことを確認"><a href="#2-Azure-AD-上で-ImmutableId-が設定されてないことを確認" class="headerlink" title="2. Azure AD 上で ImmutableId が設定されてないことを確認"></a>2. Azure AD 上で ImmutableId が設定されてないことを確認</h2><p>Azure AD の紐づけ対象のアカウントに ImmutableId が設定されていないことを確認します。ImmutableId が設定されている場合には、すでに同期対象となっていることを示します。</p><ol><li>インターネットに接続している任意のコンピューター上で “Windows PowerShell 用 Windows Azure Active Directory モジュール” を管理者として実行します。</li><li>起動した PowerShell にて Connect-MsolService コマンドを実行します。<br>※ 認証ダイアログが表示されますので、管理者ユーザーの資格情報を入力して [OK] ボタンをクリックします。</li><li>下記のコマンドを実行します。</li></ol><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -UserId  &quot;対象ユーザーの UPN&quot; -Select OnPremisesImmutableId | fl OnPremisesImmutableId</span><br></pre></td></tr></table></figure><p>コマンド例：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -UserId test12127@m365x61971868.onmicrosoft.com -Select Userprincipalname,OnPremisesImmutableId | fl OnPremisesImmutableId,userprincipalname</span><br></pre></td></tr></table></figure><ol start="4"><li>出力されたファイルを開き、ImmutableId の値を確認します。</li></ol><p>出力結果例：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">OnPremisesImmutableId :（クラウド内ユーザーの場合、空白になります）</span><br><span class="line">UserPrincipalName     : test12127@m365x61971868.onmicrosoft.com</span><br></pre></td></tr></table></figure><h3 id="3-ImmutableId-を手動で設定"><a href="#3-ImmutableId-を手動で設定" class="headerlink" title="3. ImmutableId を手動で設定"></a>3. ImmutableId を手動で設定</h3><p>ディレクトリ同期ツールにて、ユーザーの情報を関連付けるには下記の情報を使用します。</p><ul><li>オンプレミス AD 側: objectGUID</li><li>Azure AD 側: ImmutableId</li></ul><ol><li>インターネットに接続している任意のコンピューター上で “Windows PowerShell 用 Windows Azure Active Directory モジュール” を管理者として実行します。</li><li>起動した PowerShell にて Connect-MsolService コマンドを実行します。<br>※認証ダイアログが表示されますので、管理者ユーザーの資格情報を入力して [OK] ボタンをクリックします。</li><li>下記のコマンドを実行します。</li></ol><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Update-MgUser</span> <span class="literal">-UserId</span> 対象ユーザーの UPN <span class="literal">-OnPremisesImmutableId</span> &lt;オンプレ AD ユーザーの  Base64 エンコードされた objectGUID 値&gt;</span><br></pre></td></tr></table></figure><p>コマンド実行例：</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Update-MgUser</span> <span class="literal">-UserId</span> test12127@m365x61971868.onmicrosoft.com <span class="literal">-OnPremisesImmutableId</span> <span class="number">2</span>/<span class="number">9</span>JCtHr0EmH+hL07o11vAaa</span><br></pre></td></tr></table></figure><p>3-4. 下記のコマンドを実行します。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-MgUser</span> <span class="literal">-UserId</span> 対象ユーザーの UPN <span class="literal">-Select</span> Userprincipalname,OnPremisesImmutableId | <span class="built_in">fl</span> OnPremisesImmutableId,userprincipalname</span><br></pre></td></tr></table></figure><p>コマンド例：</p><p><img src="/blog/azure-active-directory-connect/upn-hard-match/hardmatch_4.png"></p><h3 id="4-手動で差分ディレクトリ同期を実施"><a href="#4-手動で差分ディレクトリ同期を実施" class="headerlink" title="4. 手動で差分ディレクトリ同期を実施"></a>4. 手動で差分ディレクトリ同期を実施</h3><p>※ 2016 年 2 月に公開された新しいバージョン (1.1.105.0 以上) の Azure AD Connect を使用した手順をご案内いたします。</p><ol><li>ディレクトリ同期サーバーに管理者権限でログインします。</li><li>管理者の PowerShell を起動して、以下のコマンドを実行します。</li></ol><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Start-ADSyncSyncCycle -PolicyType Delta</span><br></pre></td></tr></table></figure><p>※ 今回ご紹介しているケースのように Azure AD Connect が構成済みである場合は上記コマンドで差分同期をすることとなります。</p><ol start="3"><li>Office 管理ポータルで作業対象ユーザーの [同期の種類] が [クラウド] から [Active Directory ] に変わったことを確認します。</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;本記事は Technet Blog の更新停止に伴い &lt;a href=&quot;https://blogs.technet.microsoft.com/jpazure</summary>
      
    
    
    
    
    <category term="UPN" scheme="https://jpazureid.github.io/blog/tags/UPN/"/>
    
    <category term="Azure AD Connect" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-Connect/"/>
    
    <category term="Hard match" scheme="https://jpazureid.github.io/blog/tags/Hard-match/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Entra の新機能と変更のアナウンス</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/microsoft-entra-new-feature-and-change-announcements/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/microsoft-entra-new-feature-and-change-announcements/</id>
    <published>2023-07-11T00:00:00.000Z</published>
    <updated>2023-08-18T17:00:11.745Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 高田 です。</p><p>本記事は、2023 年 6 月 30 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/microsoft-entra-new-feature-and-change-announcements/ba-p/3796396">Microsoft Entra new feature and change announcements</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>Microsoft はこのほど、Entra 製品群に、組織のセキュリティ改善目的とした、さまざまな新しいセキュリティ ツールと機能を導入いたしました。サイバー攻撃がますます巧妙化し、クラウドベースのサービスやモバイル デバイスの利用が増加する中、組織がセキュリティを管理するための効果的なツールを導入することは不可欠です。</p><p>本日は、前四半期 (2023 年 4 月～ 6 月) の新機能リリースと既存機能の変更点 (2023 年 6 月の変更管理) をお伝えします。また、これらの変更点は <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/whats-new">リリース ノート</a> や電子メールでもお知らせしています。弊社では、新しい <a href="https://entra.microsoft.com/">Entra 管理センター</a> においても、お客様がライフサイクルの変更 (廃止、引退、サービスの破壊的変更) を管理しやすくなるよう改善を続けています。</p><p>これらの最近のアップデートは、機能エリアまたはテーマごとにまとめておりますので、最新のアップデートを素早く見つけてアクセス出来るようになっています。これらの新機能により、先進的な ID およびアクセス ソリューションをお客様に提供することを目指してまいります。</p><h2 id="製品アップデートの概要"><a href="#製品アップデートの概要" class="headerlink" title="製品アップデートの概要"></a>製品アップデートの概要</h2><ul><li>Azure Active Directory</li><li>Microsoft Entra Permissions Management</li><li>Microsoft Entra Workload Identities</li><li>Microsoft Entra External ID</li><li>Microsoft Entra Identity Governance</li></ul><h2 id="Azure-Active-Directory"><a href="#Azure-Active-Directory" class="headerlink" title="Azure Active Directory"></a>Azure Active Directory</h2><h3 id="新機能のリリース"><a href="#新機能のリリース" class="headerlink" title="新機能のリリース"></a>新機能のリリース</h3><ul><li><a href="https://jpazureid.github.io/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile/">モバイルでの Azure AD 証明書ベースの認証 (CBA)</a></li><li><a href="https://learn.microsoft.com/ja-jp/mem/intune/configuration/use-enterprise-sso-plug-in-ios-ipados-macos?pivots=all">Apple デバイスでのエンタープライズ SSO</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/manage-apps/howto-enforce-signed-saml-authentication">SP-initiated フローでの SAML 要求署名の検証</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/concept-authentication-strengths">条件付きアクセスの認証強度</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/external-identities/authentication-conditional-access#assigning-conditional-access-policies-to-external-user-types">条件付きアクセスにおける外部ユーザーの種類ごとのきめ細かな制御</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/identity-protection/concept-identity-protection-risks#sign-in-risk">Azure AD ID Protection: 検証済み脅威アクター IP のサインインの検知</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/role-based-access-control/role-assignments-portal#step-3-select-the-appropriate-role">既定で安全な構成: Azure RBAC におけるロール選択画面</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/concept-system-preferred-multifactor-authentication">システム優先多要素認証</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/whats-new#general-availability---my-security-info-now-shows-microsoft-authenticator-type">My Security Info の画面での Microsoft Authenticator の種類の表示</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/how-to-mfa-authenticator-lite">Authenticator Lite (Outlook)</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/howto-mfa-mfasettings#report-suspicious-activity">ID Protection と統合された疑わしいアクティビティの報告機能</a></li><li><a href="https://learn.microsoft.com/ja-jp/troubleshoot/azure/active-directory/pending-devices">保留中のデバイスに対する自己修復機能</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/app-provisioning/on-premises-powershell-connector">Azure AD プロビジョニング エージェントを通した PowerShell と Web サービス コネクターのサポート</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/users-default-permissions#restrict-member-users-default-permissions">ユーザーによる新規テナントの作成制限機能</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/users-default-permissions#restrict-member-users-default-permissions">ユーザーによる BitLocker キーへのアクセス制限機能</a></li></ul><h3 id="既存の機能の変更"><a href="#既存の機能の変更" class="headerlink" title="既存の機能の変更"></a>既存の機能の変更</h3><h4 id="My-Security-Info-でのパスワード管理の操作性が向上"><a href="#My-Security-Info-でのパスワード管理の操作性が向上" class="headerlink" title="My Security Info でのパスワード管理の操作性が向上"></a>My Security Info でのパスワード管理の操作性が向上</h4><p>[お客様側での対応は必要なし]</p><p><strong>2023 年 10 月</strong> より、段階的な展開を経て、エンドユーザーによるパスワード管理の体験を改善し、My Security Info 管理ポータル (<a href="https://mysignins.microsoft.com/security-info">My Sign-Ins | Security Info | Microsoft.com</a> でパスワードを管理できるようにする機能を提供します。ユーザーはパスワードを変更できるようになり、多要素認証 (MFA) が可能なユーザーは My Security Info でパスワードをリセットできるようになります。<strong>2023 年 12 月</strong> までに、パスワードを変更するための従来の動作は、この新しい機能にリダイレクトされます。この変更はすべてのお客様に対して自動的に行われますので、お客様側での対応は不要です。</p><h4 id="音声ワンタイム-パスワードの導入"><a href="#音声ワンタイム-パスワードの導入" class="headerlink" title="音声ワンタイム パスワードの導入"></a>音声ワンタイム パスワードの導入</h4><p>[お客様側での対応が必要な場合があります]</p><p>音声通話は、最も安全性の低い認証方法です。MFA を行うには、Microsoft Authenticator (MFA とパスワードレスの両方の選択肢を提供) や、Windows Hello for Businessなど さらに優れた方法があります。弊社では、すべてのお客様に音声通話から別の方法への移行を推奨していますが、音声通話に依存しているお客様もいらっしゃるため、音声通話方式のセキュリティ改善を進めています。新しい方法では、”#” を押して認証を確認するのではなく、ワンタイム パスコード (OTP) が音声通話中にユーザーに読み上げられます。音声による OTP は、現在の SMS 認証方式の発展形である「電話 OTP」認証方式の一部として導入されます。この認証方式には 2 つの配信方法 (SMS と音声 OTP) があり、それらは自動的に最適な方式が選択されて配信されます。従来の # を押す方式は廃止されるため、音声 OTP に移行することをお勧めします。  </p><p><strong>2023 年 7 月</strong> 以降、Azure AD の無償 (Free) ライセンスを使用するすべての新規テナントには、この新しい最適化された配信方法が提供されます。Azure AD Free ライセンスをご利用の既存のテナントには、<strong>8 月</strong> 上旬からこの機能の展開を開始します。Azure AD Premium ライセンスをご利用のお客様については、電話 OTP 認証方法に関するすべての構成が利用可能になった後で展開が開始されます。また別の公のアナウンスにて、今後数ヶ月間にわたるスケジュールをお知らせする予定です。この変更により影響を受けるお客様には、<a href="https://go.microsoft.com/fwlink/p/?linkid=2070717">Microsoft 365 管理センターのメッセージ センター</a> から個別に管理者に通知いたします。</p><h4 id="登録キャンペーンの改善"><a href="#登録キャンペーンの改善" class="headerlink" title="登録キャンペーンの改善"></a>登録キャンペーンの改善</h4><p>[お客様側での対応が必要な場合があります]</p><p>ユーザーが <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/it-s-time-to-hang-up-on-phone-transports-for-authentication/ba-p/1751752">SMS や音声などの公衆交換電話網 (PSTN) から移行</a> できるように、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/how-to-mfa-registration-campaign">登録キャンペーン機能</a> を改善します。最大 3 回までプロンプトをスキップできるようにし、それ以降は登録フローに進む必要があります。</p><p>次に、登録キャンペーンの設定が [Microsoft マネージド] に設定されている Azure AD テナントにおいて、この機能を有効に変更します。これにより、現在 MFA を PSTN 方式 (SMS と音声) に完全に依存しているユーザーに対して登録キャンペーンが有効になります。<strong>2023 年 7 月</strong> 以降、Azure AD の無償ライセンスを持つテナントから段階的にこの変更を開始し、世界中のすべての組織に展開する予定です。スケジュールについては、改めて公開する予定です。この変更がお客様の組織に影響を与えるタイミングになりましたら、<a href="https://go.microsoft.com/fwlink/p/?linkid=2070717">Microsoft 365 管理センターのメッセージ センター</a> で管理者に通知しますので、ご注意ください。</p><h4 id="Azure-AD-での-IPv6-の有効化"><a href="#Azure-AD-での-IPv6-の有効化" class="headerlink" title="Azure AD での IPv6 の有効化"></a>Azure AD での IPv6 の有効化</h4><p>[お客様側での対応が必要な場合があります]</p><p>すべての Microsoft リージョンで IPv6 ロールアウトが <strong>6 月 30 日</strong> に完了するため、Azure AD のお客様に影響が出る可能性があります。ユーザーがブロックされたり、通常よりも多くの MFA リクエストを受け取ったりする可能性があります。このような場合は、テナントのサインインログを確認することをお勧めします。</p><p>テナントの名前付きロケーションに設定されていない IPv6 範囲からエンドユーザーが接続していることが原因でこのような影響が生じている可能性があります。この問題に対処するには、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/location-condition#identifying-ipv6-traffic-with-azure-ad-sign-in-activity-reports">このページ</a> で説明されている手順に従って、テナントの環境で IPv6 の範囲を特定し、必要な設定を構成ください。</p><p>以下のガイダンスを IT 管理チームの関連メンバーと共有することも検討ください: </p><ul><li><p><strong>IT / セキュリティ管理者</strong>: <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/location-condition#identifying-ipv6-traffic-with-azure-ad-sign-in-activity-reports">Azure AD のサインイン アクティビティ レポートでの IPv6 トラフィックを特定する</a> で説明したサインイン レポートを使用します。結果として取得したアドレスの一覧を使用して、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/location-condition#ipv4-and-ipv6-address-ranges">こちら</a> の手順に従って、IPv6 範囲を Azure AD の ネームド ロケーションに追加する必要があるかどうかを判断ください。また、必要に応じて、社内のネットワーク チームと協力して、組織の IPv6 範囲を確認することも重要です。</p></li><li><p><strong>ネットワーク管理者</strong>: IT / セキュリティ管理者と協力して、ネットワーク基盤の IPv6 範囲を特定ください。<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/location-condition#ipv4-and-ipv6-address-ranges">こちら</a> の手順に従って、テナントの既存の Azure AD ネームド ロケーションにこれらの範囲を追加します。</p></li></ul><h4 id="My-Account-が従来のプロフィール-ページに置き換わる"><a href="#My-Account-が従来のプロフィール-ページに置き換わる" class="headerlink" title="My Account が従来のプロフィール ページに置き換わる"></a>My Account が従来のプロフィール ページに置き換わる</h4><p>[お客様側での対応は必要なし]</p><p>継続的なサービス改善の一環として、<strong>2023 年 10 月</strong> に従来のプロフィール ページ (<a href="https://account.activedirectory.windowsazure.com/r/#/profile">https://account.activedirectory.windowsazure.com/r/#/profile</a>) を新しく先進的な My Account の画面に置き換えます。7 月から 10 月にかけて、プロフィール ページ上のバナーで、置き換え予定についてお知らせします。</p><p>10 月になりましたら、プロフィール ページの URL は自動的に My Account にリダイレクトされます。旧 URL を許可リストまたはブックマークに登録していない限り、対応は不要です。許可リストを設定している場合は、My Account を含むように許可リストを更新する必要があります。My Account は本日より <a href="https://myaccount.microsoft.com/">https://myaccount.microsoft.com</a> でアクセスできます。</p><h4 id="ユーザーごとの多要素認証-MFA-設定の最新化"><a href="#ユーザーごとの多要素認証-MFA-設定の最新化" class="headerlink" title="ユーザーごとの多要素認証 (MFA) 設定の最新化"></a>ユーザーごとの多要素認証 (MFA) 設定の最新化</h4><p>[お客様側での対応は必要なし]</p><p>継続的なサービス改善の一環として、<strong>2023 年 10 月</strong> より、<a href="https://entra.microsoft.com/">Microsoft Entra 管理センター</a> の画面デザインに合わせた、最新の “<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/howto-mfa-userstates">ユーザーごとの MFA</a> の設定デザインが展開されます。このユーザー体験のアップデートの一環として、機能が削除されることはありません。この変更はすべてのお客様に対して自動的に行われるため、必要なアクションはありません。</p><h4 id="Azure-AD-Graph-の廃止と-PowerShell-モジュールの非推奨"><a href="#Azure-AD-Graph-の廃止と-PowerShell-モジュールの非推奨" class="headerlink" title="Azure AD Graph の廃止と PowerShell モジュールの非推奨"></a>Azure AD Graph の廃止と PowerShell モジュールの非推奨</h4><p>[お客様側での対応が必要な場合があります]</p><p>2019 年に、弊社では Azure AD Graph サービスの <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/update-your-applications-to-use-microsoft-authentication-library/ba-p/1257363">非推奨を発表</a> し、Azure AD Graph が <strong>2023 年 6 月 30 日</strong> 以降のある時点で機能しなくなることを <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/update-your-applications-to-use-microsoft-authentication-library/ba-p/1257363">お伝え</a> してきました。また、3 つのレガシー PowerShell モジュール (Azure AD、Azure AD Preview、MS Online) が 2023 年 6 月 30 日に非推奨となることも以前にお伝えしました。弊社では、多くのお客様がまだこれらの移行を完了していないことを理解しており、この移行期間中にお客様と協力して影響を最小限に抑え、回避するために引き続き取り組むことをお約束しています。</p><p>弊社は、Azure AD Graph の廃止プロセスと PowerShell モジュールの非推奨化に関するスケジュールおよび詳細に関する最新情報を公開しました。詳細は <a href="https://jpazureid.github.io/blog/azure-active-directory/important-azure-ad-graph-retirement-and-powershell-module/">こちら</a> をご覧ください。</p><p>要約は以下のとおりです: </p><ul><li><strong>PowerShell</strong>: レガシー PowerShell モジュールでサポートされているいくつかのシナリオが、Microsoft Graph PowerShell SDK ではまだ利用できないことを認識しております。このため、レガシー PowerShell モジュールの非推奨日を <strong>2024 年 3 月 30 日</strong> に延期しました。</li><li><strong>Azure AD Graph</strong>: 2023 年 6 月 30 日をもって、Azure AD Graph は廃止サイクルに入ります。6 月 30 日にアプリケーションへの影響はありませんが、Azure AD Graph API には、セキュリティ関連の修正以外の SLA やメンテナンスの保証をいたしません。弊社は、段階的に Azure AD Graph をリタイアすることを宣言しており、各ステップについては 3 カ月前に予告します。最初のステップでは、新しく作成されたアプリケーションが Azure AD Graph を使用できないようにします。次回の更新で、このステップのスケジュールと詳細をお知らせします。</li></ul><p>すべてのお客様に、Azure AD Graph を使用するアプリケーションを Microsoft Graph API に移行し、レガシー モジュールを使用する PowerShell スクリプトの移行を開始することを強くお勧めします。</p><h2 id="Microsoft-Entra-Permissions-Management"><a href="#Microsoft-Entra-Permissions-Management" class="headerlink" title="Microsoft Entra Permissions Management"></a>Microsoft Entra Permissions Management</h2><h3 id="新機能のリリース-1"><a href="#新機能のリリース-1" class="headerlink" title="新機能のリリース"></a>新機能のリリース</h3><ul><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/cloud-infrastructure-entitlement-management/product-privileged-role-insights">Microsoft Entra Permissions Management Azure Active Directory Insights</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/cloud-infrastructure-entitlement-management/product-data-billable-resources">Microsoft Entra Permissions Management: 請求対象リソース</a></li></ul><h2 id="Microsoft-Entra-Workload-Identities"><a href="#Microsoft-Entra-Workload-Identities" class="headerlink" title="Microsoft Entra Workload Identities"></a>Microsoft Entra Workload Identities</h2><h3 id="新機能のリリース-2"><a href="#新機能のリリース-2" class="headerlink" title="新機能のリリース"></a>新機能のリリース</h3><ul><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/workload-identities/workload-identity-federation">マネージド ID 用ワークロード ID フェデレーション</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/whats-new#general-availability---managed-identity-in-microsoft-authentication-library-for-net">.NET 用 Microsoft Authentication Library のマネージド ID</a></li></ul><h2 id="Microsoft-Entra-External-ID"><a href="#Microsoft-Entra-External-ID" class="headerlink" title="Microsoft Entra External ID"></a>Microsoft Entra External ID</h2><h3 id="既存機能の変更"><a href="#既存機能の変更" class="headerlink" title="既存機能の変更"></a>既存機能の変更</h3><h4 id="B2B-サインイン体験の今後の変更点"><a href="#B2B-サインイン体験の今後の変更点" class="headerlink" title="B2B サインイン体験の今後の変更点"></a>B2B サインイン体験の今後の変更点</h4><p>[お客様側での対応は必要なし]</p><p>現在、B2B ゲスト ユーザーがリソース テナントにサインインするよう促されると、背景とロゴのブランドにリソース テナントのものが反映されます。B2B ゲストがユーザー プリンシパル名 (UPN) を入力すると、ロゴはホーム テナントのものに変わりますが、背景のブランドはそのまま変わりません。</p><p>弊社は、クロステナントのコラボレーションの認証リクエストにおけるこのブランドのユーザー体験の変更に取り組んでいます。新しいユーザー体験では、B2B ゲスト ユーザーがサインインを要求された場合、UPN を入力した後、ホーム テナントのログイン ページにリダイレクトされ、ブランドのユーザー体験はリソース テナントではなくホーム テナントのものが反映されます。サインインに成功すると、ユーザーはリソース テナントでアプリにサインインします。</p><p>この変更は <strong>2023 年 7 月</strong> から開始し、<strong>2023 年 10 月</strong> までに完了する予定です。B2B コラボレーションを理解するには、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/external-identities/what-is-b2b">Azure AD B2B コラボレーションの概要</a> をご覧ください。</p><h2 id="Microsoft-Entra-Identity-Governance"><a href="#Microsoft-Entra-Identity-Governance" class="headerlink" title="Microsoft Entra Identity Governance"></a>Microsoft Entra Identity Governance</h2><h3 id="新機能のリリース-3"><a href="#新機能のリリース-3" class="headerlink" title="新機能のリリース"></a>新機能のリリース</h3><ul><li><a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/microsoft-entra-id-governance-is-generally-available/ba-p/2466932">Microsoft Entra ID Governance</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/governance/what-are-lifecycle-workflows">ライフサイクル ワークフロー</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/multi-tenant-organizations/cross-tenant-synchronization-overview">クロステナント同期によるシームレスなアプリケーション アクセス</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/privileged-identity-management/concept-pim-for-groups">グループ用 PIM</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/privileged-identity-management/pim-how-to-change-default-settings#on-activation-require-azure-ad-conditional-access-authentication-context">PIM ロールのアクティブ化にはアクティブ化前に条件付きアクセス ポリシーの評価が必要</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/privileged-identity-management/pim-resource-roles-configure-alerts">Azure でアクティブな永続的ロールの割り当てもしくは PIM 外での割り当てでアラートを発生</a></li><li><a href="https://learn.microsoft.com/en-us/azure/active-directory/authentication/concept-sspr-policy#administrator-reset-policy-differences">セルフ サービス パスワード リセット (SSPR) で PIM の資格ある割り当てと間接的なグループ ロール割り当てをサポート</a></li><li><a href="https://learn.microsoft.com/en-us/azure/active-directory/governance/entitlement-management-logic-apps-integration">エンタイトルメント管理のカスタム拡張属性</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-external-users#review-your-conditional-access-policies">条件付きアクセス ポリシーでエンタイトルメント管理を対象/除外可能に</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/cloud-sync/custom-attribute-mapping">Azure AD Cloud Sync を使用したディレクトリ拡張のサポート</a></li></ul><p>2023 年 7 月 11 日 (火) に開催されるデジタル イベント <a href="https://aka.ms/MSFTEntra">Reimagine secure access with Microsoft Entra</a> をお見逃しなく。ぜひご参加ください！</p><p>ライブまたはリプレイをご覧になるには、<a href="https://aka.ms/MSFTEntra">今すぐご登録</a> ください。</p><p>Shobhit Sahay</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 高田 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 6 月 30 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD に連携している各種証明書、クライアント シークレットの有効期限の抽出方法</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/get-certificates-secrets-expirydateandtime/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/get-certificates-secrets-expirydateandtime/</id>
    <published>2023-07-04T00:00:00.000Z</published>
    <updated>2023-08-18T17:00:11.549Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Azure Identity チームの栗井です。</p><p>Azure AD の [アプリの登録] から各アプリに連携している証明書・クライアント シークレット、ならびに [エンタープライズ アプリケーション] で SAML SSO を構成いただいている場合に登録している SAML 署名証明書は、いずれも有効期限があります。</p><p>Azure Portal の画面上では、有効期限を一覧で確認できないため、Microsoft Graph などの API を利用する必要がございます。</p><p>本記事では、下記公開情報内の Azure AD PowerShell を使用したサンプルをもとに、Microsoft Graph PowerShell を使用して各種証明書・シークレットの有効期限を CSV ファイルに出力する手順を紹介いたします。</p><ul><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/manage-apps/scripts/powershell-export-all-app-registrations-secrets-and-certs">アプリの登録用にシークレットと証明書をエクスポートする</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/manage-apps/scripts/powershell-export-all-enterprise-apps-secrets-and-certs">エンタープライズ アプリのシークレットと証明書をエクスポートする</a></li></ul><div class="alert is-info"><p class="alert-title">Note</p><p>2023/7/12 に上記の公開情報でも Microsoft Graph PowerShell を使用したサンプル スクリプトに書き換えられました。</p><p>公開情報内のサンプル スクリプトについてもサンプルの 1 つとしてご参照ください。</p></div><h2 id="免責事項"><a href="#免責事項" class="headerlink" title="免責事項"></a>免責事項</h2><div class="alert is-important"><p class="alert-title">重要</p><p>こちらで紹介するサンプル スクリプトについては、あくまでもサンプルの情報となります。</p><p>運用環境でそのまま利用されることは想定しておらず、ご利用の際には、十分な検証作業を実施をお願いします。</p><p>執筆時点以降のクラウド サービスの動作変更に伴い、大幅な改変が必要となることがあります。</p><p>(本情報の執筆時点でテスト環境における検証作業は実施していますが、動作を保証するものではありません)</p></div><div class="alert is-info"><p class="alert-title">Note</p><p>また、サンプルについてのサポート サービスの提供はしておりません。</p><p>恐れ入りますが、スクリプトを利用したことで生じる影響、スクリプトの改変や、スクリプトの動作に関するご質問については、 Azure 技術サポートにて受け付けることができない場合があります。</p><p>サンプル スクリプトが動作しない場合などは、 Github Issue やプル リクエストでのレポートをお願いいたします。</p></div><h2 id="事前準備-Microsoft-Graph-PowerShell-SDK-のインストール"><a href="#事前準備-Microsoft-Graph-PowerShell-SDK-のインストール" class="headerlink" title="事前準備: Microsoft Graph PowerShell SDK のインストール"></a>事前準備: Microsoft Graph PowerShell SDK のインストール</h2><p>PowerShell を使用する端末で、Microsoft Graph PowerShell SDK が未インストールの場合は、下記の手順を実施ください。</p><ol><li>Windows 端末上で PowerShell を管理者権限で起動します。</li><li>下記コマンドを実行します。</li></ol><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Install-Module</span> Microsoft.Graph</span><br></pre></td></tr></table></figure><p>インストールの前提事項などの詳細情報は下記公開情報に記載がございますので、ご入用に応じて参照ください。</p><ul><li><a href="https://learn.microsoft.com/ja-jp/powershell/microsoftgraph/installation?view=graph-powershell-beta#installation">Install the Microsoft Graph PowerShell SDK</a></li></ul><h2 id="操作の開始-Azure-AD-への認証"><a href="#操作の開始-Azure-AD-への認証" class="headerlink" title="操作の開始: Azure AD への認証"></a>操作の開始: Azure AD への認証</h2><p>後述の手順を実施いただく前に、下記コマンドを実行のうえ、Azure AD テナントに接続ください。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Connect-MgGraph</span> <span class="literal">-Scopes</span> “Application.Read.All, User.Read.All”</span><br></pre></td></tr></table></figure><p>テナント接続時のサインイン画面では、以下のいずれかのロールを持つ管理者ユーザーの資格情報で認証を実施ください。</p><ul><li>クラウド アプリケーション管理者</li><li>アプリケーション管理者</li><li>グローバル閲覧者</li><li>グローバル管理者</li></ul><p>認証に成功すると、下記メッセージが表示されます。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Welcome To Microsoft Graph!</span><br></pre></td></tr></table></figure><p>テナントに接続後に後述のスクリプトを実行し、各種証明書・シークレットの有効期限を CSV ファイル出力することができます。</p><h2 id="アプリの登録-から確認できるアプリケーションのクライアント-シークレットおよび証明書の有効期限の一括出力"><a href="#アプリの登録-から確認できるアプリケーションのクライアント-シークレットおよび証明書の有効期限の一括出力" class="headerlink" title="[アプリの登録] から確認できるアプリケーションのクライアント シークレットおよび証明書の有効期限の一括出力"></a>[アプリの登録] から確認できるアプリケーションのクライアント シークレットおよび証明書の有効期限の一括出力</h2><p>以下公開情報をもとに、[アプリの登録] から確認できるアプリケーションについての情報をエクスポートするサンプル スクリプトを案内いたします:<br><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/manage-apps/scripts/powershell-export-all-app-registrations-secrets-and-certs">アプリの登録用にシークレットと証明書をエクスポートする</a></p><p>処理順やエクスポートする項目については上記の公開情報となるべく同じにしております。</p><p>案内いたしますサンプルスクリプトでは以下の情報をエクスポートします:</p><ul><li>アプリケーションの表示名</li><li>アプリケーション ID</li><li>クライアント シークレットの有効期限の開始日時 (UTC)</li><li>クライアント シークレットの有効期限の終了日時 (UTC)</li><li>所有者</li><li>所有者のオブジェクト ID</li></ul><h3 id="サンプル-スクリプト-1"><a href="#サンプル-スクリプト-1" class="headerlink" title="サンプル スクリプト 1"></a>サンプル スクリプト 1</h3><p>[アプリの登録] の画面からはアプリケーション オブジェクトの確認ができます。<br>アプリケーション オブジェクトについての説明は本ブログでは割愛いたしますが、詳細を確認されたい方は下記公開情報をご確認ください:<br><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/app-objects-and-service-principals">Azure Active Directory のアプリケーション オブジェクトとサービス プリンシパル オブジェクト</a></p><p>Get-MgApplication コマンドを使用し、アプリケーション オブジェクトの一覧を取得します。<br>その後、アプリケーション オブジェクト内のプロパティを読み取っています。<br>アプリケーション オブジェクトのプロパティの一覧は下記公開情報にございます:<br><a href="https://learn.microsoft.com/ja-jp/graph/api/resources/application?view=graph-rest-1.0#properties">アプリケーション リソースの種類</a></p><p>サンプル スクリプト 1 を実行すると、”Add the Path you’d like us to export the CSV file to, in the format of &lt;C:\Users&lt;USER&gt;\Desktop\Users.csv&gt;” と表示されますので、その後に、ファイルをエクスポートするパスを入力ください。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$Applications</span> = <span class="built_in">Get-MgApplication</span> <span class="literal">-ExpandProperty</span> Owners <span class="literal">-All</span></span><br><span class="line"><span class="variable">$Logs</span> = <span class="selector-tag">@</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$app</span> <span class="keyword">in</span> <span class="variable">$Applications</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="variable">$AppName</span> = <span class="variable">$app</span>.DisplayName</span><br><span class="line">  <span class="variable">$ApplID</span> = <span class="variable">$app</span>.AppId</span><br><span class="line">  <span class="variable">$AppCreds</span> = <span class="variable">$app</span> | <span class="built_in">Select-Object</span> PasswordCredentials, KeyCredentials</span><br><span class="line">  <span class="variable">$secret</span> = <span class="variable">$AppCreds</span>.PasswordCredentials</span><br><span class="line">  <span class="variable">$cert</span> = <span class="variable">$AppCreds</span>.KeyCredentials</span><br><span class="line"></span><br><span class="line">  <span class="variable">$UserIDs</span> = <span class="selector-tag">@</span>()</span><br><span class="line">  <span class="variable">$Owners</span> = <span class="selector-tag">@</span>()</span><br><span class="line">  <span class="keyword">foreach</span> (<span class="variable">$Owner</span> <span class="keyword">in</span> <span class="variable">$app</span>.Owners)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$Owner</span>.AdditionalProperties[<span class="string">&quot;@odata.type&quot;</span>] <span class="operator">-eq</span> <span class="string">&quot;#microsoft.graph.servicePrincipal&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="variable">$Owners</span> += <span class="selector-tag">@</span>&#123;ID = <span class="variable">$Owner</span>.Id; Name = <span class="variable">$Owner</span>.AdditionalProperties[<span class="string">&quot;appDisplayName&quot;</span>]&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$Owner</span>.AdditionalProperties[<span class="string">&quot;@odata.type&quot;</span>] <span class="operator">-eq</span> <span class="string">&quot;#microsoft.graph.user&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="variable">$UserIDs</span> += <span class="variable">$Owner</span>.Id</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable">$OwnerName</span> = <span class="string">&quot;&lt;&lt;No Owner&gt;&gt;&quot;</span></span><br><span class="line">  <span class="variable">$OwnerID</span> = <span class="string">&quot;&lt;&lt;No Owner&gt;&gt;&quot;</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable">$UserIDs</span>.Count <span class="operator">-ne</span> <span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="variable">$UserFilter</span> = <span class="string">&quot;id in (&#x27;<span class="variable">$</span>(<span class="variable">$UserIDs</span> -join &quot;</span><span class="string">&#x27;,&#x27;</span><span class="string">&quot;)&#x27;)&quot;</span></span><br><span class="line">    <span class="comment"># e.g) id in (&#x27;xxxx&#x27;, &#x27;yyyy&#x27;)</span></span><br><span class="line">    <span class="built_in">Get-MgUser</span> <span class="literal">-Filter</span> <span class="variable">$UserFilter</span> | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">      <span class="variable">$Owners</span> += <span class="selector-tag">@</span>&#123;</span><br><span class="line">        ID = <span class="variable">$_</span>.Id;</span><br><span class="line">        Name = <span class="variable">$_</span>.UserPrincipalName</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$OwnerName</span> = <span class="variable">$Owners</span>.Name <span class="operator">-join</span> <span class="string">&quot;;&quot;</span></span><br><span class="line">    <span class="variable">$OwnerID</span> = <span class="variable">$Owners</span>.ID <span class="operator">-join</span> <span class="string">&quot;;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">############################################</span></span><br><span class="line">  <span class="variable">$Log</span> = <span class="built_in">New-Object</span> System.Object</span><br><span class="line"></span><br><span class="line">  <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;ApplicationName&quot;</span> <span class="literal">-Value</span> <span class="variable">$AppName</span></span><br><span class="line">  <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;ApplicationID&quot;</span> <span class="literal">-Value</span> <span class="variable">$ApplID</span></span><br><span class="line">  <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Secret Start Date&quot;</span> <span class="literal">-Value</span> <span class="variable">$Null</span></span><br><span class="line">  <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Secret End Date&quot;</span> <span class="literal">-value</span> <span class="variable">$Null</span></span><br><span class="line">  <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Certificate Start Date&quot;</span> <span class="literal">-Value</span> <span class="variable">$Null</span></span><br><span class="line">  <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Certificate End Date&quot;</span> <span class="literal">-value</span> <span class="variable">$Null</span></span><br><span class="line">  <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Owner&quot;</span> <span class="literal">-Value</span> <span class="variable">$OwnerName</span></span><br><span class="line">  <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Owner_ObjectID&quot;</span> <span class="literal">-value</span> <span class="variable">$OwnerID</span></span><br><span class="line"></span><br><span class="line">  <span class="variable">$Logs</span> += <span class="variable">$Log</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">############################################</span></span><br><span class="line">  <span class="keyword">foreach</span> (<span class="variable">$s</span> <span class="keyword">in</span> <span class="variable">$secret</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="variable">$StartDate</span> = <span class="variable">$s</span>.StartDateTime</span><br><span class="line">    <span class="variable">$EndDate</span> = <span class="variable">$s</span>.EndDateTime</span><br><span class="line"></span><br><span class="line">    <span class="variable">$Log</span> = <span class="built_in">New-Object</span> System.Object</span><br><span class="line"></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;ApplicationName&quot;</span> <span class="literal">-Value</span> <span class="variable">$AppName</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;ApplicationID&quot;</span> <span class="literal">-Value</span> <span class="variable">$ApplID</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Secret Start Date&quot;</span> <span class="literal">-Value</span> <span class="variable">$StartDate</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Secret End Date&quot;</span> <span class="literal">-value</span> <span class="variable">$EndDate</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Certificate Start Date&quot;</span> <span class="literal">-Value</span> <span class="variable">$Null</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Certificate End Date&quot;</span> <span class="literal">-value</span> <span class="variable">$Null</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Owner&quot;</span> <span class="literal">-Value</span> <span class="variable">$OwnerName</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Owner_ObjectID&quot;</span> <span class="literal">-value</span> <span class="variable">$OwnerID</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$Logs</span> += <span class="variable">$Log</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">foreach</span> (<span class="variable">$c</span> <span class="keyword">in</span> <span class="variable">$cert</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="variable">$CStartDate</span> = <span class="variable">$c</span>.StartDateTime</span><br><span class="line">    <span class="variable">$CEndDate</span> = <span class="variable">$c</span>.EndDateTime</span><br><span class="line"></span><br><span class="line">    <span class="variable">$Log</span> = <span class="built_in">New-Object</span> System.Object</span><br><span class="line"></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;ApplicationName&quot;</span> <span class="literal">-Value</span> <span class="variable">$AppName</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;ApplicationID&quot;</span> <span class="literal">-Value</span> <span class="variable">$ApplID</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Certificate Start Date&quot;</span> <span class="literal">-Value</span> <span class="variable">$CStartDate</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Certificate End Date&quot;</span> <span class="literal">-value</span> <span class="variable">$CEndDate</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Owner&quot;</span> <span class="literal">-Value</span> <span class="variable">$OwnerName</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Owner_ObjectID&quot;</span> <span class="literal">-value</span> <span class="variable">$OwnerID</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$Logs</span> += <span class="variable">$Log</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-host</span> <span class="string">&quot;Add the Path you&#x27;d like us to export the CSV file to&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line"><span class="built_in">Write-host</span> <span class="string">&quot;e.g &lt;C:\Users\&lt;USER&gt;\Desktop\Users.csv&gt;&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line"><span class="variable">$Path</span> = <span class="built_in">Read-Host</span></span><br><span class="line"><span class="variable">$Logs</span> | <span class="built_in">Export-CSV</span> <span class="variable">$Path</span> <span class="literal">-NoTypeInformation</span> <span class="literal">-Encoding</span> UTF8</span><br></pre></td></tr></table></figure><h2 id="エンタープライズ-アプリケーション-から確認できる-SAML-アプリケーションのクライアント-シークレットおよび証明書の有効期限の一括出力"><a href="#エンタープライズ-アプリケーション-から確認できる-SAML-アプリケーションのクライアント-シークレットおよび証明書の有効期限の一括出力" class="headerlink" title="[エンタープライズ アプリケーション] から確認できる SAML アプリケーションのクライアント シークレットおよび証明書の有効期限の一括出力"></a>[エンタープライズ アプリケーション] から確認できる SAML アプリケーションのクライアント シークレットおよび証明書の有効期限の一括出力</h2><p>以下公開情報をもとに、SAML 署名証明書の有効期限の一覧を出力するサンプルスクリプトを案内いたします:<br><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/manage-apps/scripts/powershell-export-all-enterprise-apps-secrets-and-certs">エンタープライズ アプリのシークレットと証明書をエクスポートする</a></p><p>処理順やエクスポートする項目については上記の公開情報となるべく同じにしております。</p><p>案内いたしますサンプルスクリプトでは以下の情報をエクスポートします:</p><ul><li>アプリケーションの表示名</li><li>アプリケーション ID</li><li>アプリケーションの作成日時 (UTC)</li><li>証明書の有効期限の開始日時 (UTC)</li><li>証明書の有効期限の終了日時 (UTC)</li><li>所有者</li><li>所有者のオブジェクト ID</li></ul><h3 id="サンプル-スクリプト-2"><a href="#サンプル-スクリプト-2" class="headerlink" title="サンプル スクリプト 2"></a>サンプル スクリプト 2</h3><p>[エンタープライズ アプリケーション] の画面からはサービス プリンシパル オブジェクトの確認ができます。</p><p>Get-MgServicePrincipal コマンドをフィルターを付けて使用し、サービス プリンシパル オブジェクトの一覧の中から SAML ベースの SSO を構成済みのサービスプリンシパルだけを取得します。<br>サンプル スクリプト 2 内のコメントのとおり、2020 年初頭以降に作成されたアプリケーションでは PreferredSingleSignOnMode プロパティに値がセットされますが、それ以前に作成されたアプリケーションでは preferredSingleSignOnMode は null です。<br>2020 年初頭以前に作成された SAML ベースの SSO を構成済みのアプリケーションの一覧については貴社にて管理をお願いいたします。</p><p>その後、サービス プリンシパル オブジェクト内のプロパティを読み取っています。<br>サービス プリンシパル オブジェクトのプロパティの一覧は下記公開情報にございます:<br><a href="https://learn.microsoft.com/ja-jp/graph/api/resources/serviceprincipal?view=graph-rest-1.0#properties">servicePrincipal リソースの種類</a></p><p>サンプル スクリプト 2 を実行すると、”Add the Path you’d like us to export the CSV file to, in the format of &lt;C:\Users&lt;USER&gt;\Desktop\Users.csv&gt;” と表示されますので、その後に、ファイルをエクスポートするパスを入力ください。</p><p>サンプル スクリプト 2 では、SAML ベースの SSO を構成されているアプリケーションを含め全てのアプリケーションを取得することもできます。<br>その場合にはサンプル スクリプト上部の以下箇所のコメントアウトを外してください:<br><code>#$EnterpriseApps = Get-MgServicePrincipal -ExpandProperty Owners -All</code></p><p>その後に以下箇所をコメントアウトしてください:<br><code>$EnterpriseApps = Get-MgServicePrincipal -ExpandProperty Owners -Filter &quot;preferredSingleSignOnMode eq &#39;saml&#39;&quot;</code></p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># すべてのエンタープライズ アプリケーションを取得する場合は以下のコメントアウトを外してください。</span></span><br><span class="line"><span class="comment">#$EnterpriseApps = Get-MgServicePrincipal -ExpandProperty Owners -All</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SAML ベースのSSO を構成しているエンタープライズアプリケーションの一覧を取得</span></span><br><span class="line"><span class="variable">$EnterpriseApps</span> = <span class="built_in">Get-MgServicePrincipal</span> <span class="literal">-ExpandProperty</span> Owners <span class="literal">-Filter</span> <span class="string">&quot;preferredSingleSignOnMode eq &#x27;saml&#x27;&quot;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ※注意事項</span></span><br><span class="line"><span class="comment"># 2020 年初頭 (1 ～ 3 月) 以降に作成されたアプリのみ</span></span><br><span class="line"><span class="comment"># SAML を構成した際に preferredSingleSignOnMode に 値がセットされる動作になりました。</span></span><br><span class="line"><span class="comment"># そのため、2020 年初頭以前に作成されたアプリでは、</span></span><br><span class="line"><span class="comment"># 現在、SAML を構成していても preferredSingleSignOnMode が null となっております。</span></span><br><span class="line"><span class="comment"># 2020 年初頭以前に作成されたアプリの場合、</span></span><br><span class="line"><span class="comment"># PowerShell や Graph API などで SAML を構成していると判別できる値を取得することができず、</span></span><br><span class="line"><span class="comment"># SAML を構成しているアプリ一覧として取得することが難しい状況となります。</span></span><br><span class="line"><span class="comment"># 将来的には、古いアプリにおいても新しいアプリと同様に</span></span><br><span class="line"><span class="comment"># 正しい preferredSingleSignOnMode が取得できるようになることが計画されていることを確認しましたが、</span></span><br><span class="line"><span class="comment"># 対応時期などは未定です</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$Logs</span> = <span class="selector-tag">@</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$Eapp</span> <span class="keyword">in</span> <span class="variable">$EnterpriseApps</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="variable">$AppName</span> = <span class="variable">$Eapp</span>.DisplayName</span><br><span class="line">  <span class="variable">$ApplID</span> = <span class="variable">$Eapp</span>.AppId</span><br><span class="line">  <span class="variable">$CreatedDate</span> = <span class="variable">$Eapp</span>.AdditionalProperties.createdDateTime</span><br><span class="line"></span><br><span class="line">  <span class="variable">$AppCreds</span> = <span class="variable">$Eapp</span> | <span class="built_in">Select-Object</span> PasswordCredentials, KeyCredentials</span><br><span class="line"></span><br><span class="line">  <span class="variable">$UserIDs</span> = <span class="selector-tag">@</span>()</span><br><span class="line">  <span class="variable">$Owners</span> = <span class="selector-tag">@</span>()</span><br><span class="line">  <span class="keyword">foreach</span> (<span class="variable">$Owner</span> <span class="keyword">in</span> <span class="variable">$Eapp</span>.Owners)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$Owner</span>.AdditionalProperties[<span class="string">&quot;@odata.type&quot;</span>] <span class="operator">-eq</span> <span class="string">&quot;#microsoft.graph.servicePrincipal&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="variable">$Owners</span> += <span class="selector-tag">@</span>&#123;ID = <span class="variable">$Owner</span>.Id; Name = <span class="variable">$Owner</span>.AdditionalProperties[<span class="string">&quot;appDisplayName&quot;</span>]&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$Owner</span>.AdditionalProperties[<span class="string">&quot;@odata.type&quot;</span>] <span class="operator">-eq</span> <span class="string">&quot;#microsoft.graph.user&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="variable">$UserIDs</span> += <span class="variable">$Owner</span>.Id</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable">$OwnerName</span> = <span class="string">&quot;&lt;&lt;No Owner&gt;&gt;&quot;</span></span><br><span class="line">  <span class="variable">$OwnerID</span> = <span class="string">&quot;&lt;&lt;No Owner&gt;&gt;&quot;</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable">$UserIDs</span>.Count <span class="operator">-ne</span> <span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="variable">$UserFilter</span> = <span class="string">&quot;id in (&#x27;<span class="variable">$</span>(<span class="variable">$UserIDs</span> -join &quot;</span><span class="string">&#x27;,&#x27;</span><span class="string">&quot;)&#x27;)&quot;</span></span><br><span class="line">    <span class="comment"># e.g) id in (&#x27;xxxx&#x27;, &#x27;yyyy&#x27;)</span></span><br><span class="line">    <span class="built_in">Get-MgUser</span> <span class="literal">-Filter</span> <span class="variable">$UserFilter</span> | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">      <span class="variable">$Owners</span> += <span class="selector-tag">@</span>&#123;</span><br><span class="line">        ID = <span class="variable">$_</span>.Id;</span><br><span class="line">        Name = <span class="variable">$_</span>.UserPrincipalName</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$OwnerName</span> = <span class="variable">$Owners</span>.Name <span class="operator">-join</span> <span class="string">&quot;;&quot;</span></span><br><span class="line">    <span class="variable">$OwnerID</span> = <span class="variable">$Owners</span>.ID <span class="operator">-join</span> <span class="string">&quot;;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable">$secret</span> = <span class="variable">$AppCreds</span>.PasswordCredentials</span><br><span class="line">  <span class="variable">$cert</span> = <span class="variable">$AppCreds</span>.KeyCredentials</span><br><span class="line"></span><br><span class="line">  <span class="comment">############################################</span></span><br><span class="line">  <span class="variable">$Log</span> = <span class="built_in">New-Object</span> System.Object</span><br><span class="line"></span><br><span class="line">  <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;ApplicationName&quot;</span> <span class="literal">-Value</span> <span class="variable">$AppName</span></span><br><span class="line">  <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;ApplicationID&quot;</span> <span class="literal">-Value</span> <span class="variable">$ApplID</span></span><br><span class="line">  <span class="comment">#$Log | Add-Member -MemberType NoteProperty -Name &quot;Created Date&quot; -Value $CreatedDate</span></span><br><span class="line">  <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Secret Start Date&quot;</span> <span class="literal">-Value</span> <span class="variable">$Null</span></span><br><span class="line">  <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Secret End Date&quot;</span> <span class="literal">-value</span> <span class="variable">$Null</span></span><br><span class="line">  <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Certificate Start Date&quot;</span> <span class="literal">-Value</span> <span class="variable">$Null</span></span><br><span class="line">  <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Certificate End Date&quot;</span> <span class="literal">-value</span> <span class="variable">$Null</span></span><br><span class="line">  <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Owner&quot;</span> <span class="literal">-Value</span> <span class="variable">$OwnerName</span></span><br><span class="line">  <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Owner_ObjectID&quot;</span> <span class="literal">-value</span> <span class="variable">$OwnerID</span></span><br><span class="line"></span><br><span class="line">  <span class="variable">$Logs</span> += <span class="variable">$Log</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">############################################</span></span><br><span class="line">  <span class="keyword">foreach</span> (<span class="variable">$s</span> <span class="keyword">in</span> <span class="variable">$secret</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="variable">$StartDate</span> = <span class="variable">$s</span>.StartDateTime</span><br><span class="line">    <span class="variable">$EndDate</span> = <span class="variable">$s</span>.EndDateTime</span><br><span class="line"></span><br><span class="line">    <span class="variable">$Log</span> = <span class="built_in">New-Object</span> System.Object</span><br><span class="line"></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;ApplicationName&quot;</span> <span class="literal">-Value</span> <span class="variable">$AppName</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;ApplicationID&quot;</span> <span class="literal">-Value</span> <span class="variable">$ApplID</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Created Date&quot;</span> <span class="literal">-Value</span> <span class="variable">$CreatedDate</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Secret Start Date&quot;</span> <span class="literal">-Value</span> <span class="variable">$StartDate</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Secret End Date&quot;</span> <span class="literal">-value</span> <span class="variable">$EndDate</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Certificate Start Date&quot;</span> <span class="literal">-Value</span> <span class="variable">$Null</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Certificate End Date&quot;</span> <span class="literal">-value</span> <span class="variable">$Null</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Owner&quot;</span> <span class="literal">-Value</span> <span class="variable">$OwnerName</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Owner_ObjectID&quot;</span> <span class="literal">-value</span> <span class="variable">$OwnerID</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$Logs</span> += <span class="variable">$Log</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">foreach</span> (<span class="variable">$c</span> <span class="keyword">in</span> <span class="variable">$cert</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="variable">$CStartDate</span> = <span class="variable">$c</span>.StartDateTime</span><br><span class="line">    <span class="variable">$CEndDate</span> = <span class="variable">$c</span>.EndDateTime</span><br><span class="line"></span><br><span class="line">    <span class="variable">$Log</span> = <span class="built_in">New-Object</span> System.Object</span><br><span class="line"></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;ApplicationName&quot;</span> <span class="literal">-Value</span> <span class="variable">$AppName</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;ApplicationID&quot;</span> <span class="literal">-Value</span> <span class="variable">$ApplID</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Created Date&quot;</span> <span class="literal">-Value</span> <span class="variable">$CreatedDate</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Certificate Start Date&quot;</span> <span class="literal">-Value</span> <span class="variable">$CStartDate</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Certificate End Date&quot;</span> <span class="literal">-value</span> <span class="variable">$CEndDate</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Owner&quot;</span> <span class="literal">-Value</span> <span class="variable">$OwnerName</span></span><br><span class="line">    <span class="variable">$Log</span> | <span class="built_in">Add-Member</span> <span class="literal">-MemberType</span> NoteProperty <span class="literal">-Name</span> <span class="string">&quot;Owner_ObjectID&quot;</span> <span class="literal">-value</span> <span class="variable">$OwnerID</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$Logs</span> += <span class="variable">$Log</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-host</span> <span class="string">&quot;Add the Path you&#x27;d like us to export the CSV file to&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line"><span class="built_in">Write-host</span> <span class="string">&quot;e.g &lt;C:\Users\&lt;USER&gt;\Desktop\Users.csv&gt;&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line"><span class="variable">$Path</span> = <span class="built_in">Read-Host</span></span><br><span class="line"><span class="variable">$Logs</span> | <span class="built_in">Export-CSV</span> <span class="variable">$Path</span> <span class="literal">-NoTypeInformation</span> <span class="literal">-Encoding</span> UTF8</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>以上です。<br>上記内容が少しでも皆様の参考となりますと幸いです。ご不明な点がございましたら、弊社サポートまでお気軽にお問い合わせください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Azure Identity チームの栗井です。&lt;/p&gt;
&lt;p&gt;Azure AD の [アプリの登録] から各アプリに連携している証明書・クライアント シークレット、ならびに [エンタープライズ アプリケーション] で SAML SSO を構成いただいている場合</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Application" scheme="https://jpazureid.github.io/blog/tags/Application/"/>
    
  </entry>
  
  <entry>
    <title>偽の ID (識別子) のアンチパターン</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/the-false-identifier-anti-pattern/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/the-false-identifier-anti-pattern/</id>
    <published>2023-07-02T00:00:00.000Z</published>
    <updated>2023-08-18T17:00:11.909Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 高田 です。</p><p>本記事は、2023 年 6 月 20 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/the-false-identifier-anti-pattern/ba-p/3846013">The False Identifier Anti-pattern</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>本日は、ID の世界における危険なアンチパターンである <strong>偽の ID (識別子) のアンチパターン</strong> を取り上げます。<a href="https://ja.wikipedia.org/wiki/%E3%82%A2%E3%83%B3%E3%83%81%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3">アンチパターン</a> とは、繰り返し発生する問題に対する一般的な対応策のことで、こういった問題は多くが悪い結果をもたらし、想定と反対の結果をもたらすリスクとなるものです。<a href="https://adactio.com/journal/1357/">パスワードのアンチパターン</a> も聞いたことがあるかもしれません。本日お話しする内容は、もしかしたらより危険なパターンかもしれません。</p><p><strong>偽の ID (識別子) のアンチパターン</strong> は、シングル サインオン時に、アプリケーションまたはサービスが連携 ID プロバイダから受け取るアサーションにおいて、その subject 以外の属性が “一意で持続性があり、信頼できるアカウント識別子である” と想定した際に発生します。</p><p><a href="https://learn.microsoft.com/en-us/azure/active-directory/develop/id-token-claims-reference">OpenID Connect の id_token</a> や <a href="https://learn.microsoft.com/en-us/azure/active-directory/develop/reference-saml-tokens">SAML 2.0 のアサーション</a> などの構造化されたセキュリティ ドキュメントには、電話番号やソーシャル メディアのハンドル名、電子メール アドレスなどのユーザー データが含まれることがあります。これらユーザー情報の詳細は、(電子メールの送信や電話の発信など) 一部のシナリオで一意の識別子として使用され、場合によってはログインの識別子としても使用されます。しかし、”連絡やコラボレーションを目的とした情報属性としてこれら識別子を使用すること” と、”フェデレーションの一連の流れの中でトークンの一部から一意性の保証がない値をピックアップし、その値を一意性のある識別子として使用して認可やデータ アクセスに使用すること” には、決定的な違いがあります。</p><h2 id="OpenID-Connect-でエンド-ユーザーの識別に-subject-以外のクレームを使用することは標準に非準拠である"><a href="#OpenID-Connect-でエンド-ユーザーの識別に-subject-以外のクレームを使用することは標準に非準拠である" class="headerlink" title="OpenID Connect でエンド ユーザーの識別に subject 以外のクレームを使用することは標準に非準拠である"></a>OpenID Connect でエンド ユーザーの識別に subject 以外のクレームを使用することは標準に非準拠である</h2><p>OpenID Connect 1.0 の著者らは、仕様が設計された 10 年前にこのアンチパターンを認識していました。仕様には、すべての Relying Party (SSO のトランザクションから ID 情報を取得するアプリケーションやサービス) が、アカウント キーとして常に sub 属性を使用するべきであるという記載があります。<a href="https://openid.net/specs/openid-connect-core-1_0.html#IDToken">OpenID Connect core specification セクション 2</a> (<a href="http://openid-foundation-japan.github.io/openid-connect-core-1_0.ja.html#IDToken">日本語</a>) では、sub を次のように定義しています:</p><p><img src="/blog/azure-active-directory/the-false-identifier-anti-pattern/sub_ja.png"></p><p>加えて、<a href="https://openid.net/specs/openid-connect-core-1_0.html#ClaimStability">OpenID Connect の仕様 セクション 5.7</a> (<a href="http://openid-foundation-japan.github.io/openid-connect-core-1_0.ja.html#ClaimStability">日本語</a>) では明示的に以下のように述べています。</p><p><img src="/blog/azure-active-directory/the-false-identifier-anti-pattern/claimstability_ja.png"></p><p>OpenID Connect の Relying Party が、トークンに含まれる sub (subject) クレームと発行者 (isser) クレームの組み合わせ以外を OpenID Connect のアカウント識別子として使用すると、連携 ID プロバイダと Relying Party の間で <strong>標準への非準拠</strong> が生じ、仕様に準拠しない動作となるため、潜在的にユーザーにリスクを負わせることになります。もしあなたが Relying Party 側で標準への準拠を担当しているのであれば、やるべきことは一つです。</p><p>OpenID Connect の仕様における明確な要件を確認しておくことは非常に重要です。トークンのペイロードに含まれる一般的なクレームを一意なアカウント識別子として使用してしまうとが、なぜこれほど問題になるのでしょうか？セクション 5.7 の文章に、必要なヒントがすべて示されています。</p><h2 id="ローカルでの一意な識別子"><a href="#ローカルでの一意な識別子" class="headerlink" title="ローカルでの一意な識別子"></a>ローカルでの一意な識別子</h2><p>識別子がローカルで一意である場合、ID プロバイダーはドメイン内のユーザー間で値が重複しないように検出し、重複を防止します。ローカルでの一意性が強制されていれば、シングル サインオン (SSO) 時に 2 つの異なる ID プロバイダーのアカウントが同じ文字列で表されることはありません。しかし、現在の ID 基盤では、ユーザーが複数の組織や企業、学校などのコミュニティに属している場合があり、それらのコミュニティが重複または反復する通信チャネルを保持している可能性は十分にあります。</p><p>テスト用アカウントと本番用アカウントを持っている社員は、両方のアカウントで同じ電話番号を設定するかもしれません。また、非従業員が企業間コラボレーションのために招待されたゲスト アカウントと顧客アカウントを持ち (ID プロバイダの小売サービスを使用するため)、両方とも同じ電子メール アドレスを使用する場合もあります。これらの例では、電子メールと電話番号はローカルで一意ではなく、アカウントを区別するには不十分です。しかし、トークンに含めるペイロードとしては許容されます。これは、これら属性がトークン内で一意性の要件を持たないペイロードの一部であり、トークンの Subject (一意性の要件がある) に関する追加情報を提供するためのものだからです。</p><h2 id="単一の発行者内で再割り当てを行わない"><a href="#単一の発行者内で再割り当てを行わない" class="headerlink" title="単一の発行者内で再割り当てを行わない"></a>単一の発行者内で再割り当てを行わない</h2><p>セクション 5.7 の 2 つ目の節は、属性のライフサイクルに言及しています。電子メール アドレスおよび電話番号とユーザーとの紐づけが解かれるタイミングとしては様々なものがあり得ます。問題はその次に何が起こるかです。識別子が 2 つの異なるタイミングで 2 つの異なるユーザに割り当てられると、後に割り当てられたユーザーが、その前に割り当てられていたユーザーの権限とデータを得てしまうリスクがあります。</p><p>例えば、ある組織が Fred Smith という人を雇い、<a href="mailto:&#102;&#x73;&#109;&#x69;&#x74;&#104;&#64;&#x63;&#x6f;&#x6d;&#x70;&#97;&#x6e;&#121;&#46;&#99;&#x6f;&#109;">&#102;&#x73;&#109;&#x69;&#x74;&#104;&#64;&#x63;&#x6f;&#x6d;&#x70;&#97;&#x6e;&#121;&#46;&#99;&#x6f;&#109;</a> という電子メール アドレスを割り当てたとします。Fred がやがて退職し、Frida Smith が採用され、同じ電子メール アドレスが割り当てられました。この時、例え電子メール アドレスが同じでも、トークンの Subject は Fred と Frida で異なる値である必要があります。これにより、Frida が Fred のデータにアクセスする可能性を防ぐことができます。</p><h2 id="時間が経過した際の安定性"><a href="#時間が経過した際の安定性" class="headerlink" title="時間が経過した際の安定性"></a>時間が経過した際の安定性</h2><p>企業の合併や買収のような事が生じた際に、社外のゲストやパートナーで連絡先情報の変更が生じる可能性についても考慮が必要です。例えば A 社が B 社を買収した場合には、社員の連絡先情報 (電子メール アドレスなど) を変更する必要が生じますが、同時にユーザーが引き続き SSO 可能とすることが重要です。トークンの Subject は、社名の変更、企業の移行、新しい市外局番へのオフィスの移転、その他のイベントが生じても影響を受けないだけの安定性が必要となります。</p><h2 id="現実世界での例"><a href="#現実世界での例" class="headerlink" title="現実世界での例"></a>現実世界での例</h2><p>実例を見ていきましょう。Frida という会計士がいるとします。この人は Company3 という企業で働き、Company1 と Company2 という企業にサービスを提供しています (Company2 では 2 つの部門で働いている)。Frida の専門は RP.com という SaaS の会計アプリケーションで、彼女は一日中そのアプリケーションで様々な顧客のために業務を行っています。Frida が持っている電子メール アドレスは 1 つだけで、これは雇用主である Company3 から得たものです。彼女が 4 つの ID プロバイダーのアカウントにサインインし、RP.com に SSO しようとするとどうなるでしょうか？</p><p><img src="/blog/azure-active-directory/the-false-identifier-anti-pattern/loginfigure1.png" alt="Frida は 3 つの会社において、4 つの異なるアカウントに 1 つの電子メール アドレスを使ってサインインします。トークンの Subject のマッピングはどのようになるべきでしょうか？"></p><h3 id="可能性-1-RP-com-で偽の識別子のアンチパターンを回避した場合"><a href="#可能性-1-RP-com-で偽の識別子のアンチパターンを回避した場合" class="headerlink" title="可能性 1: RP.com で偽の識別子のアンチパターンを回避した場合"></a>可能性 1: RP.com で偽の識別子のアンチパターンを回避した場合</h3><p>RP.com が OpenID Connect の仕様に準拠していれば、Frida は問題なく各アカウントにサインインし、関連するデータを参照したり、適切なユーザーとやりとりしたり出来るでしょう。RP.com は適切なユーザーを適切なセキュリティ コンテキストで処理することになります。</p><p><img src="/blog/azure-active-directory/the-false-identifier-anti-pattern/loginfigure2.png" alt="Frida の 4 つの IdP 上のアカウントが 4 つの Relying Party のアカウントに安全にマッピングされました。"></p><h3 id="可能性-2-RP-com-が偽の識別子のアンチパターンに陥った場合"><a href="#可能性-2-RP-com-が偽の識別子のアンチパターンに陥った場合" class="headerlink" title="可能性 2: RP.com が偽の識別子のアンチパターンに陥った場合"></a>可能性 2: RP.com が偽の識別子のアンチパターンに陥った場合</h3><p>RP.com が電子メール アドレスを安定的な識別子として利用するというアンチパターンにハマってしまった場合、以下のようなことが起こりえます。</p><p>まず 1 つ目は、単一のテナント内でのアカウントの混同です。この場合、ID プロバイダーは RP.com に対し、同じ電子メール アドレスをもつトークンを 2 つの異なるアカウント用のものとして送信することになります。RP.com が Subject を使用していない場合、Frida に (そして彼女の雇用主にも) 面倒な事態が生じます。RP.com は 2 つの異なるアカウントを表すトークンを 1 つのアカウントを表すものと見なしてしまうため、認証プロセスが不安定になり、Frida の業務遂行が困難となる可能性があります。その結果、ユーザーのセッションにおいて Frida の 2 つのアカウントのうち、1 つにしかアクセスできなくなったり、2 つの RP.com アカウント間でバックエンドのデータが不安定に上書きされたりする可能性もあります。仮に Frida が 1 つ目は通常業務用、2 つ目は重要な調査用という目的で Company2 に 2 つのアカウントを持っていた場合、2 つのアカウントが混同されることで、重要なデータが通常のデータと混同され、不適切に処理されてしまう可能性もあります。</p><p><img src="/blog/azure-active-directory/the-false-identifier-anti-pattern/loginfigure3.png" alt="Frida の 4 つの IdP 上のアカウントが、誤ってマッピングされてしまうというよくないパターンです。"></p><h3 id="可能性-3-RP-com-が偽の識別子のアンチパターンの最悪のシナリオに陥った場合"><a href="#可能性-3-RP-com-が偽の識別子のアンチパターンの最悪のシナリオに陥った場合" class="headerlink" title="可能性 3: RP.com が偽の識別子のアンチパターンの最悪のシナリオに陥った場合"></a>可能性 3: RP.com が偽の識別子のアンチパターンの最悪のシナリオに陥った場合</h3><p>RP.com が偽の識別子の最悪なアンチパターンにハマってしまった場合、RP.com が識別子を作成する際に、複数の Relying Party テナント間で電子メール アドレスのみを参照するという最悪なシナリオに陥る可能性もあります。この場合、4 つの異なるユーザー アカウントを表す 4 つの異なるトークンが、同じ文字列として RP.com で 1 つのものとして識別されることになります。</p><p>4 つのアカウントのどれがどのような状況でアクセスされるかは、Relying Party 側がサービスをどのように設計しているかによってきます。Frida がどの IdP のアカウントでサインインしても、常に RP 側の 1 つのアカウントつにしかアクセスできなくなるという可能性もあります。Cookie を発行するテナント固有のスタート ページがある場合もありますし、各テナントに独自のサブドメインがある可能性もありますので、その場合はそれら入り口から各サービスに適切にサインインできるかもしれません。</p><p>最悪のシナリオがより一層悪化するのは、どのテナントのセッションがロードされるかを決定するメカニズムが外部から操作できる場合です。Frida 自身は、あるアカウントと別のアカウントが混同され “なりすまし状態” になることは考えもしないと思いますが、攻撃者はそういったことを考えるでしょう。攻撃者が自分のテナントを登録し、SSO で接続し、Frida の電子メール アドレスを指定することができれば、Frida が RP.com でやり取りする 3 つの会社すべてを危険にさらす事も可能です。</p><p><img src="/blog/azure-active-directory/the-false-identifier-anti-pattern/loginfigure4.png" alt="Frida の 4 つの IdP 上のアカウントが、テナント内でもテナント間でも誤ってマッピングされるという最悪の例です"></p><h2 id="SAML-における偽の識別子"><a href="#SAML-における偽の識別子" class="headerlink" title="SAML における偽の識別子"></a>SAML における偽の識別子</h2><p>OpenID Connect の話題ばかりなので、SAML (Security Assertion Markup Language) の場合はどうだろうかとお考えの方もいると思います。アンチパターンはどちらのプロトコルでも同じですが、SAML の仕様にも、業界がクロス ドメイン識別子に関して学んだ数々の教訓が込められています。SAML の実装がまだ問題になる場合もあるものの、実装の詳細によってニュアンスが異なってきます:</p><ul><li>SAML 仕様は複雑であるため、Relying Party が独自の実装を展開するのは困難です。Relying Party が ID 属性を誤ってマッピングする可能性はありますが、SAML アサーションを検証するライブラリやツールが十分に成熟していることが多く、可能な限りリスクは軽減されています。</li><li>SAML 仕様では、電子メール アドレスが有効かつ一般的に使用されるトークンの Subject です。しかし、SAML の一般的な利用シナリオは、組織が電子メールを「所有」し一意性を強制するという、制限の強い業務用のケースです。一方で、この制限の強いパラダイムは、BYOI (Bring Your Own Identity) および B2B の連携のユースケースによって崩れつつあるため、Relying Party だけでなく ID プロバイダーにとってもリスクが増しているという現状があります。</li><li>SAML 仕様には、OAuth ベースの OpenID Connect が使用するエンドユーザーの同意フローに相当するようなものが実装されていません。これは、管理者が許可すれば、エンドユーザがアプリにアクセスする際に、その利用に同意できるというものです (Azure AD では <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/manage-apps/user-admin-consent-overview">ユーザーと管理者の同意</a> 機能によって管理される)。</li></ul><p>このアンチパターンの認識と対策については、先進的な組織や企業が既に取り組んでいます。<a href="https://docs.oasis-open.org/security/saml-subject-id-attr/v1.0/cs01/saml-subject-id-attr-v1.0-cs01.html#_Toc536097222">SAML V2.0 Subject Identifier Attributes Profile Version 1.0</a> のセクション 2.1 では、2019 年に次のように述べています: “セキュリティ プロトコルとアプリケーションにおける認証対象 (subject) の識別においては、様々な問題が生じた歴史があります。それは表現の不備や、不具合の混入、電子メール アドレスの誤用や特定の市場のみを考慮したアプローチ、意図した意味や制約が正確に伝わらないといったものです。</p><p>SAML と OpenID Connect のどちらの ID プロバイダーも、偽の識別子のアンチパターンのリスクにさらされる可能性がありますが、OpenID Connect の仕様策定者の功績により、仕様に準拠した認定済みの ID プロバイダーは十分に保護されているといえます。</p><p>トークンの対象者を表す識別子 (Subject) は、ライブラリまたはクラウド基盤のレベルで生成されることが多く、通常は管理者がデータストアから接続ごとに個別にマッピングするような情報ではありません。もし SAML ID プロバイダーの管理者が、SAML アサーションにおいて電子メール アドレスを対象ユーザーの識別子として使用し、さらには対象の Relying Party に対して認可されたユーザーが、ローカルで一意であることが保証されず、再割り当てされないことも保証されず、長期間にわたって不変であることも保証されない電子メール アドレスを持っていたとすると、その組織は偽の識別子のアンチパターンの餌食となり、危険なリスクを負うことになります。</p><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>世の中にある Relying Party に対するメッセージはシンプルで、<strong>連携アカウントを識別する際には、常にトークンの Subject と発行者 (Issuer) を一緒に使用してプライマリ キーを形成する</strong> ということです。</p><p>ID プロバイダーに対するメッセージも同様で: <strong>SSO のために生成されるトークンの Subject は、常にローカルで一意であり、決して再割り当てされず、長期にわたって安定していることを保証する</strong> ことです。</p><p>これら 2 つのルールに従うことで、アンチパターンを回避し、すべてのユーザーを適切かつ安全にマッピングください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 高田 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 6 月 20 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>テナント制限 v2 がパブリック プレビューになりました</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/tenant-restriction-v2-is-now-public-preview/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/tenant-restriction-v2-is-now-public-preview/</id>
    <published>2023-07-01T23:00:00.000Z</published>
    <updated>2023-08-18T17:00:11.905Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 五十嵐 です。</p><p>本記事は、2023 年 5 月 25 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/tenant-restriction-v2-is-now-public-preview/ba-p/3094113">Tenant Restriction v2 is now Public Preview!</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>みなさま、こんにちは。</p><p>この度、当社の商用クラウドにおいて、テナント制限 v2 (TRv2) のパブリック プレビューを開始することになりましたことをお知らせいたします！</p><p>TRv2 の利用により、データ流出リスクを抑えつつ、安全で生産的な企業間コラボレーションを実現することができます。テナント制限の設定では、外部で発行された ID を使用して、ユーザーが自社のデバイスやネットワークからアクセスできる外部テナントを制御し、組織、ユーザー、グループ、アプリケーション単位できめ細かいアクセス制御を提供することができます。</p><p>テナント制限は、以前リリースされた <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/collaborate-more-securely-with-new-cross-tenant-access-settings/ba-p/2147077">外部コラボレーション用のクロステナント アクセス設定</a> (日本語訳したブログは <a href="./azure-active-directory/collaborate-more-securely-with-new-cross-tenant-access-settings/">こちら</a>) に待望の拡張を加えたものです。これらを組み合わせることで、企業間のセキュリティとコラボレーション ポリシーを最も細かく制御することができます。</p><p>TRv2 への対応については、Microsoft Entra のプロダクト マネージャーである Vimala Ranganathan を招き、詳細を説明いたします。</p><p>よろしくお願いいたします。</p><p>Robin Goldstein (Twitter: <a href="https://twitter.com/RobinGo_MS">@RobinGo_MS</a>)<br>Partner Director of Product Management<br>Microsoft Identity Division</p><hr><p>みなさま、こんにちは。</p><p>今回は私 Vimala がテナント制限 v2 (TRv2) について説明いたします。</p><p>弊社では、M365 クラウド サービスに移行するお客様、特に組織の境界を越えてコラボレーションする必要があるお客様にとって、データの流出が大きな懸念事項であると伺っています。TRv2 はこのような懸念に対応するもので、トークンの悪用による侵入や、外部の SharePoint Online のデータへの匿名アクセス、外部の Teams 会議への匿名参加などによる情報漏えいを防ぎ、安全な外部コラボレーションを実現します。</p><p>現行のテナント制限はオンプレミスのプロキシ サーバーを使用しており、Azure Active Directory (Azure AD) によるクラウド認証時にのみ強制されていましたが、TRv2 はこれを改良しています。テナント制限 v2 を使用することで、外部組織から発行されたアカウントや未知のテナントで作成されたアカウントなどを含め、外部で発行された ID を使用してユーザーがネットワークやデバイスから外部アプリケーションにアクセスできるかどうかを管理者が制御できるようになります。</p><p>TRv2 はクラウド側のポリシーを使用し、認証とデータ プレーン保護の両方を提供します。ユーザー認証時に加え、Exchange Online、SharePoint Online、Teams、MS Graph などデータ プレーンへのアクセス時にもポリシーを適用することができます。</p><h2 id="テナント制限-V2-TRv2"><a href="#テナント制限-V2-TRv2" class="headerlink" title="テナント制限 V2 (TRv2)"></a>テナント制限 V2 (TRv2)</h2><p>TRv1 とは異なり、TRv2 では組織が所有するデバイス上および組織のネットワーク上で、外部発行の ID を使用してユーザーがどの外部テナントにアクセスできるかをテナント管理者が制御することができます。</p><p>例えば、Alice は Contoso 社の社員で、Fabrikam 社とコンサルティング業務を行っているとします。Fabrikam 社は Alice が Fabrikam 社のリソースにアクセスするために、ユーザー アカウントを発行します。Alice は Contoso 社のネットワークで Contoso 社が発行したデバイスを使用しながら、Fabrikam 社のリソースにアクセスする必要があります。Contoso 社の管理者である Cathy は、Alice の Fabrikam 社のアカウントへのアクセスを可能にする以外は、自身の組織のデバイスからの他のすべての外部 ID を使用したアクセスをブロックすることによって、データ流出のリスクを抑制したいと考えています。TRv2 の機能により、Alice は Contoso 社の完全な管理下にありながら、組織の境界を越えて活動することができます。</p><h2 id="テナント制限-v2-TRv2-のメリット"><a href="#テナント制限-v2-TRv2-のメリット" class="headerlink" title="テナント制限 v2 (TRv2) のメリット"></a>テナント制限 v2 (TRv2) のメリット</h2><p>TRv2 は以下の機能を提供します:</p><ul><li>すべての外部テナントに適用される既定のポリシー設定。</li><li>外部テナントに対する連携組織ごとのコラボレーション ポリシーの作成。</li><li>外部で発行されたユーザー ID が他の組織にアクセスする方法の制御。</li><li>特定の組織の特定のユーザーとグループのみにアクセス許可を制限。</li><li>ユーザーが外部組織で発行された ID を使用してアクセスできるようにしたい外部組織のすべてのアプリまたは特定のアプリの指定。</li><li>許可されていないテナントの認証リクエストを Azure AD でブロック - <strong>認証プレーンの保護</strong>。</li><li>MS クラウド サービスではリソース アクセスにテナント制限のポリシーを強制 - トークンの悪用による侵入を防止 <strong>データ プレーンの保護</strong>。</li><li>Teams 会議への <strong>匿名アクセスをブロックし</strong>、匿名で共有されたリソース (リンクがあればだれでもアクセスできる) へのアクセスをブロック。</li><li>Exchange Online の基本認証が許可されている場合でも、外部テナントへのアクセスをブロック。</li><li>Azure Active Directory (AAD) への通信を許可するのに社内プロキシに許可テナントを追加する工数が不要。</li><li>クラウド ポリシーを設定するためにポータル UX をサポート。</li></ul><h2 id="テナント制限ポリシーの設定"><a href="#テナント制限ポリシーの設定" class="headerlink" title="テナント制限ポリシーの設定"></a>テナント制限ポリシーの設定</h2><ol><li><p>既定の TRv2 ポリシーを設定:</p><p> Contoso 社は、ユーザーが Contoso 社のネットワークとデバイスを使用しながら、パートナーと連携する方法を制限したいとします。Contoso 社の管理者 Cathy は、まずすべての連携先テナントに適用される既定のポリシーを設定します。既定のポリシーでは、管理者はすべての外部テナント、およびすべての外部ユーザーとグループへのアクセスをブロックします。</p><p> <img src="/blog/azure-active-directory/tenant-restriction-v2-is-now-public-preview/tenant-restriction-v2-is-now-public-preview1.png" alt="既定の TRv2 ポリシーの設定画面"></p></li><li><p>テナント固有の TRv2 ポリシーを設定:</p><p> Contoso 社の管理者である Cathy は、Fabrikam 社用のポリシーを設定し、Alice のみが Fabrikam 社の ID を使用して Office 365 などの特定のアプリケーションにアクセスすることを許可します。</p><p> <img src="/blog/azure-active-directory/tenant-restriction-v2-is-now-public-preview/tenant-restriction-v2-is-now-public-preview2.png" alt="テナント固有の TRv2 ポリシーの設定画面"></p></li><li><p>デバイスにてクライアント側の TRv2 を有効化:</p></li></ol><p>テナント管理者である Cathy は Windows の GPO の詳細画面で、TRv2 クラウド ポリシーのテナント ID とポリシー ID を設定します。これにより、Contoso 社の全デバイスから、Microsoft への送信リクエストに対し、OS が TRv2 ポリシーへの参照を挿入するようになります。</p><p><img src="/blog/azure-active-directory/tenant-restriction-v2-is-now-public-preview/tenant-restriction-v2-is-now-public-preview3.png" alt="Windows GPO のポリシー設定画面"></p><p>上記の設定により、Contoso 社の管理者は、Contoso 社のデバイスやネットワークから外部 ID を使用した外部テナントへのアクセスをすべてブロックし、加えて Fabrikam 社に対する固有のポリシーにより、Alice にのみ Alice の Fabrikam 社の ID を使用して Fabrikam 社の Office 365 アプリケーションへアクセスすることを許可できました。</p><h2 id="だれが自社のデバイスやネットワークから外部組織のリソースにアクセスしているかを把握する"><a href="#だれが自社のデバイスやネットワークから外部組織のリソースにアクセスしているかを把握する" class="headerlink" title="だれが自社のデバイスやネットワークから外部組織のリソースにアクセスしているかを把握する"></a>だれが自社のデバイスやネットワークから外部組織のリソースにアクセスしているかを把握する</h2><p>サインイン ログから、Contoso 社の管理者は Contoso 社のユーザーがどの外部テナントを使って外部組織にアクセスし、ブロックされているかを確認することができます。</p><p><img src="/blog/azure-active-directory/tenant-restriction-v2-is-now-public-preview/tenant-restriction-v2-is-now-public-preview4.png" alt="テナント制限でブロックされた場合のサインイン ログ"></p><p>クロステナント アクセス設定にあるテナント制限 v2 の詳細については <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/external-identities/tenant-restrictions-v2#step-3-enable-tenant-restrictions-on-windows-managed-devices">ドキュメント</a> をお読みください。</p><p>ありがとうございました。</p><p>Vimala</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 五十嵐 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 5 月 25 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techc</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD Connect Sync Configuration Documenter 使用方法</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory-connect/azure-ad-connect-AADConnectConfigDocumenter/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory-connect/azure-ad-connect-AADConnectConfigDocumenter/</id>
    <published>2023-06-29T00:00:00.000Z</published>
    <updated>2023-08-18T17:00:11.033Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの小出です。</p><p>今回は、 Azure AD Connect Sync Configuration Documenter 使用方法をご案内します。<br><a href="/blog/master/README/">こちら</a> に記載されている手順の解説となります。</p><p>本ツールは 2 台の Azure AD Connect サーバーの設定をレポート上で差分比較する際に利用するツールとなります。</p><p>本ブログでは出力されたレポートについて、具体的にどのような観点を確認すべきかを追記しておりますので、参考となれば幸いです。  </p><h2 id="Azure-AD-Connect-Sync-Configuration-Documenter-とは"><a href="#Azure-AD-Connect-Sync-Configuration-Documenter-とは" class="headerlink" title="Azure AD Connect Sync Configuration Documenter とは"></a>Azure AD Connect Sync Configuration Documenter とは</h2><p>2 台の Azure AD Connect の設定内容や同期ルールを比較するためのツールです。<br>各 Azure AD Connect にて設定情報を XML ファイルとしてエクスポートし、HTML レポート ファイルで比較情報を表示することができます。</p><p>同じバージョンで 2 台目以降の Azure AD Connect サーバーをステージングモードとして構築した際に両者の設定に差分がないかをレポートとして確認することが可能です。</p><p>特に、2 台目以降の Azure AD Connect サーバーを手動でインストールした場合は手作業によるミスを発見することに役立ちますので是非ご活用ください。</p><div class="alert is-warning"><p class="alert-title">警告</p><p>・このツールは 2 台の Azure AD Connect の設定値を比較するものとなりますため、サーバー名や次回同期の時刻など、必ず差異が発生する項目がありますのでご留意ください。</p><p>・ 2 台の Azure AD Connect サーバーが異なるバージョンで動作している場合も差分をレポート出力することは可能ですが、バージョンが異なる場合は差分項目が非常に多くなります。可能であれば同一バージョンの設定を比較することご検討いただけますと幸いです。</p><p>・ このツールを使用して取得した設定値について、それぞれの項目がどのようなものであるかを網羅的にご案内したり、出力された結果について影響がないかの判断をしたりするご支援は、現在弊社サポートでは承っておりません。レポートの出力結果をもとに、最終的にはお客様側で設定値の比較・判断を実施ください。</p></div><h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><ol><li>比較情報を確認するサーバーにて <a href="https://github.com/Microsoft/AADConnectConfigDocumenter/releases">Azure AD Connect Configuration Documenter</a> をダウンロードします。<br>ページ内の AzureADConnectSyncDocumenter.zip をクリックしてダウンロードします。  </li><li>ダウンロードした AzureADConnectSyncDocumenter.zip を任意のディレクトリに展開します。</li><li>展開した AzureADConnectSyncDocumenter フォルダー配下の Data フォルダーに各サーバー用のフォルダーを作成します。</li></ol><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">　 例) C:\temp\AzureADConnectSyncDocumenter\Data\AADCServer001 , C:\temp\AzureADConnectSyncDocumenter\Data\AADCServer002  </span><br></pre></td></tr></table></figure><ol><li>各 Azure AD Connect サーバーにて設定ファイルを取得します。</li></ol><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-ADSyncServerConfiguration</span> <span class="literal">-Path</span> <span class="string">&quot;出力先へのパス&quot;</span></span><br></pre></td></tr></table></figure><p>(実行例)  </p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-ADSyncServerConfiguration</span> <span class="literal">-Path</span> <span class="string">&quot;C:\temp\AADC001&quot;</span></span><br></pre></td></tr></table></figure><ol start="5"><li><p>手順 4. で出力した下記のフォルダーを 3. で作成したフォルダーにサーバー毎にコピーします。<br>  Connectors<br>  GlobalSettings<br>  SynchronizationRules  </p></li><li><p>手順 2. で展開したフォルダー内の AzureADConnectSyncDocumenter-contoso.cmd をテキスト エディターで開きます。</p></li><li><p>下記箇所を手順 3. で作成したフォルダー名に合わせて、保存します。</p></li></ol><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AzureADConnectSyncDocumenterCmd.exe &quot;Contoso\Pilot&quot; &quot;Contoso\Production&quot;  </span><br><span class="line">例) AzureADConnectSyncDocumenterCmd.exe &quot;AADCServer001&quot; &quot;AADCServer002&quot;  </span><br></pre></td></tr></table></figure><ol start="8"><li><p>AzureADConnectSyncDocumenter-contoso.cmd のファイル名を AzureADConnectSyncDocumenter.cmd に変更します。  </p></li><li><p> 下記コマンドを実行します。</p></li></ol><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">.\AzureADConnectSyncDocumenter.cmd</span><br></pre></td></tr></table></figure><ol start="10"><li>コマンド実行後に AzureADConnectSyncDocumenter\Report 配下に HTML ファイルが生成されます。</li><li>レポート内の Create / Update / Delete 項目で差分内容を確認します。  下記の “Only Show Changes” チェックを有効にすることで差分のみ表示可能となります。緑枠部分に、各サーバーのバージョンが表示されますので確認します。</li></ol><p><img src="/blog/azure-active-directory-connect/azure-ad-connect-AADConnectConfigDocumenter/aadc-documenter1.png" alt="aadc-documenter1"></p><h2 id="差分内容につきまして"><a href="#差分内容につきまして" class="headerlink" title="差分内容につきまして"></a>差分内容につきまして</h2><p>上記にて表示された差分内容のファイルの中で、特に注意して確認してほしい点は、「現行のサーバーには設定されているのに、新しいサーバーでは削除されている・設定値が異なっている」パターンの差異です。<br>主な確認ポイントについては下記を参考ください。</p><h3 id="端末固有の値のため、一般的に無視してもよいもの"><a href="#端末固有の値のため、一般的に無視してもよいもの" class="headerlink" title="端末固有の値のため、一般的に無視してもよいもの"></a>端末固有の値のため、一般的に無視してもよいもの</h3><p>・ ステージングモードの有効・無効<br>・ 次回同期の日時やサーバー名など、サーバーによって異なる値</p><h3 id="設定を改めて確認してほしいもの"><a href="#設定を改めて確認してほしいもの" class="headerlink" title="設定を改めて確認してほしいもの"></a>設定を改めて確認してほしいもの</h3><p>・上記以外で何等かの設定差異がある場合は、改めて設定の見直しをお願いします</p><h2 id="参考情報"><a href="#参考情報" class="headerlink" title="参考情報"></a>参考情報</h2><p>2 台目以降の Azure AD Connect サーバーを手動でインストールする場合は、本ツールで差分比較を行うことを推奨します。</p><p>なお、Azure AD Connect サーバーでは設定情報を JSON ファイルとしてエクスポートして別のサーバーにインストールすることも可能です。<br>この場合手作業による設定ミスがなくなりますので、<a href="https://jpazureid.github.io/blog/azure-active-directory-connect/aadc-import-export-config/">こちら</a> もご活用ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの小出です。&lt;/p&gt;
&lt;p&gt;今回は、 Azure AD Connect Sync Configuration Documenter 使用方法をご案内します。&lt;br&gt;&lt;a href=&quot;/blog/master/READ</summary>
      
    
    
    
    
    <category term="Azure AD Connect" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-Connect/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD Connect の通信要件</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory-connect/port-used-by-aadc/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory-connect/port-used-by-aadc/</id>
    <published>2023-06-28T15:00:00.000Z</published>
    <updated>2023-08-18T17:00:11.133Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>本記事は Technet Blog の更新停止に伴い <a href="https://blogs.technet.microsoft.com/jpazureid/2018/07/03/azure-ad-connect-requirement/">こちらの記事</a> の内容を移行したものです。</p><p>元の記事の最新の更新情報については、本内容をご参照ください。</p><p>なお、本記事は 2018 年 7 月 3 日に「Azure AD Connect サーバー - ウィルス対策ソフト除外項目 / 使用する通信ポート」 として公開しておりましたが、情報が古くなってまいりましたので、最新情報として改めて更新のうえ公開しております。</p></div><p>こんにちは！ Azure Identity サポートの小出です。<br>今回は、 Azure AD Connect の通信要件についてのまとめをご案内します。</p><h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><p>Azure AD Connect は、オンプレミス AD と Azure AD のアカウントを連携するために使われているサービスです。<br>すでに多くのお客様にご利用いただき、ハイブリッド環境を構築されている企業様も多いと思いますが、これから Azure AD Connect を利用したいと検討されているお客様のなかには、どのような通信を許可すればよいか確認されたい方もいらっしゃるかと思います。</p><p>Azure AD Connect の通信要件に関しては、弊社サポートにもよくお問い合わせをいただいておりますが、公開情報の記載が複数にまたがっており、どこのページを見ればよいか分かりにくい状況でした。</p><p>そこで今回は、様々な公開情報の記載を確認しなくてもよい形で、 Azure AD Connect の通信要件の情報をおまとめします。</p><h2 id="A-最低限許可してほしい通信"><a href="#A-最低限許可してほしい通信" class="headerlink" title="A. 最低限許可してほしい通信"></a>A. 最低限許可してほしい通信</h2><h3 id="Azure-AD-Connect-を利用するための要件"><a href="#Azure-AD-Connect-を利用するための要件" class="headerlink" title="Azure AD Connect を利用するための要件"></a>Azure AD Connect を利用するための要件</h3><p>最低限必要なポートは、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/connect/reference-connect-ports#table-1---azure-ad-connect-and-on-premises-ad">本公開情報</a> に記載の 表 １ と表 2 です。その他、環境に応じて表 3 以降のポートを開ける必要もありますが、ここでは省略します。</p><p><img src="/blog/azure-active-directory-connect/port-used-by-aadc/aadc-port-0626-1.png" alt="aadc-port-0626-1"></p><p><img src="/blog/azure-active-directory-connect/port-used-by-aadc/aadc-port-0626-2.png" alt="aadc-port-0626-2"></p><p>また、 Azure AD Connect をご利用いただくにあたって、許可いただく必要のある URL は下記の通りです。<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/connect/tshoot-connect-connectivity#troubleshoot-connectivity-issues-in-the-installation-wizard">本公開情報</a> に記載がございます。</p><p><img src="/blog/azure-active-directory-connect/port-used-by-aadc/aadc-port-0626-3.png" alt="aadc-port-0626-3"></p><p>もし上記 URL を許可してもエラーが発生する、正しく動作しない場合などは、まず <a href="https://learn.microsoft.com/ja-jp/microsoft-365/enterprise/urls-and-ip-address-ranges?redirectSourcePath=%252farticle%252fOffice-365-URLs-and-IP-address-ranges-8548a211-3fe7-47cb-abb1-355ea5aa88a2&view=o365-worldwide">本公開情報</a> に記載されている ID 56、ID 59、ID 125 に記載の URL を許可して様子を確認してください。</p><h3 id="Azure-AD-Connect-Health-を利用するための要件"><a href="#Azure-AD-Connect-Health-を利用するための要件" class="headerlink" title="Azure AD Connect Health を利用するための要件"></a>Azure AD Connect Health を利用するための要件</h3><p>Azure AD Connect Health を利用するにあたって必要なポートにつきましては、まず<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/connect/reference-connect-ports#table-1---azure-ad-connect-and-on-premises-ad">本公開情報</a> の表 7 をご確認ください。</p><p>また、以下の URL についても許可リストに追加してください。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">*.blob.core.windows.net</span><br><span class="line">*.aadconnecthealth.azure.com</span><br><span class="line">**.servicebus.windows.net - ポート: (5671 がブロックされている場合、エージェントは 443 にフォールバックしますが、5671を使用することをお勧めします。 このエンドポイントは、エージェントの最新バージョンでは必要ありません。)</span><br><span class="line">*.adhybridhealth.azure.com/</span><br><span class="line">https://management.azure.com</span><br><span class="line">https://policykeyservice.dc.ad.msft.net/</span><br><span class="line">https://login.windows.net</span><br><span class="line">https://login.microsoftonline.com</span><br><span class="line">https://secure.aadcdn.microsoftonline-p.com</span><br><span class="line">https://www.office.com (このエンドポイントは、登録時の検出目的でのみ使用されます。)</span><br><span class="line">https://aadcdn.msftauth.net</span><br><span class="line">https://aadcdn.msauth.net</span><br></pre></td></tr></table></figure><p>Azure AD Connect Health でエラーが発生するお問い合わせには、上記の URL が許可されていない、プロキシ環境などで TLS 終端機能が使用されている場合などが多く見受けられます。<br>Azure AD Connect Health をご利用の際には、上記を含めた前提条件を満たすかご確認ください。<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/connect/how-to-connect-health-agent-install#outbound-connectivity-to-the-azure-service-endpoints">こちらの公開情報</a>に記載があります。</p><h3 id="Azure-AD-クラウド同期（Cloud-Sync）を利用するために必要な要件"><a href="#Azure-AD-クラウド同期（Cloud-Sync）を利用するために必要な要件" class="headerlink" title="Azure AD クラウド同期（Cloud Sync）を利用するために必要な要件"></a>Azure AD クラウド同期（Cloud Sync）を利用するために必要な要件</h3><p>Azure AD Connect ではなく、新しい Azure AD Cloud Sync をご利用のお客様は、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/cloud-sync/how-to-prerequisites?tabs=public-cloud#firewall-and-proxy-requirements">こちらの要件</a>をご確認ください。</p><p>エージェントから Azure AD に送信要求を発行できるように、下記のポートを許可してください。</p><p><img src="/blog/azure-active-directory-connect/port-used-by-aadc/aadc-port-0626-4.png" alt="aadc-port-0626-4"></p><p>また、必要に応じて以下の URL を追加し、エージェントと Azure AD が通信できるように設定してください。</p><p><img src="/blog/azure-active-directory-connect/port-used-by-aadc/aadc-port-0626-5.png" alt="aadc-port-0626-5"></p><h2 id="B-要望や環境に応じて許可してほしい通信"><a href="#B-要望や環境に応じて許可してほしい通信" class="headerlink" title="B. 要望や環境に応じて許可してほしい通信"></a>B. 要望や環境に応じて許可してほしい通信</h2><h3 id="Azure-ポータルにアクセスするための要件"><a href="#Azure-ポータルにアクセスするための要件" class="headerlink" title="Azure ポータルにアクセスするための要件"></a>Azure ポータルにアクセスするための要件</h3><p>プロキシ環境で Azure ポータルにアクセスできない時は、<a href="https://learn.microsoft.com/ja-jp/azure/azure-portal/azure-portal-safelist-urls?tabs=public-cloud#azure-portal-urls-for-proxy-bypass">こちらの公開情報</a>の URL が許可されていないことが原因である可能性があります。<br>そのため、プロキシ環境でご利用のお客様は、上記必ず必要な通信のほかに、下記 URL も許可リストに追加してください。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">*.aadcdn.microsoftonline-p.com</span><br><span class="line">*.aka.ms</span><br><span class="line">*.applicationinsights.io</span><br><span class="line">*.azure.com</span><br><span class="line">*.azure.net</span><br><span class="line">*.azure-api.net</span><br><span class="line">*.azuredatalakestore.net</span><br><span class="line">*.azureedge.net</span><br><span class="line">*.loganalytics.io</span><br><span class="line">*.microsoft.com</span><br><span class="line">*.microsoftonline.com</span><br><span class="line">*.microsoftonline-p.com</span><br><span class="line">*.msauth.net</span><br><span class="line">*.msftauth.net</span><br><span class="line">*.trafficmanager.net</span><br><span class="line">*.visualstudio.com</span><br><span class="line">*.asazure.windows.net (Analysis Services)</span><br><span class="line">*.core.windows.net (Azure Storage)</span><br><span class="line">*.database.windows.net (SQL Server) </span><br><span class="line">*.graph.windows.net (Azure AD Graph)</span><br><span class="line">*.kusto.windows.net (Azure Data Explorer/Kusto)</span><br><span class="line">*.search.windows.net (search)</span><br><span class="line">*.servicebus.windows.net (Azure Service Bus)</span><br></pre></td></tr></table></figure><h3 id="シームレス-SSO-に必要な要件"><a href="#シームレス-SSO-に必要な要件" class="headerlink" title="シームレス SSO に必要な要件"></a>シームレス SSO に必要な要件</h3><p>ファイアウォールまたはプロキシで許可している場合は、*.msappproxy.net もしくは tenantid.registration.msappproxy.net の URL に対するポート 443 での許可リストへの接続を追加します。<br>詳細につきましては、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/connect/how-to-connect-sso-quick-start#step-1-check-the-prerequisites">本公開情報</a>の前提条件をご確認ください。</p><h3 id="パスワード-ライトバックに必要な要件"><a href="#パスワード-ライトバックに必要な要件" class="headerlink" title="パスワード ライトバックに必要な要件"></a>パスワード ライトバックに必要な要件</h3><p>パスワードライトバックは以下に対し接続を行いますので、利用される場合は下記への通信も許可してください。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">*.passwordreset.microsoftonline.com</span><br><span class="line">*.servicebus.windows.net</span><br></pre></td></tr></table></figure><h3 id="パススルー認証を使う際に必要な通信要件"><a href="#パススルー認証を使う際に必要な通信要件" class="headerlink" title="パススルー認証を使う際に必要な通信要件"></a>パススルー認証を使う際に必要な通信要件</h3><p>パススルー認証に必要な通信要件は、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/connect/how-to-connect-pta-quick-start">こちらの公開情報</a>に記載があります。<br>まずは下記のポートを使用して通信ができるよう、ファイアウォールなどの設定をご確認ください。</p><p><img src="/blog/azure-active-directory-connect/port-used-by-aadc/aadc-port-0626-6.png" alt="aadc-port-0626-6"></p><p>また、公開情報に記載の通り、下記 URL への通信も許可してください。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">*.msappproxy.net </span><br><span class="line">*.servicebus.windows.net </span><br><span class="line">autologon.microsoftazuread-sso.com （発信 HTTP プロキシを利用している場合）</span><br><span class="line">login.windows.net</span><br><span class="line">login.microsoftonline.com</span><br><span class="line">rl3.digicert.com:80</span><br><span class="line">crl4.digicert.com:80</span><br><span class="line">ocsp.digicert.com:80</span><br><span class="line">www.d-trust.net:80</span><br><span class="line">root-c3-ca2-2009.ocsp.d-trust.net:80</span><br><span class="line">crl.microsoft.com:80</span><br><span class="line">oneocsp.microsoft.com:80</span><br><span class="line">ocsp.msocsp.com:80</span><br></pre></td></tr></table></figure><h2 id="ウィルス対策ソフトでのスキャン除外項目"><a href="#ウィルス対策ソフトでのスキャン除外項目" class="headerlink" title="ウィルス対策ソフトでのスキャン除外項目"></a>ウィルス対策ソフトでのスキャン除外項目</h2><p>基本的には SQL Server 2012 Express LocalDB としての除外をご考慮いただければと存じますので、<a href="https://learn.microsoft.com/ja-JP/troubleshoot/sql/database-engine/security/antivirus-and-sql-server">こちらの公開情報</a>をまずは参考としてご参照いただければと存じます。</p><p>上記技術情報を踏まえ、AADC 製品を添付の SQL Server 2012 Express LocalDB をご利用いただいた状態で、既定でセットアップされた際の除外対象は以下となります。</p><ul><li>SQL Server データ ファイル格納先</li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">C:\Program Files\Microsoft Azure AD Sync\Data</span><br></pre></td></tr></table></figure><p>※ 一時的に利用される場合があるため、[C:\Program Files\Microsoft Azure AD Sync\MaData] も併せて除外していただければと存じます。</p><ul><li>ウイルス スキャンから除外するプロセス</li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">C:\Program Files\Microsoft SQL Server\110\LocalDB\Binn\sqlservr.exe</span><br></pre></td></tr></table></figure><p>上記に加え、SQL Server 観点として技術情報にございます [.bak / .trn / .trc / .sql] の拡張子を持つファイルの除外も念のためご検討ください。</p><h2 id="よくある質問"><a href="#よくある質問" class="headerlink" title="よくある質問"></a>よくある質問</h2><p><strong>Q. 許可すべき通信が多すぎます。公開情報に記載の URL の中には、実際には通信していない URL もありそうでした。最低限しか許可したくないのですが、どの URL を許可すればいいですか？</strong></p><p><strong>A.</strong> 公開情報に記載されているものにつきましては、基本的に許可することを推奨しています。もしお客様環境の要件などにより、上記より絞り込む必要がある場合は、ツールなどで実際の通信を取得し、許可する通信先をお客様側で判断してください。<br>トラブル シューティングなどの際には、まずは上記 URL を許可するようご案内する場合があります。</p><p><strong>Q. 通信を許可するにあたり、どちら向きの通信を許可すればよいのでしょうか。</strong></p><p><strong>A.</strong> Azure AD Connect を起点に、 Azure AD Connect -&gt; オンプレミス AD 、 Azure AD Connect -&gt; Azure AD の向きの通信を許可します。<br>一般的に戻りの通信は許可されておりますので、この方向の通信を許可すれば、オンプレミス AD や Azure AD から返される応答の通信は許可されます。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;本記事は Technet Blog の更新停止に伴い &lt;a href=&quot;https://blogs.technet.microsoft.com/jpazure</summary>
      
    
    
    
    
    <category term="AAD Connect" scheme="https://jpazureid.github.io/blog/tags/AAD-Connect/"/>
    
  </entry>
  
</feed>
